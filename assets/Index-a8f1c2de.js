import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";import{_ as A,j as N,i as E,r as f,a as h,o as v,c as F,b as s,t as c,B as _,p as k,v as w,e as V,d as b,w as I,F as G,H as T,m as i,E as p}from"./index-6217c161.js";import{_ as H}from"./OperateSuccessDialog-a89f4189.js";import{e as U}from"./ethers-5ff326a4.js";import"./SelectLockDate-9ce1d67c.js";/* empty css                                                                */import{D as M}from"./DoubleToken-022adc77.js";import{b as g}from"./units-b1f53ef7.js";const P={class:"info"},W={class:"key"},j={class:"value"},q={class:"key"},z={class:"value"},J={class:"key"},K={class:"value"},O={class:"key"},Q={class:"value"},R={class:"dlg-bottom"},X={__name:"Unlock",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(m,{emit:y}){const e=m,n=N(),{t:r}=E(),o=f(0n),d=f(0),L=f(!1),S=f("");async function B(){const l=await i.wallet.metamask.getGasPrice(),t=await i.wallet.metamask.getBalance(n.walletAddress);console.log("balance",t);let a;if(e.isLockV2){const u=await i.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address);o.value=await u.withdrawFee(),t<o.value&&p.error(r("balanceSlow2",{chainMianCoin:n.nativeCurrencySymbol,amount:g(o.value)})),a=await u.unlock.estimateGas(e.lockId,{value:o.value})}else{const u=await i.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address);o.value=await u.withdrawFee(),t<o.value&&p.error(r("balanceSlow2",{chainMianCoin:n.nativeCurrencySymbol,amount:g(o.value)})),a=await u.unlock.estimateGas(e.lockId,{value:o.value})}console.dir(a),d.value=g(a*l).toString(),console.log(d.value)}async function $(){const l=T.service({lock:!0,text:"Loading..."});if(e.isLockV2)try{const t=await i.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address);o.value=await t.withdrawFee();let a=await t.unlock(e.lockId,{value:o.value});console.dir(a),S.value=a.hash,L.value=!0}catch(t){let a=i.wallet.metamask.parseError(t);p.error(r(a)),console.log(t)}finally{l.close()}else try{const t=await i.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address);o.value=await t.withdrawFee();let a=await t.unlock(e.lockId,{value:o.value});console.dir(a),S.value=a.hash,L.value=!0}catch(t){let a=i.wallet.metamask.parseError(t);p.error(r(a)),console.log(t)}finally{l.close()}}async function D(){if(!n.isConnecting){p.error(r("pleaseConnectWallet")),C();return}const l=T.service({lock:!0,text:"Loading..."});try{await B()}catch(t){console.log(t)}finally{l.close()}}function C(){y("close")}return D(),(l,t)=>{const a=h("icon-text"),u=h("el-button");return v(),F(G,null,[s("ul",P,[s("li",null,[s("div",W,c(l.$t("withdrawAssets")),1),s("div",j,[e.isLpToken?(v(),_(M,{key:0,class:"token-icon-20 image",token1:k(w)(e.chain,e.tokenList[0].address),token2:k(w)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(v(),_(a,{key:1,icon:k(w)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),s("li",null,[s("div",q,c(l.$t("withdrawNumber")),1),s("div",z,[s("span",null,c(l.$t("toBeWithdrawNumber")+": "),1),V(c(m.amountString),1)])]),s("li",null,[s("div",J,c(l.$t("withdrawFee")),1),s("div",K,c(`${o.value?k(U).formatEther(o.value):"--"}
                            ${k(n).nativeCurrencySymbol}`),1)]),s("li",null,[s("div",O,c(l.$t("gas")),1),s("div",Q,c(`${d.value?d.value:"--"} ${k(n).nativeCurrencySymbol}`),1)])]),s("div",R,[b(u,{class:"btn-gradient btn-block",block:"",onClick:$},{default:I(()=>[V("提取")]),_:1})]),b(H,{show:l.lockSuccessDialog,"onUpdate:show":t[0]||(t[0]=x=>l.lockSuccessDialog=x),txHash:l.lockTxHash,onClose:C},null,8,["show","txHash"])],64)}}},Y=A(X,[["__scopeId","data-v-08efeb2b"]]),ce={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(m,{emit:y}){const e=m;function n(){y("update:model-value",!1)}return(r,o)=>{const d=h("el-dialog");return v(),_(d,{"model-value":e.modelValue,title:r.$t("withdrawAssets"),class:"dlg","destroy-on-close":"",onClose:n},{default:I(()=>[b(Y,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:m.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:n},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};export{ce as _};
