import{S as K}from"./SelectLockDate-8c155c30.js";import{_ as J,h as X,g as Z,i as s,I as V,b as D,o as _,c as E,d as t,t as o,f as p,l as v,z as x,F,B as N,y as h,k as u,E as w,j as ee,A as y,a1 as te,D as oe}from"./index-c5ffcea4.js";import{_ as ae}from"./OperateSuccessDialog-b5ac12f7.js";import{e as B}from"./ethers-024b927f.js";import{b as le}from"./units-833e723c.js";const se={class:"form"},ne={class:"form-item"},ie={class:"form-item-title"},ce={class:"form-item-value"},re={class:"form-item"},de={class:"form-item-title"},ue={class:"form-item-value"},ve={key:0,class:"info"},me={class:"item"},ke={class:"key"},fe={class:"value"},_e={class:"item"},pe={class:"key"},ye={class:"value"},he={class:"form-item"},we={class:"form-item-title"},ge={class:"form-item-value"},Ve={class:"form-bottom"},Ce={class:"form-bottom-btns"},be={class:"dlg-item"},$e={class:"key"},Le={class:"value"},Ae={class:"key"},Te={class:"value"},Se={class:"key"},De={class:"value"},Ee={class:"key"},Ne={class:"value"},Oe={class:"key"},Ue={class:"value"},Ie={class:"tips"},Fe={class:"dlg-bottom"},Be={__name:"UniV3",setup(Pe){const n=X(),{t:m}=Z(),d=s(""),c=s(""),P=V().add(1,"day").endOf("day").toDate(),k=s(P),C=s(!1),b=s(!1),r=s(null);async function Y(){b.value=!0;try{const e=await u.wallet.metamask.contractNFT(d.value);if((await e.ownerOf(c.value)).toLowerCase()!=n.walletAddress){w.error(m("notOwnToken"));return}await(await e.approve(n.lock.tokenLockV3Address,c.value)).wait(),C.value=!1}catch(e){console.log(e);let a=u.wallet.metamask.parseError(e);w.error(m(a))}finally{b.value=!1}}const $=s(!1),L=s(""),g=s(!1),O=s("");function q(e){d.value=e,I()}function G(e){c.value=e,I()}const U=s(!1),A=s(!1);async function I(){if(A.value=!1,!(!d.value||!ee(d.value))&&c.value){if(!n.isConnecting){w.error(m("pleaseConnectWallet"));return}U.value=!0;try{const e=await u.wallet.metamask.contractNFT(d.value);let a;try{a=await e.ownerOf(c.value)}catch(z){console.error(z),w.error(m("trueTokenAddressIDFormat"));return}const l=await e.positions(c.value),i=l[2],S=l[3],Q=await(await u.wallet.metamask.contractERC20(i)).symbol(),R=await(await u.wallet.metamask.contractERC20(S)).symbol();r.value={token0:l[2],token0Symbol:Q,token1:l[3],token1Symbol:R,liquidity:l[7]};const W=await e.getApproved(c.value);C.value=W.toLowerCase()!=n.lock.tokenLockV3Address.toLowerCase(),A.value=!0}catch(e){console.log(e)}finally{U.value=!1}}}async function H(){$.value=!0,L.value="";try{if((await(await u.wallet.metamask.contractNFT(d.value)).ownerOf(c.value)).toLowerCase()!=n.walletAddress){w.error(m("notOwnToken"));return}await M()}catch(e){console.log(e)}finally{$.value=!1}}async function M(){const e=await u.wallet.metamask.getGasPrice();let a;const l=V(k.value).endOf("day").unix();a=await(await u.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address)).lock.estimateGas(n.walletAddress,d.value,c.value,l,""),console.dir(a),O.value=le(a*e),g.value=!0}const T=s(!1);async function j(){const e=oe.service({lock:!0,text:m("upChainNow")}),a=V(k.value).endOf("day").unix(),l=await u.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address);try{let i=await l.lock(n.walletAddress,d.value,c.value,a,"");console.dir(i),L.value=i.hash,T.value=!0,g.value=!1}catch(i){console.log(i)}finally{e.close()}}return(e,a)=>{const l=D("el-input"),i=D("el-button"),S=D("el-dialog");return _(),E(F,null,[t("div",se,[t("div",ne,[t("div",ie,o(e.$t("enterTokenAddress")),1),t("div",ce,[p(l,{"model-value":d.value,"onUpdate:modelValue":q,placeholder:e.$t("contractAddress"),class:"ipt"},null,8,["model-value","placeholder"])])]),t("div",re,[t("div",de,o(e.$t("enterTokenId")),1),t("div",ue,[p(l,{"model-value":c.value,"onUpdate:modelValue":G,placeholder:e.$t("forExample"),class:"ipt",type:"number"},null,8,["model-value","placeholder"]),A.value?(_(),E("ul",ve,[t("li",me,[t("div",ke,o(e.$t("transactionPairs")),1),t("div",fe,o(r.value?`${r.value.token0Symbol}/${r.value.token1Symbol}`:"--/--"),1)]),t("li",_e,[t("div",pe,o(e.$t("lockQuantity")),1),t("div",ye,o(r.value?v(B).formatEther(r.value.liquidity.toString()):"--"),1)])])):x("",!0)])]),t("div",he,[t("div",we,o(e.$t("setDate")),1),t("div",ge,[p(K,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=f=>k.value=f)},null,8,["modelValue"])])]),t("div",Ve,[t("div",Ce,[v(n).isConnecting?(_(),E(F,{key:0},[C.value?(_(),N(i,{key:0,class:"btn-gradient",onClick:Y,loading:b.value},{default:h(()=>[y("Approve")]),_:1},8,["loading"])):(_(),N(i,{key:1,class:"btn-gradient",onClick:H,loading:$.value},{default:h(()=>[y(o(e.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(_(),N(i,{key:1,class:"btn btn-gradient",onClick:a[1]||(a[1]=()=>e.configStore.loginDialogVisible=!0)},{default:h(()=>[y(o(e.$t("connectWallet")),1)]),_:1}))])])]),p(S,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=f=>g.value=f),title:e.$t("lockConfirm"),class:"dlg dlg-lock-confirm"},{default:h(()=>[t("ul",be,[t("li",null,[t("div",$e,o(e.$t("transactionPairs")),1),t("div",Le,o(r.value.value?`${r.value.value.token0Symbol}/${r.value.value.token1Symbol}`:"--/--"),1)]),t("li",null,[t("div",Ae,o(e.$t("lockQuantity")),1),t("div",Te,o(r.value.value?v(B).formatEther(r.value.value.liquidity.toString()):"--"),1)]),t("li",null,[t("div",Se,o(e.$t("contractChian")),1),t("div",De,o(v(n).currentChain.chainShow),1)]),t("li",null,[t("div",Ee,o(e.$t("unlockTime")),1),t("div",Ne,[y(o(v(V)(k.value).format("YYYY-MM-DD"))+"(",1),t("span",null,o(e.$t("dayLeft",{day:v(te)(k.value)})),1),y(")")])]),t("li",null,[t("div",Oe,o(e.$t("gas")),1),t("div",Ue,o(`${O.value} ${v(n).nativeCurrencySymbol}`),1)])]),t("div",Ie,[t("p",null,o(e.$t("attention")),1),t("p",null,o(e.$t("createTips1")),1),t("p",null,o(e.$t("createTips2")),1),t("p",null,o(e.$t("createTips3")),1)]),t("div",Fe,[p(i,{class:"btn-gradient btn-block",onClick:j},{default:h(()=>[y(o(e.$t("confirmAndLock")),1)]),_:1})])]),_:1},8,["modelValue","title"]),p(ae,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=f=>T.value=f),txHash:L.value},null,8,["modelValue","txHash"])],64)}}},Qe=J(Be,[["__scopeId","data-v-64ef3f32"]]);export{Qe as default};
