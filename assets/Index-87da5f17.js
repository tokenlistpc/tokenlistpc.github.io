import{_ as re}from"./noData-cd778682.js";import{T as O}from"./TokenIcon-8a322026.js";import{T as K}from"./TokenName-cbcbca0c.js";import{C as W}from"./CopyText-dad84fea.js";import{_ as ue,a as de}from"./Index-c6a5bdb0.js";import{a0 as me,_ as pe,u as fe,i as Le,d as ye,a as we,j as D,v as Te,w as he,e as I,K as ge,o as d,c as v,f as V,h as w,x as p,F as B,g as Q,l,y as N,z as _,t as h,L as be,A as T,C as ve,b as L,E as G,M as R,B as J,q as U,m as X,n as _e,p as Z,a5 as M,a6 as Ce}from"./index-5cc2f2fb.js";import{e as Ie}from"./ethers-67025816.js";import{f as x}from"./units-b77af694.js";/* empty css                                                          */import"./DoubleToken-99921245.js";import"./OperateSuccessDialog-f8ce4eb6.js";import"./SelectLockDate-c7cfac77.js";/* empty css                                                                */import"./wallet-00a5b4d6.js";const Ve=me("list",{state:()=>({lockType:0,tokenType:null,pageSize:5,lockList:[{name:"allLock",pageNumber:1,list:[],loading:!1},{name:"myLock",pageNumber:1,list:[],loading:!1}],searchLockList:{list:[],loading:!1}}),actions:{}});const Ae={class:"lock-master"},Se={key:1,class:"error"},De={class:"option"},Ne={class:"operate"},$e={key:0,class:"tab"},Ee=["onClick"],Ue={key:0,class:"empty"},Fe=["fit"],ze={class:"info"},Re={key:1,class:"list"},xe={class:"unlock-date"},Ye={key:0,class:"pagination"},Be={__name:"Index",setup(Me){const c=fe(),e=Ve(),{t:P}=Le(),ee=ye(),j=we(),A=D(""),$=D(0),g=D(!1),Y=Te(()=>ve.chainList.filter(o=>!!o.lock&&o.isTestChain==c.isTestChain));async function oe(o){if(console.log(o),o!=c.chainId)try{let n=Y.value.find(t=>t.chainId==o);await L.wallet.metamask.switchNetwork(n)}catch(n){const t=L.wallet.metamask.parseError(n);G.error(P(t))}}const f=D(null),F=D(!1),z=D(!1);function te(){j.push("/lock/create/token"),console.dir(e)}async function q(){if(g.value=!1,!A.value){e.searchLockList.list=[];return}if(!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(A.value)){e.searchLockList.list=[];return}let t=e.tokenType;g.value=!0,e.searchLockList.loading=!0;try{let k,s,r,i,u=[];if(t=="lpTokenV3")k=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),i=await k.getLocksForToken(A.value,0n,10000n);else{if(k=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),s=await k.cumulativeLockInfo(A.value),r="0x0000000000000000000000000000000000000000",s.token==r)throw"tokenErr";if(s.factory==r&&t!=="token"||s.factory!==r&&t!=="lpToken")throw"typeErr";i=await k.getLocksForToken(s.token,0n,10000n),console.log(i)}for(let m of i){let y;t=="token"&&s.factory==r?y=await b(m,0):t=="lpToken"&&s.factory!==r?y=await b(m,1):t=="lpTokenV3"&&(y=await b(m,2)),u.push(y)}if(e.tokenType!==t)throw"tokenTypeErr";e.searchLockList.list=u}catch(k){e.searchLockList.list=[],console.log(k)}finally{e.searchLockList.loading=!1}}function le(o){(g.value?e.searchLockList.loading:e.lockList[e.lockType].loading)||(e.lockType=o,e.lockList[e.lockType].list.length==0&&E())}he(()=>{var o;return(o=ee.params)==null?void 0:o.tokenType},o=>{g.value=!1,A.value="",e.tokenType=o,e.lockType=0,$.value=0;for(let n in e.lockList)e.lockList[n].pageNumber=1,e.lockList[n].list=[],e.lockList[n].loading=!1;console.log(e.lockList),E()},{immediate:!0});function ae(o){console.log(o);let n="";e.tokenType=="token"?n="/lock/detail/token/"+o.id:e.tokenType=="lpToken"?n="/lock/detail/lpToken/"+o.id:e.tokenType=="lpTokenV3"&&(n="/lock/detail/lpTokenV3/"+o.id),j.push(n)}async function E(){e.lockType==0?await se():await ie()}function ne(){E()}async function se(){let o=e.tokenType;e.lockList[e.lockType].loading=!0;let n=(e.lockList[e.lockType].pageNumber-1)*e.pageSize,t=(e.lockList[e.lockType].pageNumber-1)*e.pageSize+e.pageSize-1;try{let k,s,r=[];if(o=="token"){s=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allNormalTokenLockedCount();if(console.log(i),console.log(Number(i)),i==0n)throw"err";$.value=Number(i),k=await s.getCumulativeNormalTokenLockInfo(n,t);for(let u of k)r.push(s.getLocksForToken(u.token,0n,10000n))}else if(o=="lpToken"){s=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allLpTokenLockedCount();if(i==0n)throw"err";$.value=Number(i),k=await s.getCumulativeLpTokenLockInfo(n,t);for(let u of k)r.push(s.getLocksForToken(u.token,0n,10000n))}else if(o=="lpTokenV3"){s=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address);let i=await s.allTokenLockedCount();if(i==0n)throw"err";$.value=Number(i),k=await s.getAllTokenLockInfo(n,t);for(let u of k)r.push(u)}Promise.all(r).then(i=>{let u=[];if(console.log("resLockTokenArr",i),o=="lpTokenV3")for(let m of i)u.push(b(m,2));else for(let m of i)for(let y of m)o=="token"?u.push(b(y,0)):o=="lpToken"&&u.push(b(y,1));Promise.all(u).then(m=>{if(console.log("resTokenLockList",m),e.tokenType!==o)throw"tokenTypeErr";e.lockList[e.lockType].list=m}).catch(m=>{throw m}).finally(m=>{e.lockList[e.lockType].loading=!1})}).catch(i=>{throw i})}catch{e.lockList[e.lockType].loading=!1}}async function ie(){if(!c.isConnecting){G.error(P("pleaseConnectWallet"));return}let o=e.tokenType;e.lockList[e.lockType].loading=!0;try{let n,t;o=="lpTokenV3"?(t=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),n=await t.locksForUser(c.walletAddress)):(t=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),o=="token"?n=await t.normalLocksForUser(c.walletAddress):o=="lpToken"&&(n=await t.lpLocksForUser(c.walletAddress))),console.log(n),e.lockList[e.lockType].list=[];let k=[];for(let s of n){let r;o=="token"?r=await b(s,0):o=="lpToken"?r=await b(s,1):o=="lpTokenV3"&&(r=await b(s,2)),k.push(r),e.lockList[e.lockType].list.push(r)}if(e.tokenType!==o)throw"tokenTypeErr";e.lockList[e.lockType].list=k}catch(n){console.log(n)}finally{e.lockList[e.lockType].loading=!1}}async function b(o,n){let t={};if(t.id=o.id,t.tokenAddress=o.token.toLowerCase(),t.owner=o.owner.toLowerCase(),t.lockDate=R.unix(J(Number(o.lockDate))).format("YYYY-MM-DD HH:mm:ss"),t.unlockDate=R.unix(J(Number(o.tgeDate))).format("YYYY-MM-DD HH:mm:ss"),n==0){let k=await L.wallet.metamask.contractERC20(o.token);t.tokenList=[],t.tokenSymbol=await k.symbol(),t.tokenIcon=U(c.chain,o.token.toLowerCase());const s=await k.decimals();t.decimals=s,t.amount=x(o.amount,s),t.unlockedAmount=x(o.unlockedAmount,s)}else if(n==1){let k=await L.wallet.metamask.contractLP(o.token),s=await k.token0(),i=await(await L.wallet.metamask.contractERC20(s)).symbol(),u=await k.token1(),y=await(await L.wallet.metamask.contractERC20(u)).symbol();t.tokenList=[],t.tokenList[0]={symbol:i.toUpperCase(),address:s.toLowerCase(),amount:0},t.tokenList[1]={symbol:y.toUpperCase(),address:u.toLowerCase(),amount:0},t.tokenSymbol=i+"/"+y,t.tokenIcon0=U(c.chain,s.toLowerCase()),t.tokenIcon1=U(c.chain,u.toLowerCase());const C=await k.decimals();t.decimals=C,t.amount=x(o.amount,C),t.unlockedAmount=x(o.unlockedAmount.toString(),C)}else if(n==2){console.log(o.id),t.tokenId=o.tokenId;let s=await(await L.wallet.metamask.contractNFT(o.token)).positions(t.tokenId);console.log(s.token0);let r=s.token0,u=await(await L.wallet.metamask.contractERC20(r)).symbol(),m=s.token1,C=await(await L.wallet.metamask.contractERC20(m)).symbol();t.tokenList=[],t.tokenList[0]={symbol:u.toUpperCase(),address:r.toLowerCase(),amount:0},t.tokenList[1]={symbol:C.toUpperCase(),address:m.toLowerCase(),amount:0},t.tokenSymbol=u+"/"+C,t.tokenIcon0=U(c.chain,r.toLowerCase()),t.tokenIcon1=U(c.chain,m.toLowerCase()),t.liquidity=s.liquidity}return t}function ce(o){f.value=o,F.value=!0}function ke(o){f.value=o,z.value=!0}function H(){g.value?q():E()}return(o,n)=>{const t=I("el-option"),k=I("el-select"),s=I("el-input"),r=I("el-button"),i=I("el-table-column"),u=I("el-tag"),m=I("el-table"),y=I("el-pagination"),C=ge("loading");return d(),v(B,null,[V("div",Ae,[w(s,{modelValue:A.value,"onUpdate:modelValue":n[0]||(n[0]=a=>A.value=a),placeholder:o.$t("tokenLPToken"),onInput:q,class:"input-with-select",clearable:""},{prepend:p(()=>[w(k,{class:"select-chain","model-value":l(c).chainId?l(c).chainId:" ",onChange:oe},{prefix:p(()=>[l(c).isConnecting&&l(c).chain&&Y.value.some(a=>a.chainId==l(c).chainId)?(d(),T(O,{key:0,class:"token-icon",bigIcon:l(X)(l(c).chain)},null,8,["bigIcon"])):(d(),v("span",Se,"ERROR"))]),default:p(()=>[(d(!0),v(B,null,Q(Y.value,a=>(d(),T(t,{key:a.chainId,label:a.chainShow,value:a.chainId},{default:p(()=>[V("div",De,[w(O,{class:"token-icon",bigIcon:l(X)(a.chain.toLowerCase())},null,8,["bigIcon"]),V("span",null,h(a.chainShow),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","placeholder"]),V("div",Ne,[g.value?N("",!0):(d(),v("ul",$e,[(d(!0),v(B,null,Q(l(e).lockList,(a,S)=>(d(),v("li",{class:_e({"tab-item-selected":l(e).lockType==S}),key:S,onClick:()=>le(S)},h(o.$t(a.name)),11,Ee))),128))])),w(r,{type:"primary",class:"btn-gradient lock",onClick:te},{default:p(()=>[_(h(o.$t("oneKeyLock")),1)]),_:1})]),g.value&&l(e).searchLockList.list.length==0&&!l(e).searchLockList.loading||l(e).lockList[l(e).lockType].list.length==0&&!l(e).lockList[l(e).lockType].loading?(d(),v("div",Ue,[V("img",{style:{width:"80px"},src:re,fit:o.fit},null,8,Fe),V("div",ze,[_(h(o.$t("noLockToken"))+"ï¼Œ",1),V("span",{onClick:E,style:{color:"#409eff",cursor:"pointer"}},h(o.$t("refresh")),1)])])):(d(),v("div",Re,[be((d(),T(m,{class:"table-mine",data:g.value?l(e).searchLockList.list:l(e).lockList[l(e).lockType].list},{default:p(()=>[w(i,{label:o.$t("tokenName"),width:"180"},{default:p(a=>[l(e).tokenType=="token"?(d(),T(K,{key:0,class:"token-name",name:a.row.tokenSymbol,bigIcon:a.row.tokenIcon},null,8,["name","bigIcon"])):(d(),T(K,{key:1,class:"token-name",name:a.row.tokenSymbol,token1:a.row.tokenIcon0,token2:a.row.tokenIcon1},null,8,["name","token1","token2"]))]),_:1},8,["label"]),w(i,{label:o.$t("contractAddress"),width:"140"},{default:p(a=>[w(W,{text:a.row.tokenAddress,smallText:l(Z)(a.row.tokenAddress)},null,8,["text","smallText"])]),_:1},8,["label"]),l(e).tokenType=="lpTokenV3"?(d(),T(i,{key:0,prop:"amount",label:o.$t("lockNumber"),width:"180"},{default:p(a=>[_(h(l(Ie).formatEther(a.row.liquidity.toString())),1)]),_:1},8,["label"])):(d(),T(i,{key:1,prop:"amount",label:o.$t("lockNumber"),width:"180"},null,8,["label"])),w(i,{prop:"unlockDate",label:o.$t("unlockTime2")},{default:p(a=>[V("div",xe,[_(h(a.row.unlockDate)+" ",1),l(M)(a.row.unlockDate)?(d(),T(u,{key:0,class:"over-time tag",size:"small",type:"info"},{default:p(()=>[_(h(o.$t("expired")),1)]),_:1})):(d(),T(u,{key:1,class:"progress tag",size:"small",type:"info"},{default:p(()=>[_(h(o.$t("dayLeft",{day:l(Ce)(a.row.unlockDate)})),1)]),_:2},1024))])]),_:1},8,["label"]),w(i,{prop:"address",label:o.$t("lockUser"),width:"150"},{default:p(a=>[w(W,{text:a.row.owner,smallText:l(Z)(a.row.owner)},null,8,["text","smallText"])]),_:1},8,["label"]),w(i,{prop:"address",label:o.$t("operate"),width:"150"},{default:p(a=>[w(r,{key:"primary",type:"primary",onClick:S=>ae(a.row),link:""},{default:p(()=>[_(h(o.$t("view")),1)]),_:2},1032,["onClick"]),l(M)(a.row.unlockDate)&&a.row.owner.toLowerCase()==l(c).walletAddress?(d(),T(r,{key:"primary",type:"primary",onClick:S=>ce(a.row),link:""},{default:p(()=>[_(h(o.$t("withdraw")),1)]),_:2},1032,["onClick"])):N("",!0),!l(M)(a.row.unlockDate)&&a.row.owner.toLowerCase()==l(c).walletAddress?(d(),T(r,{key:"primary",type:"primary",onClick:S=>ke(a.row),link:""},{default:p(()=>[_(h(o.$t("edit")),1)]),_:2},1032,["onClick"])):N("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[C,g.value?l(e).searchLockList.loading:l(e).lockList[l(e).lockType].loading]]),!g.value&&l(e).lockType==0?(d(),v("div",Ye,[w(y,{background:"",layout:"prev, pager, next",total:$.value,onCurrentChange:ne,"page-size":l(e).pageSize,"current-page":l(e).lockList[l(e).lockType].pageNumber,"onUpdate:currentPage":n[1]||(n[1]=a=>l(e).lockList[l(e).lockType].pageNumber=a)},null,8,["total","page-size","current-page"])])):N("",!0)]))]),F.value?(d(),T(ue,{key:0,onOperateSuccess:H,modelValue:F.value,"onUpdate:modelValue":n[2]||(n[2]=a=>F.value=a),lockId:f.value.id,isLockV2:l(e).tokenType!=="lpTokenV3",isLpToken:l(e).tokenType!=="token",unlockDate:l(R)(f.value.unlockDate).unix(),tokenList:f.value.tokenList,symbol:f.value.tokenSymbol,address:f.value.tokenAddress,amountString:f.value.amount,chain:l(c).chain,decimals:f.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):N("",!0),z.value?(d(),T(de,{key:1,onOperateSuccess:H,modelValue:z.value,"onUpdate:modelValue":n[3]||(n[3]=a=>z.value=a),lockId:f.value.id,isLockV2:l(e).tokenType!=="lpTokenV3",isLpToken:l(e).tokenType!=="token",unlockDate:l(R)(f.value.unlockDate).unix(),tokenList:f.value.tokenList,symbol:f.value.tokenSymbol,address:f.value.tokenAddress,amountString:f.value.amount,chain:l(c).chain,decimals:f.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):N("",!0)],64)}}},to=pe(Be,[["__scopeId","data-v-aabcb9fc"]]);export{to as default};
