/* empty css                                                          */import{_ as j,h as q,g as W,i as g,I as _,b as V,o as w,c as x,d as t,t as u,B as N,l as k,q as E,A as B,a1 as J,z as G,f as h,y as M,F as K,C as D,E as f,D as U,k as d}from"./index-149d5279.js";import{_ as Q}from"./OperateSuccessDialog-c2474d0d.js";import{e as X}from"./ethers-dde59bde.js";import{S as Z}from"./SelectLockDate-8a3de2c6.js";/* empty css                                                                */import{D as ee}from"./DoubleToken-4ede8e52.js";import{a as H,f as te,b as I}from"./units-a0140e3c.js";const ae={key:0,class:"info"},oe={class:"key"},le={class:"value"},ne={class:"key"},se={class:"value"},ce={class:"blue-font"},ie={class:"key"},re={class:"value"},ue={class:"key"},de={class:"value"},me={class:"select-date"},ke={class:"key"},ve={class:"value"},fe={key:1,class:"change-amount"},ye={class:"key"},pe={class:"value"},ge={class:"dlg-bottom"},_e={__name:"Edit",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(L,{emit:S}){const e=L,n=q(),{t:c}=W(),l=g(0n),y=g(_.unix(e.unlockDate).toDate()),m=g(e.amountString),T=g(""),b=g(""),C=g(!1),A=g("");async function Y(){const o=await(await d.wallet.metamask.contractERC20(e.address)).balanceOf(n.walletAddress);T.value=te(o,e.decimals),console.log("value:"+T.value),o==0n&&(f.error(c("balanceSlow")),S("error"))}async function O(){console.log("estimateGas");const a=_.unix(e.unlockDate).add(1,"day").unix(),o=await d.wallet.metamask.getGasPrice(),i=await d.wallet.metamask.getBalance(n.walletAddress);console.log("balance",i);let s;if(e.isLockV2){const r=await d.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address),p=await(await d.wallet.metamask.contractERC20(e.address)).decimals(),$=H(e.amountString,p);l.value=await r.editFee(),i<l.value&&f.error(c("balanceSlow2",{chainMianCoin:n.nativeCurrencySymbol,amount:I(l.value)})),s=await r.editLock.estimateGas(e.lockId,$.toString(),a,{value:l.value})}else{const r=await d.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address);l.value=await r.editFee(),i<l.value&&f.error(c("balanceSlow2",{chainMianCoin:n.nativeCurrencySymbol,amount:I(l.value)})),s=await r.editLock.estimateGas(e.lockId,a,{value:l.value})}console.dir(s),b.value=I(s*o).toString(),console.log(b.value)}function R(){console.log(m.value),(D(m.value).lt(e.amountString)||!m.value)&&(m.value=e.amountString)}async function z(){if(!y.value){f.error(c("selectUnlockTime"));return}if(D(m.value).lt(e.amountString)||!m.value){f.error(c("newLockedAmountLimit"));return}if(D(m.value).minus(e.amountString).gt(D(T.value))){f.error(e.symbol+c("balanceSlow"));return}const a=U.service({lock:!0,text:"Loading..."}),o=_(y.value).unix();if(e.isLockV2){const i=await d.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address),r=await(await d.wallet.metamask.contractERC20(e.address)).decimals(),v=H(m.value,r);console.log(v);try{l.value=await i.editFee();let p=await i.editLock(e.lockId.toString(),v.toString(),o,{value:l.value});console.dir(p),A.value=p.hash,C.value=!0}catch(p){let $=d.wallet.metamask.parseError(p);f.error(c($)),console.log(p)}finally{a.close()}}else{const i=await d.wallet.metamask.contractTokenLockV3(n.lock.tokenLockV3Address);try{l.value=await i.editFee();let s=await i.editLock(e.lockId.toString(),o,{value:l.value});console.dir(s),A.value=s.hash,C.value=!0}catch(s){let r=d.wallet.metamask.parseError(s);f.error(c(r)),console.log(s)}finally{a.close()}}}async function P(){if(!n.isConnecting){f.error(c("pleaseConnectWallet")),F();return}const a=U.service({lock:!0,text:"Loading..."});try{y.value=_.unix(e.unlockDate).add(1,"day").endOf("day").toDate(),await Y(),await O()}catch(o){console.log(o)}finally{a.close()}}function F(){S("close")}return P(),(a,o)=>{const i=V("icon-text"),s=V("el-input"),r=V("el-button");return w(),x(K,null,[e.chain?(w(),x("ul",ae,[t("li",null,[t("div",oe,u(a.$t("lockAssets")),1),t("div",le,[e.isLpToken?(w(),N(ee,{key:0,class:"token-icon-20 image",token1:k(E)(e.chain,e.tokenList[0].address),token2:k(E)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(w(),N(i,{key:1,icon:k(E)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),t("li",null,[t("div",ne,u(a.$t("unlockTime")),1),t("div",se,[t("span",null,u(k(_).unix(e.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[B("("),t("span",ce,u(a.$t("dayLeft",{day:k(J)(k(_).unix(e.unlockDate).toDate())})),1),B(")")])])]),t("li",null,[t("div",ie,u(a.$t("editFee")),1),t("div",re,u(`${l.value?k(X).formatEther(l.value):"--"} ${k(n).nativeCurrencySymbol}`),1)]),t("li",null,[t("div",ue,u(a.$t("gas")),1),t("div",de,u(`${b.value?b.value:"--"} ${k(n).nativeCurrencySymbol}`),1)])])):G("",!0),t("div",me,[t("div",ke,u(a.$t("setDelayDate")),1),t("div",ve,[h(Z,{modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=v=>y.value=v),"min-date":k(_).unix(e.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["modelValue","min-date"])])]),e.isLockV2?(w(),x("div",fe,[t("div",ye,u(a.$t("newLockedAmount")),1),t("div",pe,[h(s,{size:"large",type:"number",modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=v=>m.value=v),onBlur:R,placeholder:a.$t("pleaseEnter"),clearable:""},null,8,["modelValue","placeholder"])])])):G("",!0),t("div",ge,[h(r,{class:"btn-gradient btn-block",block:"",onClick:z},{default:M(()=>[B(u(a.$t("confirmAndLock")),1)]),_:1})]),h(Q,{show:C.value,"onUpdate:show":o[2]||(o[2]=v=>C.value=v),txHash:A.value,onClose:F},null,8,["show","txHash"])],64)}}},we=j(_e,[["__scopeId","data-v-03f6d952"]]),Ae={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(L,{emit:S}){const e=L;function n(){S("update:model-value",!1)}return(c,l)=>{const y=V("el-dialog");return w(),N(y,{"model-value":e.modelValue,title:c.$t("delayLock"),class:"dlg","destroy-on-close":"",onClose:n},{default:M(()=>[h(we,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:L.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:n},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};export{Ae as _};
