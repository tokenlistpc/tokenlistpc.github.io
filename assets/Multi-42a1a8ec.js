import{S as Se}from"./Step-2f04625d.js";import{T as Le}from"./TokenIcon-e72a2230.js";import{_ as de,h as he,i as ge,r as c,w as ke,j as Te,k as y,d as N,o as u,c as f,g as h,e,F as B,f as Z,l as q,m as Ve,t as s,p as Be,E as g,q as Ee,b as ye,v as ee,a5 as Ie,u as Ne,B as P,y as L,z as fe,C as T,D as _e,J as Re,A as D,n as Fe}from"./index-b49da9d3.js";import{f as ue,a as Q,b as pe}from"./units-ed7533eb.js";import{u as De}from"./index-00c3a99b.js";import{W as Me}from"./wallet-7c233d9c.js";/* empty css                                                          */const Oe={class:"token-list"},Ue=["onClick"],We={class:"item-left"},Ge={class:"item-info"},Pe={class:"up"},je={class:"down"},qe={class:"item-right item-info"},ze={class:"up"},He={class:"down"},Qe={__name:"SelectToken",emits:["select"],setup(ce,{emit:m}){const{t:$}=he(),_=ge(),C=c(""),V=c([]),b=c([]);ke(()=>[C.value,V.value],async()=>{b.value=await R()});async function R(){if(C.value)if(C.value.startsWith("0x")){let k=V.value.filter(v=>v.address.toLowerCase()==C.value.toLowerCase());if(k.length==0&&Te(C.value)){let v=await y.wallet.metamask.contractERC20(C.value);const o=C.value.toLowerCase(),d=await v.balanceOf(_.walletAddress),p=await v.decimals(),E=await v.name(),M=await v.symbol();let a={address:o,tokenId:`${o}-${_.chain}`.toLowerCase(),chain:_.chain,symbol:M,decimals:Number(p),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${_.chain}/${o}.png`,amount:Number(ue(d.toString(),p)),name:E,price:0};console.log(a),k.push(a)}return k}else return V.value.filter(k=>k.symbol.toLowerCase().indexOf(C.value.toLowerCase())>-1);else return V.value}async function j(){if(!_.isConnecting){g.error($("connectWalletWarn"));return}try{const k=await y.debank.getTokenList(_.walletAddress,_.chain);let v=[];for(let o of k.data.data)o.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(o.token=y.wallet.MAIN_COIN_ADDRESS),new RegExp("^0x.*$","gi").test(o.token)&&o.value>0&&o.risk_score<60&&o.risk_level>=0&&o.flag!=="blacklist"&&o.symbol!==""&&o.flag!=="lp"&&v.push({address:o.token.toLowerCase(),tokenId:`${o.token}-${o.chain}`.toLowerCase(),chain:o.chain.toLowerCase(),symbol:o.symbol,decimals:o.decimals,icon:Ee(o.chain.toLowerCase(),o.token.toLowerCase()),amount:o.value,price:o.current_price_usd});V.value=v}catch(k){k&&k.message?g.error(k.message):g.error($("unknowError"))}finally{}}return j(),(k,v)=>{const o=N("el-input");return u(),f(B,null,[h(o,{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=d=>C.value=d),placeholder:k.$t("pleaseEnterTokenAddress")},null,8,["modelValue","placeholder"]),e("ul",Oe,[(u(!0),f(B,null,Z(b.value,d=>(u(),f("li",{key:d,onClick:()=>m("select",d)},[e("div",We,[h(Le,{class:"token-icon-30",bigIcon:d.icon,smallIcon:q(Ve)(d.chain)},null,8,["bigIcon","smallIcon"]),e("div",Ge,[e("div",Pe,s(d.symbol),1),e("div",je,s(d.address==q(y).wallet.MAIN_COIN_ADDRESS?" ":q(Be)(d.address,8)),1)])]),e("div",qe,[e("div",ze,s(d.amount),1),e("div",He,s(d.price?`$ ${d.price}`:" "),1)])],8,Ue))),128))])],64)}}},xe=de(Qe,[["__scopeId","data-v-d4d4d861"]]);const Je={class:"box"},Ke=["value"],Xe={class:"index"},Ye={class:"content"},Ze={__name:"InputAddressList",emits:["iptChange"],setup(ce,{emit:m}){const $=ye({isCustom:!1,addressList:[]}),_=ee(()=>{let v=[];for(let o=0;o<$.addressList.length;o++){const d=$.addressList[o];$.isCustom?v.push(`${d.address},${d.amountString}`):v.push(d.address)}return v}),C=ee(()=>_.value.join(`
`)),V=c(null),b=c(!1);async function R(){b.value=!0,await Ie(),V==null||V.value.focus()}function j(v){console.log("onBlurCapture"),console.log(v.target.value),b.value=!1}function k(v){const o=v.target.value,d=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;let p=!1,E=o.replace(/\s+/ig," ").trim();if(E){let M=E.split(" ");E.indexOf(",")>-1&&(p=!0);const a=[];for(let O=0;O<M.length;O++){let z=M[O];if(!z||!d.test(z))continue;let x="",J="";if(p==!0){let K=z.split(",");x=K[0],K.length>1?J=K[1]:J="0"}else x=z;a.push({address:x,amountString:J})}$.isCustom=p,$.addressList=a}else $.isCustom=!1,$.addressList=[];console.log("emit",$.isCustom,$.addressList),m("iptChange",$.isCustom,$.addressList)}return(v,o)=>(u(),f("div",Je,[b.value?(u(),f("textarea",{key:0,class:"ipt",ref_key:"ipt",ref:V,onBlurCapture:j,value:C.value,onChange:k},null,40,Ke)):(u(),f("div",{key:1,class:"table",onClick:R},[(u(!0),f(B,null,Z(_.value,(d,p)=>(u(),f("li",{key:p},[e("div",Xe,s(p+1),1),e("div",Ye,s(d),1)]))),128))]))]))}},et=de(Ze,[["__scopeId","data-v-b47f7bc7"]]);const tt={class:"form"},st={class:"form-item"},lt={class:"form-item-title"},at={class:"form-item-value"},ot={key:1,class:"placeholder"},nt={class:"form-item"},it={class:"form-item-title"},rt={class:"form-item-value"},ut={class:"form-item address-list"},dt={class:"form-item-title"},ct={class:"clear"},mt={class:"form-item-value"},vt={class:"address-list-tips"},ft={class:"form-item rule"},_t={class:"form-item-title"},pt={class:"form-item-value"},ht={key:0,class:"form-item"},gt={class:"form-item-title"},kt={class:"form-item-value"},yt={key:0,class:"form-item"},$t={class:"form-item-title"},bt={class:"form-item-value"},wt={key:1,class:"form-item"},At={class:"form-item-title"},Ct={class:"form-item-value"},St={class:"form-item"},Lt={class:"form-item-title"},Tt={class:"form-item-value"},Vt={class:"form-item"},Bt={class:"form-item-title"},Et={class:"form-item-value"},It={class:"form-bottom"},Nt={class:"form-bottom-btns"},Rt={class:"info"},Ft={class:"info-item"},Dt={class:"info-key"},Mt={class:"info-value"},Ot={class:"info-item"},Ut={class:"info-key"},Wt={class:"info-value"},Gt={class:"info-item"},Pt={class:"info-key"},jt={class:"info-value"},qt={class:"info-item"},zt={class:"info-key"},Ht={class:"info-value"},Qt={class:"info-item"},xt={class:"info-key"},Jt={class:"info-value"},Kt={class:"info-item"},Xt={class:"info-key"},Yt={class:"info-value"},Zt={class:"form-item"},es={class:"form-item-title"},ts={class:"form-item-value"},ss={class:"receiving-address"},ls={class:"address"},as={class:"form-bottom"},os={class:"form-bottom-btns"},ns={key:2,class:"create-success"},is={class:"text"},rs={__name:"Multi",setup(ce){const{t:m}=he(),$=Ne(),_=ge(),C=De(),V=ye(["ready","confirm","multiTransfer"]),b=c(0),R=c(0),j=c(!1),k=c([{name:"customTransfer",value:0},{name:"randomAddress",value:1}]),v=c([{name:"dividedEquallyByTotal",value:0},{name:"eachAddressEqual",value:1}]),o=c(0),d=c(!1),p=c([]),E=c(!1),M=c(!1),a=c(null),O=c(!1);async function z(t){if(a.value=t,O.value=!1,a.value.address==y.wallet.MAIN_COIN_ADDRESS){E.value=!1;return}await y.wallet.metamask.isAllowanceEnough(_.transfer.multiSenderAddress,a.value.address,_.walletAddress)?E.value=!1:E.value=!0}async function x(){M.value=!0;try{let t=await y.wallet.metamask.approveMaxAmount(a.value.address,_.transfer.multiSenderAddress);console.log(t),await t.wait(),E.value=!1}catch(t){console.log(t);let l=y.wallet.metamask.parseError(t);g.error(m(l))}finally{M.value=!1}}function J(){O.value=!0}function K(t,l){d.value=t,p.value=l}const te=c(""),se=c(""),me=ee(()=>{if(R.value==0&&d.value){let t=T(0);for(let l=0;l<p.value.length;l++){const A=p.value[l];t=t.plus(T(A.amountString))}return t.toNumber()}return 0}),X=c(""),Y=c(""),w=c([]),oe=c(0),le=c(0),ae=c(0),ne=c(0),ie=c(0),ve=ee(()=>T(le.value).plus(ae.value).toNumber()),$e=ee(()=>ie.value<ve.value);ke(()=>[w.value,b.value,a.value],async()=>{if(console.log("watch watch watch"),b.value==1&&w.value.length>0&&a.value){const t=_e.service({lock:!0,text:m("estimatingGas")});try{let l=await y.wallet.metamask.getBalance(_.walletAddress);ie.value=T(pe(l)).toNumber();const A=await y.wallet.metamask.contractMultiTransfer(_.transfer.multiSenderAddress);let F=T(0),i=[],n=[];for(let G=0;G<w.value.length;G++){const r=w.value[G];F=F.plus(T(r.amountString)),i.push(r.address),n.push(Q(r.amountString,a.value.decimals))}oe.value=F.toNumber();const S=await A.getFee(w.value.length);ae.value=ue(S,a.value.decimals);let U=S;a.value.address==y.wallet.MAIN_COIN_ADDRESS&&(U=S+Q(F.toString(),a.value.decimals));const W=await y.wallet.metamask.getGasPrice();let I=await A.multiSend.estimateGas(a.value.address,i,n,{value:U})*2n;le.value=pe(I*W);const H=await A.multiSend.staticCall(a.value.address,i,n,{value:U});ne.value=ue(H,a.value.decimals)}catch(l){console.dir(l);let A=y.wallet.metamask.parseError(l);g.error(m(A))}finally{t.close()}}else le.value=0,ae.value=0,oe.value=0,ne.value=0},{deep:!0});async function be(){if(!a.value){g.error(m("pleaseSelectToken1"));return}if(R.value==0){if(p.value.length===0){g.error(m("enterTransferAddress"));return}if(p.value.length>400){g.error(m("numOfAddressLimit"));return}if(!d.value){if(o.value==0){if(!se.value){g.error(m("enterTransferAmount"));return}}else if(!te.value){g.error(m("enterTransferAmount"));return}}}else{if(!X.value){g.error(m("pleaseEnterNumOfaddress"));return}let i=T(X.value).toNumber();if(i<=0){g.error(m("pleaseEnterNumOfaddress"));return}if(i>400){g.error(m("numOfAddressLimit"));return}if(!Y.value){g.error(m("pleaseEnterAmount"));return}if(T(Y.value).toNumber()<=0){g.error(m("pleaseEnterCorrectAmount"));return}}const t=[];if(R.value==0)if(d.value)for(let i=0;i<p.value.length;i++){const n=p.value[i];t.push({address:n.address,amountString:n.amountString})}else if(o.value==0){const i=T(se.value).div(p.value.length).dp(2).toString();for(let n=0;n<p.value.length;n++){const S=p.value[n];t.push({address:S.address,amountString:i})}}else for(let i=0;i<p.value.length;i++){const n=p.value[i];t.push({address:n.address,amountString:te.value})}else{const i=parseInt(X.value);j.value=!0,console.log(111);for(let n=0;n<i;n++){let S=Me.createRandom();t.push({address:S.address.toLowerCase(),amountString:Y.value})}j.value=!1}w.value=t;let l=T(0),A=[],F=[];for(let i=0;i<w.value.length;i++){const n=w.value[i];l=l.plus(T(n.amountString)),A.push(n.address),F.push(Q(n.amountString,a.value.decimals))}if(a.value.amount<l){g.error(m("transferAmountExceeds"));return}b.value=1}function we(t){console.log(t),w.value.splice(t,1)}async function Ae(){if(w.value.length==0){g.error(m("noAddressForTransfer"));return}let t=T(0),l=[],A=[];for(let i=0;i<w.value.length;i++){const n=w.value[i];t=t.plus(T(n.amountString)),l.push(n.address),A.push(Q(n.amountString,a.value.decimals))}if(a.value.amount<t){g.error(m("transferAmountExceeds"));return}const F=_e.service({lock:!0,text:m("trading")});try{const i=await y.wallet.metamask.contractMultiTransfer(_.transfer.multiSenderAddress),n=await i.getFee(w.value.length);let S=n;a.value.address==y.wallet.MAIN_COIN_ADDRESS&&(S=n+Q(t.toString(),a.value.decimals));let U=await i.multiSend.estimateGas(a.value.address,l,A,{value:S})*2n;const W=await i.multiSend(a.value.address,l,A,{value:S,gasLimit:U});console.dir(W);const I=W.hash,H=await W.wait();if(console.dir(H),console.log("txHash: "+I),H.status!=1)g.error(m("upChainFail")),await y.multiSend.sendMultiSendFailTx(_.chain,I);else{let G={receiverCount:0,sendAmount:Q(t.toString(),a.value.decimals).toString(),sendTime:Re().unix(),sender:_.walletAddress,status:-1,tokenAddress:a.value.address,tokenDecimal:a.value.decimals,tokenSymbol:a.value.symbol,txHash:I};console.dir(G),C.transferringList.push(G),b.value=2}}catch(i){console.dir(i);let n=y.wallet.metamask.parseError(i);g.error(m(n))}finally{F.close()}}function Ce(t){return console.log("intFormatter",t),t.replace(".","")}return(t,l)=>{const A=N("icon-text"),F=N("ArrowDownBold"),i=N("el-icon"),n=N("el-button"),S=N("svg-icon"),U=N("el-radio"),W=N("el-radio-group"),I=N("el-input"),H=N("el-alert"),G=N("el-dialog");return u(),f(B,null,[e("div",null,[e("div",null,[h(Se,{"step-list":V,current:b.value},null,8,["step-list","current"])])]),e("div",tt,[b.value==0?(u(),f(B,{key:0},[e("div",st,[e("div",lt,s(t.$t("selectToken")),1),e("div",at,[e("div",{class:"select",onClick:J},[a.value?(u(),P(A,{key:0,icon:a.value.icon,text:a.value.symbol},null,8,["icon","text"])):(u(),f("div",ot,s(t.$t("pleaseSelectToken")),1)),h(i,null,{default:L(()=>[h(F)]),_:1})])])]),e("div",nt,[e("div",it,s(t.$t("selectTransferType")),1),e("div",rt,[(u(!0),f(B,null,Z(k.value,r=>(u(),P(n,{key:r.value,class:Fe(["btn btn-select-type",{"btn-gradient":r.value==R.value}]),onClick:re=>R.value=r.value},{default:L(()=>[D(s(t.$t(r.name)),1)]),_:2},1032,["class","onClick"]))),128))])]),R.value==0?(u(),f(B,{key:0},[e("div",ut,[e("div",dt,[e("div",null,s(t.$t("receivingAddress1")),1),e("div",ct,[h(S,{name:"clear"}),e("div",null,s(t.$t("clear")),1)])]),e("div",mt,[h(et,{onIptChange:K}),e("div",vt,[e("div",null,s(t.$t("copyAddressTips1")),1),e("div",null,s(t.$t("copyAddressTips2")),1),e("div",null,s(t.$t("copyAddressTips3")),1)])])]),e("div",ft,[e("div",_t,s(t.$t("distributionRules"))+"：",1),e("div",pt,[d.value?(u(),P(W,{key:0,"model-value":0},{default:L(()=>[h(U,{label:0},{default:L(()=>[D(s(t.$t("customAmount")),1)]),_:1})]),_:1})):(u(),P(W,{key:1,modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=r=>o.value=r)},{default:L(()=>[(u(!0),f(B,null,Z(v.value,r=>(u(),P(U,{key:r.value,label:r.value},{default:L(()=>[D(s(t.$t(r.name)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]))])]),d.value?(u(),f("div",ht,[e("div",gt,s(t.$t("totalQuantity")),1),e("div",kt,[h(I,{class:"ipt",modelValue:me.value,"onUpdate:modelValue":l[1]||(l[1]=r=>me.value=r),type:"number",disabled:""},null,8,["modelValue"])])])):(u(),f(B,{key:1},[o.value==0?(u(),f("div",yt,[e("div",$t,s(t.$t("totalQuantity")),1),e("div",bt,[h(I,{class:"ipt",modelValue:se.value,"onUpdate:modelValue":l[2]||(l[2]=r=>se.value=r),type:"number"},null,8,["modelValue"])])])):(u(),f("div",wt,[e("div",At,s(t.$t("distributionAmount")),1),e("div",Ct,[h(I,{class:"ipt",modelValue:te.value,"onUpdate:modelValue":l[3]||(l[3]=r=>te.value=r),type:"number"},null,8,["modelValue"])])]))],64))],64)):(u(),f(B,{key:1},[e("div",St,[e("div",Lt,s(t.$t("inputAddressNum")),1),e("div",Tt,[h(I,{class:"ipt",placeholder:t.$t("maximum"),modelValue:X.value,"onUpdate:modelValue":l[4]||(l[4]=r=>X.value=r),type:"number",formatter:Ce},null,8,["placeholder","modelValue"])])]),e("div",Vt,[e("div",Bt,s(t.$t("inputAmountPerAddress")),1),e("div",Et,[h(I,{class:"ipt",modelValue:Y.value,"onUpdate:modelValue":l[5]||(l[5]=r=>Y.value=r),type:"number"},null,8,["modelValue"])])])],64)),e("div",It,[e("div",Nt,[E.value?(u(),P(n,{key:0,class:"btn btn-gradient",onClick:x,loading:M.value},{default:L(()=>[D(s(t.$t("approve")),1)]),_:1},8,["loading"])):(u(),P(n,{key:1,class:"btn btn-gradient",onClick:be,loading:j.value},{default:L(()=>[D(s(t.$t("oneClickTransfer")),1)]),_:1},8,["loading"]))])])],64)):b.value==1?(u(),f(B,{key:1},[e("div",Rt,[e("div",Ft,[e("div",Dt,s(w.value.length),1),e("div",Mt,s(t.$t("addressCount")),1)]),e("div",Ot,[e("div",Ut,s(`${oe.value} ${a.value.symbol}`),1),e("div",Wt,s(t.$t("realTotalPayment")),1)]),e("div",Gt,[e("div",Pt,s(`${ne.value} ${a.value.symbol}`),1),e("div",jt,s(t.$t("totalAmountOfReceived")),1)]),e("div",qt,[e("div",zt,s(`${a.value.amount} ${a.value.symbol}`),1),e("div",Ht,s(t.$t("tokenBalance")),1)]),e("div",Qt,[e("div",xt,s(`${le.value} ${q(_).nativeCurrencySymbol}`),1),e("div",Jt,s(t.$t("estimatedGas")),1)]),e("div",Kt,[e("div",Xt,s(`${ae.value} ${q(_).nativeCurrencySymbol}`),1),e("div",Yt,s(t.$t("serviceFee")),1)])]),e("div",Zt,[e("div",es,s(t.$t("receivingAddress1")),1),e("div",ts,[e("table",ss,[e("tr",null,[e("th",null,s(t.$t("walletAddress")),1),e("th",null,s(t.$t("amount")),1),e("th",null,s(t.$t("operate")),1)]),(u(!0),f(B,null,Z(w.value,(r,re)=>(u(),f("tr",{key:re},[e("td",ls,s(r.address),1),e("td",null,s(`${r.amountString} ${a.value.symbol}`),1),e("td",null,[h(n,{type:"danger",plain:"",class:"btn-remove",onClick:us=>we(re)},{default:L(()=>[D(s(t.$t("remove")),1)]),_:2},1032,["onClick"])])]))),128))])])]),$e.value?(u(),P(H,{key:0,title:t.$t("notEnoughFee",{nativeCurrencySymbol:q(_).nativeCurrencySymbol,nativeCurrencyBalance:ie.value,totalServiceFee:ve.value}),type:"error","show-icon":""},null,8,["title"])):fe("",!0),e("div",as,[e("div",os,[h(n,{class:"btn",onClick:l[6]||(l[6]=r=>b.value=0)},{default:L(()=>[D(s(t.$t("previousStep")),1)]),_:1}),h(n,{class:"btn btn-gradient",onClick:Ae},{default:L(()=>[D(s(t.$t("confirm")),1)]),_:1})])])],64)):b.value==2?(u(),f("div",ns,[h(S,{name:"createSuccess"}),e("div",is,s(t.$t("transferResultSuccess1")),1),h(n,{onClick:l[7]||(l[7]=r=>q($).push("/transfer/history"))},{default:L(()=>[D(s(t.$t("transferResultSuccess2")),1)]),_:1})])):fe("",!0)]),h(G,{modelValue:O.value,"onUpdate:modelValue":l[9]||(l[9]=r=>O.value=r),title:t.$t("selectCurrency"),class:"dlg dlg-select-token","destroy-on-close":""},{default:L(()=>[h(xe,{onSelect:l[8]||(l[8]=r=>z(r))})]),_:1},8,["modelValue","title"])],64)}}},hs=de(rs,[["__scopeId","data-v-b5fd8a99"]]);export{hs as default};
