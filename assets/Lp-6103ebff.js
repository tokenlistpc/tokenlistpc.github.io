import{_ as X,h as Z,i as ee,r as m,w as j,x as te,d as A,o as h,c as b,g as k,e,F as O,f as ae,l as v,q as D,t as o,k as d,p as ie,E as w,s as ce,J as F,v as re,y as C,B as G,z as de,A as V,a2 as ue,D as me}from"./index-645b9a47.js";import{I as ve}from"./InputLockNumber-e49d789a.js";import{S as ke}from"./SelectLockDate-ce8b172c.js";import{_ as fe}from"./OperateSuccessDialog-5feac55d.js";import{D as q}from"./DoubleToken-10278670.js";/* empty css                                                          */import{a as Q,b as _e}from"./units-094ed48a.js";/* empty css                                                                */const he={class:"token-list"},pe=["onClick"],we={class:"item-left"},ge={class:"item-info"},ye={class:"up"},Ce={class:"down"},Le={class:"item-right item-info"},be={class:"up"},$e={class:"down"},Ae={__name:"SelectLp",emits:["select"],setup(oe,{emit:f}){const{t:i}=Z(),S=ee(),_=m([]),a=m(""),y=m([]);j(()=>[a.value,_.value],async()=>{y.value=await L()});const E=te.chainList.filter(n=>!!n.lock),p=m(E.find(n=>n.chainId==S.chainId)?E.find(n=>n.chainId==S.chainId):E[0]);async function L(){return a.value?a.value.startsWith("0x")?_.value.filter(n=>n.address.toLowerCase()==a.value.toLowerCase()):_.value.filter(n=>n.symbol.toLowerCase().indexOf(a.value.toLowerCase())>-1):_.value}async function N(){let n=[];try{const u=await d.debank.getTokenList(S.walletAddress,p.value.chain);for(let s of u.data.data){if(s.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){s.token=d.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(s.token)&&s.value>0&&s.risk_score<60&&s.risk_level>=0&&s.flag!=="blacklist"&&s.symbol!==""){if(s.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;s.flag=="lp"&&n.push({tokenList:[{address:"",symbol:""},{address:"",symbol:""}],symbol:"",address:s.token.toLowerCase(),tokenId:`${s.token}-${s.chain}`.toLowerCase(),chain:s.chain.toLowerCase(),decimals:s.decimals,amount:s.value,price:s.current_price_usd,hasTokenInfo:!1,tokenType:1,nativeCurrencySymbol:p.value.nativeCurrency.symbol,name:s.name})}}}catch(u){u&&u.message?w.error(u.message):w.error(i("unknowError")),n=[]}finally{}_.value=n,I()}N();async function I(){if(_.value.length!=0){if(p.value.chainId!=S.chainId){w.error(i("switchTrueChain",{cahin:p.value.chain})),_.value=[];return}for(let n of _.value)if(n.hasTokenInfo==!1){let u=await d.wallet.metamask.contractLP(n.address),s=await u.token0(),R=await(await d.wallet.metamask.contractERC20(s)).symbol(),B=await u.token1(),T=await(await d.wallet.metamask.contractERC20(B)).symbol();n.tokenList[0]={symbol:R.toUpperCase(),address:s.toLowerCase()},n.tokenList[1]={symbol:T.toUpperCase(),address:B.toLowerCase()},n.symbol=`${R}/${T}`}}}return(n,u)=>{const s=A("el-input");return h(),b(O,null,[k(s,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=c=>a.value=c),placeholder:"Please input"},null,8,["modelValue"]),e("ul",he,[(h(!0),b(O,null,ae(y.value,c=>(h(),b("li",{key:c,onClick:()=>f("select",c)},[e("div",we,[k(q,{class:"token-icon-30",token1:v(D)(c.chain,c.tokenList[0].address),token2:v(D)(c.chain,c.tokenList[1].address)},null,8,["token1","token2"]),e("div",ge,[e("div",ye,o(c.symbol.toUpperCase()),1),e("div",Ce,o(c.address==v(d).wallet.MAIN_COIN_ADDRESS?" ":v(ie)(c.address,8)),1)])]),e("div",Le,[e("div",be,o(c.amount),1),e("div",$e,o(c.price?`$ ${c.price}`:" "),1)])],8,pe))),128))])],64)}}},Ie=X(Ae,[["__scopeId","data-v-0957714e"]]);const Se={class:"form"},Te={class:"form-item"},Ve={class:"form-item-title"},De={class:"form-item-value"},Ee=["src"],Ne={class:"form-item"},Ue={class:"form-item-title"},xe={class:"form-item-value"},Me={key:0,class:"icon"},Oe={class:"text"},Re={key:1,class:"placeholder"},Be={class:"form-item"},We={class:"form-item-title"},Pe={class:"title-note"},Ye={class:"form-item-value"},Fe={class:"form-item"},Ge={class:"form-item-title"},He={class:"form-item-value"},ze={class:"form-bottom"},je={class:"form-bottom-btns"},qe={class:"dlg-item"},Je={class:"key"},Ke={class:"value"},Qe={class:"text"},Xe={class:"key"},Ze={class:"value"},et={class:"key"},tt={class:"value"},at={class:"key"},ot={class:"value"},st={class:"key"},lt={class:"value"},nt={class:"tips"},it={class:"dlg-bottom"},ct={__name:"Lp",setup(oe){const{t:f}=Z(),i=ee(),S=ce(),_=m(!1),a=m(null),y=m(""),E=F().add(1,"day").endOf("day").toDate(),p=m(E),L=m(!1),N=m(!1),I=m(null),n=m(""),u=te.chainList.filter(t=>!!t.create);j(()=>i.isConnecting,t=>{console.log(t),t&&u.some(l=>l.chainId==i.chainId)&&I.value!=i.chainId&&(I.value=i.chainId,a.value=null)},{immediate:!0});const s=re(()=>I.value?u.find(t=>t.chainId==I.value):null);async function c(t){if(i.isConnecting){if(i.walletType=="metamask"){let l=u.find($=>$.chainId==t);await d.wallet.metamask.switchNetwork(l)}}else w.error(f("pleaseConnectWallet"))}j(()=>[a.value],async()=>{y.value="",a.value?await K():L.value=!1});function R(t){a.value=t,_.value=!1}function B(){if(!i.isConnecting){w.error(f("pleaseConnectWallet"));return}_.value=!0}async function J(){N.value=!0;try{let t=await d.wallet.metamask.approveMaxAmount(a.value.address,i.lock.tokenLockV2Address);console.log(t),await t.wait(),L.value=!1}catch(t){console.log(t);let l=d.wallet.metamask.parseError(t);w.error(f(l))}finally{N.value=!1}}const T=m(!1),H=m(""),W=m(!1);async function K(){if(!a.value)return;if(a.value.address==d.wallet.MAIN_COIN_ADDRESS){L.value=!1;return}await d.wallet.metamask.isAllowanceEnough(i.lock.tokenLockV2Address,a.value.address,i.walletAddress)?L.value=!1:L.value=!0}async function se(){T.value=!0,H.value="";try{if(!a.value){w.error(f("pleaseSelectToken"));return}if(!y.value){w.error(f("enterAmount"));return}if(!p.value){w.error(f("selectUnlockTime"));return}if(a.value.chain!==i.chain){w.error(f("networkNotMatch"));return}if(await K(),L.value){w.error(f("approveFirst"));return}await le()}catch(t){console.log(t)}finally{T.value=!1}}async function le(){const t=await d.wallet.metamask.getGasPrice();let l;const $=F(p.value).endOf("day").unix(),U=a.value.address,x=await(await d.wallet.metamask.contractERC20(U)).decimals(),M=Q(y.value,x);l=await(await d.wallet.metamask.contractTokenLockV2(i.lock.tokenLockV2Address)).lock.estimateGas(i.walletAddress,U,!0,M.toString(),$,""),console.dir(l),n.value=_e(l*t),W.value=!0}const z=m(!1);async function ne(){const t=me.service({lock:!0,text:f("upChainNow")}),l=F(p.value).endOf("day").unix(),$=a.value.address,P=await(await d.wallet.metamask.contractERC20($)).decimals(),x=Q(y.value,P),M=await d.wallet.metamask.contractTokenLockV2(i.lock.tokenLockV2Address);try{let g=await M.lock(i.walletAddress,$,!0,x.toString(),l,"");console.dir(g),H.value=g.hash,z.value=!0,W.value=!1}catch(g){let Y=d.wallet.metamask.parseError(g);w.error(f(Y)),console.log(g)}finally{t.close()}}return(t,l)=>{const $=A("icon-text"),U=A("el-option"),P=A("el-select"),x=A("ArrowDownBold"),M=A("el-icon"),g=A("el-button"),Y=A("el-dialog");return h(),b(O,null,[e("div",Se,[e("div",Te,[e("div",Ve,o(t.$t("selectChain")),1),e("div",De,[k(P,{"model-value":I.value,placeholder:t.$t("pleaseSelectChain"),class:"block",size:"large",onChange:c},{prefix:C(()=>[s.value?(h(),b("img",{key:0,class:"select-icon",src:s.value.chainIcon,alt:""},null,8,Ee)):de("",!0)]),default:C(()=>[(h(!0),b(O,null,ae(v(u),r=>(h(),G(U,{key:r.chainId,label:r.chainShow,value:r.chainId,class:"select-option"},{default:C(()=>[k($,{icon:r.chainIcon,text:r.chainShow},null,8,["icon","text"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value","placeholder"])])]),e("div",Ne,[e("div",Ue,o(t.$t("selectToken")),1),e("div",xe,[e("div",{class:"select",onClick:B},[a.value?(h(),b("div",Me,[k(q,{class:"token-icon-20 image",token1:v(D)(a.value.chain,a.value.tokenList[0].address),token2:v(D)(a.value.chain,a.value.tokenList[1].address)},null,8,["token1","token2"]),e("div",Oe,o(a.value.symbol),1)])):(h(),b("div",Re,o(t.$t("pleaseSelectToken1")),1)),k(M,null,{default:C(()=>[k(x)]),_:1})])])]),e("div",Be,[e("div",We,[e("div",null,o(v(f)("setNumberOfLock")),1),e("div",Pe,o(t.$t("balance"))+": "+o(a.value?a.value.amount:"- -"),1)]),e("div",Ye,[k(ve,{amount:y.value,"onUpdate:amount":l[0]||(l[0]=r=>y.value=r),total:a.value?a.value.amount:"0",decimals:a.value?a.value.decimals:18},null,8,["amount","total","decimals"])])]),e("div",Fe,[e("div",Ge,o(t.$t("setDate")),1),e("div",He,[k(ke,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=r=>p.value=r)},null,8,["modelValue"])])]),e("div",ze,[e("div",je,[v(i).isConnecting?(h(),b(O,{key:0},[L.value?(h(),G(g,{key:0,class:"btn-gradient",onClick:J,loading:N.value},{default:C(()=>[V("Approve")]),_:1},8,["loading"])):(h(),G(g,{key:1,class:"btn-gradient",onClick:se,loading:T.value},{default:C(()=>[V(o(t.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(h(),G(g,{key:1,class:"btn btn-gradient",onClick:l[2]||(l[2]=()=>v(S).loginDialogVisible=!0)},{default:C(()=>[V(o(t.$t("connectWallet")),1)]),_:1}))])])]),k(Y,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=r=>_.value=r),title:t.$t("selectToken"),class:"dlg dlg-select-token","destroy-on-close":""},{default:C(()=>[k(Ie,{onSelect:l[3]||(l[3]=r=>R(r))})]),_:1},8,["modelValue","title"]),k(Y,{modelValue:W.value,"onUpdate:modelValue":l[5]||(l[5]=r=>W.value=r),title:t.$t("lockConfirm"),class:"dlg dlg-lock-confirm"},{default:C(()=>[e("ul",qe,[e("li",null,[e("div",Je,o(t.$t("lockAssets")),1),e("div",Ke,[k(q,{class:"token-icon-20 image",token1:v(D)(a.value.chain,a.value.tokenList[0].address),token2:v(D)(a.value.chain,a.value.tokenList[1].address)},null,8,["token1","token2"]),e("div",Qe,o(a.value.symbol),1)])]),e("li",null,[e("div",Xe,o(t.$t("lockNumber")),1),e("div",Ze,o(y.value),1)]),e("li",null,[e("div",et,o(t.$t("contractChian")),1),e("div",tt,o(v(i).currentChain.chainShow),1)]),e("li",null,[e("div",at,o(t.$t("unlockTime")),1),e("div",ot,[V(o(v(F)(p.value).format("YYYY-MM-DD"))+"(",1),e("span",null,o(t.$t("dayLeft",{day:v(ue)(p.value)})),1),V(")")])]),e("li",null,[e("div",st,o(t.$t("gas")),1),e("div",lt,o(`${n.value} ${v(i).nativeCurrencySymbol}`),1)])]),e("div",nt,[e("p",null,o(t.$t("attention")),1),e("p",null,o(t.$t("createTips1")),1),e("p",null,o(t.$t("createTips2")),1),e("p",null,o(t.$t("createTips3")),1)]),e("div",it,[k(g,{class:"btn-gradient btn-block",onClick:ne},{default:C(()=>[V(o(t.$t("confirmAndLock")),1)]),_:1})])]),_:1},8,["modelValue","title"]),k(fe,{modelValue:z.value,"onUpdate:modelValue":l[6]||(l[6]=r=>z.value=r),txHash:H.value},null,8,["modelValue","txHash"])],64)}}},ht=X(ct,[["__scopeId","data-v-f4b13094"]]);export{ht as default};
