/* empty css                                                          */import{_ as z,h as j,g as q,i as w,b as D,o as h,c as M,d as t,t as n,B as E,l as k,q as B,A as F,f as C,y as Y,F as J,D as P,k as c,E as v,J as $,a2 as Z,z as R,C as H}from"./index-5de81be4.js";import{_ as K}from"./OperateSuccessDialog-3c558dc4.js";import{e as Q}from"./ethers-d80470d8.js";import{S as ee}from"./SelectLockDate-516a5f8c.js";/* empty css                                                                */import{D as X}from"./DoubleToken-a53b3408.js";import{b as x,a as W,f as te}from"./units-262c0d6b.js";const ae={class:"info"},oe={class:"key"},le={class:"value"},ne={class:"key"},se={class:"value"},ce={class:"key"},ie={class:"value"},re={class:"key"},ue={class:"value"},de={class:"dlg-bottom"},ke={__name:"Unlock",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(_,{emit:S}){const e=_,o=j(),{t:s}=q(),a=w(0n),m=w(0),f=w(!1),T=w("");async function A(){const i=await c.wallet.metamask.getGasPrice(),l=await c.wallet.metamask.getBalance(o.walletAddress);console.log("balance",l);let r;if(e.isLockV2){const L=await c.wallet.metamask.contractTokenLockV2(o.lock.tokenLockV2Address);a.value=await L.withdrawFee(),l<a.value&&v.error(s("balanceSlow2",{chainMianCoin:o.nativeCurrencySymbol,amount:x(a.value)})),r=await L.unlock.estimateGas(e.lockId,{value:a.value})}else{const L=await c.wallet.metamask.contractTokenLockV3(o.lock.tokenLockV3Address);a.value=await L.withdrawFee(),l<a.value&&v.error(s("balanceSlow2",{chainMianCoin:o.nativeCurrencySymbol,amount:x(a.value)})),r=await L.unlock.estimateGas(e.lockId,{value:a.value})}console.dir(r),m.value=x(r*i).toString(),console.log(m.value)}async function I(){const i=P.service({lock:!0,text:"Loading..."});if(e.isLockV2)try{const l=await c.wallet.metamask.contractTokenLockV2(o.lock.tokenLockV2Address);a.value=await l.withdrawFee();let r=await l.unlock(e.lockId,{value:a.value});console.dir(r),T.value=r.hash,f.value=!0}catch(l){let r=c.wallet.metamask.parseError(l);v.error(s(r)),console.log(l)}finally{i.close()}else try{const l=await c.wallet.metamask.contractTokenLockV3(o.lock.tokenLockV3Address);a.value=await l.withdrawFee();let r=await l.unlock(e.lockId,{value:a.value});console.dir(r),T.value=r.hash,f.value=!0}catch(l){let r=c.wallet.metamask.parseError(l);v.error(s(r)),console.log(l)}finally{i.close()}}async function N(){if(!o.isConnecting){v.error(s("pleaseConnectWallet")),G();return}const i=P.service({lock:!0,text:"Loading..."});try{await A()}catch(l){console.log(l)}finally{i.close()}}function G(){S("close")}return N(),(i,l)=>{const r=D("icon-text"),L=D("el-button");return h(),M(J,null,[t("ul",ae,[t("li",null,[t("div",oe,n(i.$t("withdrawAssets")),1),t("div",le,[e.isLpToken?(h(),E(X,{key:0,class:"token-icon-20 image",token1:k(B)(e.chain,e.tokenList[0].address),token2:k(B)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(h(),E(r,{key:1,icon:k(B)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),t("li",null,[t("div",ne,n(i.$t("withdrawNumber")),1),t("div",se,[t("span",null,n(i.$t("toBeWithdrawNumber")+": "),1),F(n(_.amountString),1)])]),t("li",null,[t("div",ce,n(i.$t("withdrawFee")),1),t("div",ie,n(`${a.value?k(Q).formatEther(a.value):"--"}
                            ${k(o).nativeCurrencySymbol}`),1)]),t("li",null,[t("div",re,n(i.$t("gas")),1),t("div",ue,n(`${m.value?m.value:"--"} ${k(o).nativeCurrencySymbol}`),1)])]),t("div",de,[C(L,{class:"btn-gradient btn-block",block:"",onClick:I},{default:Y(()=>[F(n(i.$t("withdraw")),1)]),_:1})]),C(K,{show:i.lockSuccessDialog,"onUpdate:show":l[0]||(l[0]=U=>i.lockSuccessDialog=U),txHash:i.lockTxHash,onClose:G},null,8,["show","txHash"])],64)}}},me=z(ke,[["__scopeId","data-v-f3c5454b"]]),Pe={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(_,{emit:S}){const e=_;function o(){S("update:model-value",!1)}return(s,a)=>{const m=D("el-dialog");return h(),E(m,{"model-value":e.modelValue,title:s.$t("withdrawAssets"),class:"dlg","destroy-on-close":"",onClose:o},{default:Y(()=>[C(me,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:_.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:o},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};const ve={key:0,class:"info"},fe={class:"key"},ye={class:"value"},ge={class:"key"},pe={class:"value"},we={class:"blue-font"},_e={class:"key"},he={class:"value"},Le={class:"key"},be={class:"value"},Se={class:"select-date"},Ce={class:"key"},Ve={class:"value"},$e={key:1,class:"change-amount"},De={class:"key"},Te={class:"value"},Ae={class:"dlg-bottom"},Ie={__name:"Edit",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(_,{emit:S}){const e=_,o=j(),{t:s}=q(),a=w(0n),m=w($.unix(e.unlockDate).toDate()),f=w(e.amountString),T=w(""),A=w(""),I=w(!1),N=w("");async function G(){const d=await(await c.wallet.metamask.contractERC20(e.address)).balanceOf(o.walletAddress);T.value=te(d,e.decimals),console.log("value:"+T.value),d==0n&&(v.error(s("balanceSlow")),S("error"))}async function i(){console.log("estimateGas");const u=$.unix(e.unlockDate).add(1,"day").unix(),d=await c.wallet.metamask.getGasPrice(),g=await c.wallet.metamask.getBalance(o.walletAddress);console.log("balance",g);let y;if(e.isLockV2){const p=await c.wallet.metamask.contractTokenLockV2(o.lock.tokenLockV2Address),V=await(await c.wallet.metamask.contractERC20(e.address)).decimals(),O=W(e.amountString,V);a.value=await p.editFee(),g<a.value&&v.error(s("balanceSlow2",{chainMianCoin:o.nativeCurrencySymbol,amount:x(a.value)})),y=await p.editLock.estimateGas(e.lockId,O.toString(),u,{value:a.value})}else{const p=await c.wallet.metamask.contractTokenLockV3(o.lock.tokenLockV3Address);a.value=await p.editFee(),g<a.value&&v.error(s("balanceSlow2",{chainMianCoin:o.nativeCurrencySymbol,amount:x(a.value)})),y=await p.editLock.estimateGas(e.lockId,u,{value:a.value})}console.dir(y),A.value=x(y*d).toString(),console.log(A.value)}function l(){console.log(f.value),(H(f.value).lt(e.amountString)||!f.value)&&(f.value=e.amountString)}async function r(){if(!m.value){v.error(s("selectUnlockTime"));return}if(H(f.value).lt(e.amountString)||!f.value){v.error(s("newLockedAmountLimit"));return}if(H(f.value).minus(e.amountString).gt(H(T.value))){v.error(e.symbol+s("balanceSlow"));return}const u=P.service({lock:!0,text:"Loading..."}),d=$(m.value).unix();if(e.isLockV2){const g=await c.wallet.metamask.contractTokenLockV2(o.lock.tokenLockV2Address),p=await(await c.wallet.metamask.contractERC20(e.address)).decimals(),b=W(f.value,p);console.log(b);try{a.value=await g.editFee();let V=await g.editLock(e.lockId.toString(),b.toString(),d,{value:a.value});console.dir(V),N.value=V.hash,I.value=!0}catch(V){let O=c.wallet.metamask.parseError(V);v.error(s(O)),console.log(V)}finally{u.close()}}else{const g=await c.wallet.metamask.contractTokenLockV3(o.lock.tokenLockV3Address);try{a.value=await g.editFee();let y=await g.editLock(e.lockId.toString(),d,{value:a.value});console.dir(y),N.value=y.hash,I.value=!0}catch(y){let p=c.wallet.metamask.parseError(y);v.error(s(p)),console.log(y)}finally{u.close()}}}async function L(){if(!o.isConnecting){v.error(s("pleaseConnectWallet")),U();return}const u=P.service({lock:!0,text:"Loading..."});try{m.value=$.unix(e.unlockDate).add(1,"day").endOf("day").toDate(),await G(),await i()}catch(d){console.log(d)}finally{u.close()}}function U(){S("close")}return L(),(u,d)=>{const g=D("icon-text"),y=D("el-input"),p=D("el-button");return h(),M(J,null,[e.chain?(h(),M("ul",ve,[t("li",null,[t("div",fe,n(u.$t("lockAssets")),1),t("div",ye,[e.isLpToken?(h(),E(X,{key:0,class:"token-icon-20 image",token1:k(B)(e.chain,e.tokenList[0].address),token2:k(B)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(h(),E(g,{key:1,icon:k(B)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),t("li",null,[t("div",ge,n(u.$t("unlockTime")),1),t("div",pe,[t("span",null,n(k($).unix(e.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[F("("),t("span",we,n(u.$t("dayLeft",{day:k(Z)(k($).unix(e.unlockDate).toDate())})),1),F(")")])])]),t("li",null,[t("div",_e,n(u.$t("editFee")),1),t("div",he,n(`${a.value?k(Q).formatEther(a.value):"--"} ${k(o).nativeCurrencySymbol}`),1)]),t("li",null,[t("div",Le,n(u.$t("gas")),1),t("div",be,n(`${A.value?A.value:"--"} ${k(o).nativeCurrencySymbol}`),1)])])):R("",!0),t("div",Se,[t("div",Ce,n(u.$t("setDelayDate")),1),t("div",Ve,[C(ee,{modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=b=>m.value=b),"min-date":k($).unix(e.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["modelValue","min-date"])])]),e.isLockV2?(h(),M("div",$e,[t("div",De,n(u.$t("newLockedAmount")),1),t("div",Te,[C(y,{size:"large",type:"number",modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=b=>f.value=b),onBlur:l,placeholder:u.$t("pleaseEnter"),clearable:""},null,8,["modelValue","placeholder"])])])):R("",!0),t("div",Ae,[C(p,{class:"btn-gradient btn-block",block:"",onClick:r},{default:Y(()=>[F(n(u.$t("confirmAndLock")),1)]),_:1})]),C(K,{show:I.value,"onUpdate:show":d[2]||(d[2]=b=>I.value=b),txHash:N.value,onClose:U},null,8,["show","txHash"])],64)}}},Be=z(Ie,[["__scopeId","data-v-03f6d952"]]),Ye={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(_,{emit:S}){const e=_;function o(){S("update:model-value",!1)}return(s,a)=>{const m=D("el-dialog");return h(),E(m,{"model-value":e.modelValue,title:s.$t("delayLock"),class:"dlg","destroy-on-close":"",onClose:o},{default:Y(()=>[C(Be,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:_.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:o},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};export{Pe as _,Ye as a};
