import{_ as Q,i as X,u as Z,j as d,C as ee,w as j,k as ne,b as v,e as T,o as _,c as I,h as f,f as e,F as U,g as te,l as $,m as ce,t as l,p as ie,q as re,E as h,s as ue,M as W,v as K,x as b,A as x,y as de,z as A,a9 as me,D as ve}from"./index-2e9eab7e.js";import{I as ke}from"./InputLockNumber-4cd7e032.js";import{S as fe}from"./SelectLockDate-4207bd18.js";import{_ as _e}from"./OperateSuccessDialog-94ff5d37.js";import{T as he}from"./TokenIcon-353e91d3.js";import{f as pe,a as J,b as we}from"./units-8dabf827.js";/* empty css                                                                *//* empty css                                                          */const ge={class:"token-list"},ye=["onClick"],Ce={class:"item-left"},be={class:"item-info"},$e={class:"up"},Le={class:"down"},Te={class:"item-right item-info"},Ie={class:"up"},Ae={class:"down"},Se={__name:"SelectToken",emits:["select"],setup(ae,{emit:k}){const{t:c}=X(),w=Z(),m=d(""),o=d([]),g=d([]),S=ee.chainList.filter(n=>!!n.lock),y=d(S.find(n=>n.chainId==w.chainId)?S.find(n=>n.chainId==w.chainId):S[0]);j(()=>[m.value,o.value],async()=>{g.value=await L()});async function L(){if(console.log("searchTokenListWatch",o.value),m.value)if(m.value.startsWith("0x")){let n=o.value.filter(i=>i.address.toLowerCase()==m.value.toLowerCase());if(n.length==0&&ne(m.value)){let i=await v.wallet.metamask.contractERC20(m.value);const a=m.value.toLowerCase(),r=await i.balanceOf(w.walletAddress),M=await i.decimals(),Y=await i.name(),z=await i.symbol();let F={address:a,amount:Number(pe(r.toString(),M)),chain:w.chain,nativeCurrencySymbol:w.nativeCurrencySymbol,decimals:Number(M),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${w.chain}/${a}.png`,name:Y,price:0,symbol:z,tokenId:`${a}-${w.chain}`,tokenType:0};n.push(F)}return n}else return o.value.filter(n=>n.symbol.toLowerCase().indexOf(m.value.toLowerCase())>-1);else return o.value}async function V(){let n=[];try{const i=await v.debank.getTokenList(w.walletAddress,y.value.chain);for(let a of i.data.data){if(a.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){a.token=v.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(a.token)&&a.value>0&&a.risk_score<60&&a.risk_level>=0&&a.flag!=="blacklist"&&a.symbol!==""){if(a.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;a.flag!="lp"&&n.push({address:a.token.toLowerCase(),tokenId:`${a.token}-${a.chain}`.toLowerCase(),chain:a.chain.toLowerCase(),symbol:a.symbol,decimals:a.decimals,icon:re(a.chain.toLowerCase(),a.token.toLowerCase()),amount:a.value,price:a.current_price_usd,tokenType:0,nativeCurrencySymbol:y.value.nativeCurrency.symbol,name:a.name})}}}catch(i){i&&i.message?h.error(i.message):h.error(c("unknowError")),n=[]}finally{}o.value=n}return V(),(n,i)=>{const a=T("el-input");return _(),I(U,null,[f(a,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=r=>m.value=r),placeholder:"Please input"},null,8,["modelValue"]),e("ul",ge,[(_(!0),I(U,null,te(g.value,r=>(_(),I("li",{key:r,onClick:()=>k("select",r)},[e("div",Ce,[f(he,{class:"token-icon-30",bigIcon:r.icon,smallIcon:$(ce)(r.chain)},null,8,["bigIcon","smallIcon"]),e("div",be,[e("div",$e,l(r.symbol.toUpperCase()),1),e("div",Le,l(r.address==$(v).wallet.MAIN_COIN_ADDRESS?" ":$(ie)(r.address,8)),1)])]),e("div",Te,[e("div",Ie,l(r.amount),1),e("div",Ae,l(r.price?`$ ${r.price}`:" "),1)])],8,ye))),128))])],64)}}},Ve=Q(Se,[["__scopeId","data-v-a1576898"]]);const De={class:"form"},Ee={class:"form-item"},Ne={class:"form-item-title"},xe={class:"form-item-value"},Ue=["src"],Me={class:"form-item"},Oe={class:"form-item-title"},Re={class:"form-item-value"},Be={key:1,class:"placeholder"},We={class:"form-item"},Ye={class:"form-item-title"},ze={class:"title-note"},Fe={class:"form-item-value"},Ge={class:"form-item"},He={class:"form-item-title"},Pe={class:"form-item-value"},je={class:"form-bottom"},qe={class:"form-bottom-btns"},Ke={class:"dlg-item"},Je={class:"key"},Qe={class:"value"},Xe={class:"key"},Ze={class:"value"},et={class:"key"},tt={class:"value"},at={class:"key"},ot={class:"value"},lt={class:"key"},st={class:"value"},nt={class:"tips"},ct={class:"dlg-bottom"},it={__name:"Token",setup(ae){const{t:k}=X(),c=Z(),w=ue(),m=d(!1),o=d(null),g=d(""),S=W().add(1,"day").endOf("day").toDate(),y=d(S),L=d(!1),V=d(!1),n=d(null),i=d(""),a=K(()=>ee.chainList.filter(t=>!!t.lock&&t.isTestChain==c.isTestChain));j(()=>c.isConnecting,t=>{console.log(t),t&&a.value.some(s=>s.chainId==c.chainId)&&n.value!=c.chainId&&(n.value=c.chainId,o.value=null)},{immediate:!0});const r=K(()=>n.value?a.value.find(t=>t.chainId==n.value):null);async function M(t){if(c.isConnecting){if(c.walletType=="metamask"){let s=a.value.find(C=>C.chainId==t);await v.wallet.metamask.switchNetwork(s)}}else h.error(k("pleaseConnectWallet"))}j(()=>[o.value],async()=>{g.value="",o.value?await q():L.value=!1});function Y(t){o.value=t,m.value=!1}function z(){if(!c.isConnecting){h.error(k("pleaseConnectWallet"));return}if(!n.value){h.error(k("pleaseSelectChain"));return}m.value=!0}async function F(){V.value=!0;try{let t=await v.wallet.metamask.approveMaxAmount(o.value.address,c.lock.tokenLockV2Address);console.log(t),await t.wait(),L.value=!1}catch(t){console.log(t);let s=v.wallet.metamask.parseError(t);h.error(k(s))}finally{V.value=!1}}const G=d(!1),H=d(""),O=d(!1);async function q(){if(!o.value)return;if(o.value.address==v.wallet.MAIN_COIN_ADDRESS){L.value=!1;return}await v.wallet.metamask.isAllowanceEnough(c.lock.tokenLockV2Address,o.value.address,c.walletAddress)?L.value=!1:L.value=!0}async function oe(){G.value=!0,H.value="";try{if(!o.value){h.error(k("pleaseSelectToken"));return}if(!g.value){h.error(k("enterAmount"));return}if(!y.value){h.error(k("selectUnlockTime"));return}if(o.value.chain!==c.chain){h.error(k("networkNotMatch"));return}if(await q(),L.value){h.error(k("approveFirst"));return}await le()}catch(t){console.log(t)}finally{G.value=!1}}async function le(){const t=await v.wallet.metamask.getGasPrice();let s;const C=W(y.value).endOf("day").unix(),D=o.value.address,E=await(await v.wallet.metamask.contractERC20(D)).decimals(),N=J(g.value,E);s=await(await v.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address)).lock.estimateGas(c.walletAddress,D,!1,N.toString(),C,""),console.dir(s),i.value=we(s*t),O.value=!0}const P=d(!1);async function se(){const t=ve.service({lock:!0,text:k("upChainNow")}),s=W(y.value).endOf("day").unix(),C=o.value.address,R=await(await v.wallet.metamask.contractERC20(C)).decimals(),E=J(g.value,R),N=await v.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);try{let p=await N.lock(c.walletAddress,C,!1,E.toString(),s,"");console.dir(p),H.value=p.hash,P.value=!0,O.value=!1}catch(p){let B=v.wallet.metamask.parseError(p);h.error(k(B)),console.log(p)}finally{t.close()}}return(t,s)=>{const C=T("icon-text"),D=T("el-option"),R=T("el-select"),E=T("ArrowDownBold"),N=T("el-icon"),p=T("el-button"),B=T("el-dialog");return _(),I(U,null,[e("div",De,[e("div",Ee,[e("div",Ne,l(t.$t("selectChain")),1),e("div",xe,[f(R,{"model-value":n.value,placeholder:t.$t("pleaseSelectChain"),class:"block",size:"large",onChange:M},{prefix:b(()=>[r.value?(_(),I("img",{key:0,class:"select-icon",src:r.value.chainIcon,alt:""},null,8,Ue)):de("",!0)]),default:b(()=>[(_(!0),I(U,null,te(a.value,u=>(_(),x(D,{key:u.chainId,label:u.chainShow,value:u.chainId,class:"select-option"},{default:b(()=>[f(C,{icon:u.chainIcon,text:u.chainShow},null,8,["icon","text"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value","placeholder"])])]),e("div",Me,[e("div",Oe,l(t.$t("selectToken")),1),e("div",Re,[e("div",{class:"select",onClick:z},[o.value?(_(),x(C,{key:0,icon:o.value.icon,text:o.value.symbol},null,8,["icon","text"])):(_(),I("div",Be,l(t.$t("pleaseSelectToken1")),1)),f(N,null,{default:b(()=>[f(E)]),_:1})])])]),e("div",We,[e("div",Ye,[e("div",null,l($(k)("setNumberOfLock")),1),e("div",ze,l(t.$t("balance"))+": "+l(o.value?o.value.amount:"- -"),1)]),e("div",Fe,[f(ke,{amount:g.value,"onUpdate:amount":s[0]||(s[0]=u=>g.value=u),total:o.value?o.value.amount:"0",decimals:o.value?o.value.decimals:18},null,8,["amount","total","decimals"])])]),e("div",Ge,[e("div",He,l(t.$t("setDate")),1),e("div",Pe,[f(fe,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=u=>y.value=u)},null,8,["modelValue"])])]),e("div",je,[e("div",qe,[$(c).isConnecting?(_(),I(U,{key:0},[L.value?(_(),x(p,{key:0,class:"btn-gradient",onClick:F,loading:V.value},{default:b(()=>[A("Approve")]),_:1},8,["loading"])):(_(),x(p,{key:1,class:"btn-gradient",onClick:oe,loading:G.value},{default:b(()=>[A(l(t.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(_(),x(p,{key:1,class:"btn btn-gradient",onClick:s[2]||(s[2]=()=>$(w).loginDialogVisible=!0)},{default:b(()=>[A(l(t.$t("connectWallet")),1)]),_:1}))])])]),f(B,{modelValue:m.value,"onUpdate:modelValue":s[4]||(s[4]=u=>m.value=u),title:t.$t("selectToken"),class:"dlg dlg-select-token","destroy-on-close":""},{default:b(()=>[f(Ve,{onSelect:s[3]||(s[3]=u=>Y(u))})]),_:1},8,["modelValue","title"]),f(B,{modelValue:O.value,"onUpdate:modelValue":s[5]||(s[5]=u=>O.value=u),title:t.$t("lockConfirm"),class:"dlg dlg-lock-confirm"},{default:b(()=>[e("ul",Ke,[e("li",null,[e("div",Je,l(t.$t("lockAssets")),1),e("div",Qe,[f(C,{icon:o.value.icon,text:o.value.symbol},null,8,["icon","text"])])]),e("li",null,[e("div",Xe,l(t.$t("lockNumber")),1),e("div",Ze,l(g.value),1)]),e("li",null,[e("div",et,l(t.$t("contractChian")),1),e("div",tt,l($(c).currentChain.chainShow),1)]),e("li",null,[e("div",at,l(t.$t("unlockTime")),1),e("div",ot,[A(l($(W)(y.value).format("YYYY-MM-DD"))+"(",1),e("span",null,l(t.$t("dayLeft",{day:$(me)(y.value)})),1),A(")")])]),e("li",null,[e("div",lt,l(t.$t("gas")),1),e("div",st,l(`${i.value} ${$(c).nativeCurrencySymbol}`),1)])]),e("div",nt,[e("p",null,l(t.$t("attention")),1),e("p",null,l(t.$t("createTips1")),1),e("p",null,l(t.$t("createTips2")),1),e("p",null,l(t.$t("createTips3")),1)]),e("div",ct,[f(p,{class:"btn-gradient btn-block",onClick:se},{default:b(()=>[A(l(t.$t("confirmAndLock")),1)]),_:1})])]),_:1},8,["modelValue","title"]),f(_e,{modelValue:P.value,"onUpdate:modelValue":s[6]||(s[6]=u=>P.value=u),txHash:H.value},null,8,["modelValue","txHash"])],64)}}},ht=Q(it,[["__scopeId","data-v-7c23b915"]]);export{ht as default};
