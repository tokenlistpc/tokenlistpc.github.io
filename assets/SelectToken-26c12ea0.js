import{_ as Q,f as H,Q as K,d as X,a5 as Y,u as Z,g as p,G as E,D as O,i as ee,r as g,o as u,c as w,a as y,b as o,C as x,t as r,F as T,x as W,j as c,l as S,a6 as te,n as m,m as D,T as N,z as ae,q as M,y as A,I as se,p as oe,J as ne}from"./index-66fccc80.js";import{B as I}from"./bignumber-3e8dfdf6.js";import{f as le}from"./units-ac5af918.js";const ce={class:"body"},ie={class:"content"},re={class:"type"},de={class:"network"},ue={class:"network-list"},ke=["onClick"],he={class:"item-left"},ve={class:"left-content"},me={class:"token-name"},_e={class:"token-address"},fe={class:"token"},pe={class:"left-content"},we={class:"token-name"},Ce={class:"token-address"},ye={class:"item-right"},Le={class:"item-right-left"},be={class:"qty"},ge={class:"amount"},Te={class:"item-right-right"},B="/lockMaster/create",Ie={__name:"SelectToken",setup($e){const $=H();K();const l=X(),L=Y(),{t:U}=Z(),C=p([]),k=p([]),n=p(""),d=p(0);async function z(){if(d.value==0)if(n.value)if(n.value.startsWith("0x")){let e=C.value.filter(s=>s.address.toLowerCase()==n.value.toLowerCase());if(e.length==0&&ne(n.value)){let s=await m.wallet.contractERC20(n.value);const i=n.value.toLowerCase(),v=await s.balanceOf(l.walletAddress),t=await s.decimals(),_=await s.name(),a=await s.symbol();let f={address:i,amount:Number(le(v.toString(),t)),chain:l.chain,chainCoinSymbol:l.chainCoinSymbol,decimals:Number(t),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${l.chain}/${i}.png`,name:_,price:0,symbol:a,tokenId:`${i}-${l.chain}`,tokenType:0};e.push(f)}return e}else return C.value.filter(e=>e.symbol.toLowerCase().indexOf(n.value.toLowerCase())>-1);else return C.value;else if(d.value==1)return n.value?n.value.startsWith("0x")?k.value.filter(e=>e.address.toLowerCase()==n.value.toLowerCase()):k.value.filter(e=>e.symbol.toLowerCase().indexOf(n.value.toLowerCase())>-1):k.value;return[]}const F=p([]);E(()=>[n.value,C.value,d.value],async()=>{F.value=await z()});const b=O.chainList.filter(e=>O[l.dappType].chainList.map(s=>s.chain).some(s=>s==e.chain)),h=p(b.find(e=>e.chain==l.chain)?b.find(e=>e.chain==l.chain):b[0]);async function q(e){h.value.chain!=e.chain&&await m.wallet.switchNetwork(e.chainId)}async function R(){const e=oe({message:"Loading...",forbidClick:!0,duration:0}),s=await m.debank.getTokenList(l.walletAddress,h.value.chain);let i=[],v=[];for(let t of s.data.data){if(t.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){t.token=m.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(t.token)&&t.value>0&&t.risk_score<60&&t.risk_level>=0&&t.flag!=="blacklist"&&t.symbol!==""){if(t.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;t.flag=="lp"?v.push({tokenList:[{address:"",symbol:""},{address:"",symbol:""}],symbol:"",address:t.token.toLowerCase(),tokenId:`${t.token}-${t.chain}`.toLowerCase(),chain:t.chain.toLowerCase(),decimals:t.decimals,amount:t.value,price:t.current_price_usd,hasTokenInfo:!1,tokenType:1,chainCoinSymbol:h.value.nativeCurrency.symbol,name:t.name}):i.push({address:t.token.toLowerCase(),tokenId:`${t.token}-${t.chain}`.toLowerCase(),chain:t.chain.toLowerCase(),symbol:t.symbol,decimals:t.decimals,icon:A(t.chain.toLowerCase(),t.token.toLowerCase()),amount:t.value,price:t.current_price_usd,tokenType:0,chainCoinSymbol:h.value.nativeCurrency.symbol,name:t.name})}}C.value=i,k.value=v,e.close()}E(()=>l.isConnectWallet,async(e,s)=>{e&&await R()});function P(e){L.token=e,L.prevPath.toLowerCase()==B.toLowerCase()?$.back():$.push(B)}function j(){$.push(B)}async function G(){console.log("init",l.isConnectWallet),l.isConnectWallet&&await R()}function V(e){d.value!=e&&(d.value=e,e===1&&J())}async function J(){if(k.value.length!=0){if(h.value.chainId!=l.chainId){te(U("switchTrueChain",{cahin:h.value.chain})),k.value=[];return}for(let e of k.value)if(e.hasTokenInfo==!1){let s=await m.wallet.contractLP(e.address),i=await s.token0(),t=await(await m.wallet.contractERC20(i)).symbol(),_=await s.token1(),f=await(await m.wallet.contractERC20(_)).symbol();e.tokenList[0]={symbol:t.toUpperCase(),address:i.toLowerCase()},e.tokenList[1]={symbol:f.toUpperCase(),address:_.toLowerCase()},e.symbol=`${t}/${f}`}}}return ee(()=>{console.log("onMounted"),G()}),(e,s)=>{const i=g("van-search"),v=g("van-icon"),t=g("van-cell"),_=g("van-list");return u(),w("div",ce,[y(i,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a),shape:"round","show-action":"",placeholder:e.$t("searchTokenContractOrName"),"action-text":e.$t("cancel"),onCancel:j},null,8,["modelValue","placeholder","action-text"]),o("div",ie,[o("div",re,[o("div",{class:x({select:d.value==0}),onClick:s[1]||(s[1]=a=>V(0))},r(e.$t("myToken")),3),o("div",{class:x({select:d.value==1}),onClick:s[2]||(s[2]=a=>V(1))},r(e.$t("myLp")),3)]),o("div",de,[o("ul",ue,[(u(!0),w(T,null,W(c(b),a=>(u(),w("li",{class:x(h.value.chain==a.chain?"network-selected":""),onClick:f=>q(a)},r(a.chain.toUpperCase()),11,ke))),256))])]),o("div",null,[y(_,{"finished-text":e.$t("noMore"),class:"token-list"},{default:S(()=>[(u(!0),w(T,null,W(F.value,a=>(u(),D(t,{class:"item",key:a,onClick:f=>P(a)},{title:S(()=>[o("div",he,[d.value==0?(u(),w(T,{key:0},[y(N,{class:"token-icon-1",tokenIcon:a.icon,chainIcon:c(ae)(a.chain)},null,8,["tokenIcon","chainIcon"]),o("div",ve,[o("div",me,r(a.symbol),1),o("div",_e,r(c(M)(a.address)),1)])],64)):(u(),w(T,{key:1},[o("div",fe,[y(N,{class:"token-icon-2",tokenIcon:c(A)(a.chain,a.tokenList[0].address)},null,8,["tokenIcon"]),y(N,{class:"token-icon-2",tokenIcon:c(A)(a.chain,a.tokenList[1].address)},null,8,["tokenIcon"])]),o("div",pe,[o("div",we,r(a.symbol),1),o("div",Ce,r(c(M)(a.address)),1)])],64))])]),value:S(()=>[o("div",ye,[o("div",Le,[o("div",be,r(c(I)(a.amount).toString().indexOf(".")==-1?c(I)(a.amount):c(I)(a.amount).toFixed(6,1)),1),o("div",ge,"$"+r(c(I)(a.amount).multipliedBy(a.price).toFixed(2,1)),1)]),o("div",Te,[c(L).token&&c(L).token.address==a.address?(u(),D(v,{key:0,name:"success",color:"#3F80F7"})):se("",!0)])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["finished-text"])])])])}}},Ae=Q(Ie,[["__scopeId","data-v-e98ca0d2"]]);export{Ae as default};
