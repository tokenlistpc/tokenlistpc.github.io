import{_ as fe}from"./noData-cd778682.js";import{T as Z}from"./TokenIcon-6ec78b8f.js";import{T as ee,C as ye}from"./CopyText-350d9ffe.js";/* empty css                                                          */import{_ as se,h as ce,g as ie,i as A,b as $,o as u,c as F,d as m,t as y,B as _,l as a,q as B,A as S,f as b,y as w,F as J,D as oe,k as d,E as R,J as Le,a as we,u as ge,x as he,w as Te,G as ve,e as te,z as M,H as _e,I as W,C as ae,m as le,n as be,p as ne,a0 as Q,a1 as Ce}from"./index-c5ffcea4.js";import{_ as Ie}from"./OperateSuccessDialog-b5ac12f7.js";import{e as re}from"./ethers-024b927f.js";import"./SelectLockDate-8c155c30.js";/* empty css                                                                */import{D as Ve}from"./DoubleToken-551e89da.js";import{b as X,f as j}from"./units-833e723c.js";import{_ as Se}from"./Index-770e3029.js";const $e={class:"info"},Ae={class:"key"},De={class:"value"},Ne={class:"key"},Ee={class:"value"},Fe={class:"key"},Ue={class:"value"},Be={class:"key"},xe={class:"value"},ze={class:"dlg-bottom"},Re={__name:"Unlock",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(H,{emit:c}){const e=H,v=ce(),{t:D}=ie(),g=A(0n),C=A(0),x=A(!1),V=A("");async function Y(){const L=await d.wallet.metamask.getGasPrice(),f=await d.wallet.metamask.getBalance(v.walletAddress);console.log("balance",f);let T;if(e.isLockV2){const N=await d.wallet.metamask.contractTokenLockV2(v.lock.tokenLockV2Address);g.value=await N.withdrawFee(),f<g.value&&R.error(D("balanceSlow2",{chainMianCoin:v.nativeCurrencySymbol,amount:X(g.value)})),T=await N.unlock.estimateGas(e.lockId,{value:g.value})}else{const N=await d.wallet.metamask.contractTokenLockV3(v.lock.tokenLockV3Address);g.value=await N.withdrawFee(),f<g.value&&R.error(D("balanceSlow2",{chainMianCoin:v.nativeCurrencySymbol,amount:X(g.value)})),T=await N.unlock.estimateGas(e.lockId,{value:g.value})}console.dir(T),C.value=X(T*L).toString(),console.log(C.value)}async function K(){const L=oe.service({lock:!0,text:"Loading..."});if(e.isLockV2)try{const f=await d.wallet.metamask.contractTokenLockV2(v.lock.tokenLockV2Address);g.value=await f.withdrawFee();let T=await f.unlock(e.lockId,{value:g.value});console.dir(T),V.value=T.hash,x.value=!0}catch(f){let T=d.wallet.metamask.parseError(f);R.error(D(T)),console.log(f)}finally{L.close()}else try{const f=await d.wallet.metamask.contractTokenLockV3(v.lock.tokenLockV3Address);g.value=await f.withdrawFee();let T=await f.unlock(e.lockId,{value:g.value});console.dir(T),V.value=T.hash,x.value=!0}catch(f){let T=d.wallet.metamask.parseError(f);R.error(D(T)),console.log(f)}finally{L.close()}}async function h(){if(!v.isConnecting){R.error(D("pleaseConnectWallet")),z();return}const L=oe.service({lock:!0,text:"Loading..."});try{await Y()}catch(f){console.log(f)}finally{L.close()}}function z(){c("close")}return h(),(L,f)=>{const T=$("icon-text"),N=$("el-button");return u(),F(J,null,[m("ul",$e,[m("li",null,[m("div",Ae,y(L.$t("withdrawAssets")),1),m("div",De,[e.isLpToken?(u(),_(Ve,{key:0,class:"token-icon-20 image",token1:a(B)(e.chain,e.tokenList[0].address),token2:a(B)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(u(),_(T,{key:1,icon:a(B)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),m("li",null,[m("div",Ne,y(L.$t("withdrawNumber")),1),m("div",Ee,[m("span",null,y(L.$t("toBeWithdrawNumber")+": "),1),S(y(H.amountString),1)])]),m("li",null,[m("div",Fe,y(L.$t("withdrawFee")),1),m("div",Ue,y(`${g.value?a(re).formatEther(g.value):"--"}
                            ${a(v).nativeCurrencySymbol}`),1)]),m("li",null,[m("div",Be,y(L.$t("gas")),1),m("div",xe,y(`${C.value?C.value:"--"} ${a(v).nativeCurrencySymbol}`),1)])]),m("div",ze,[b(N,{class:"btn-gradient btn-block",block:"",onClick:K},{default:w(()=>[S(y(L.$t("withdraw")),1)]),_:1})]),b(Ie,{show:L.lockSuccessDialog,"onUpdate:show":f[0]||(f[0]=O=>L.lockSuccessDialog=O),txHash:L.lockTxHash,onClose:z},null,8,["show","txHash"])],64)}}},He=se(Re,[["__scopeId","data-v-f3c5454b"]]),Me={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(H,{emit:c}){const e=H;function v(){c("update:model-value",!1)}return(D,g)=>{const C=$("el-dialog");return u(),_(C,{"model-value":e.modelValue,title:D.$t("withdrawAssets"),class:"dlg","destroy-on-close":"",onClose:v},{default:w(()=>[b(He,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:H.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:v},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}},Ye=Le("list",{state:()=>({lockType:0,tokenType:null,pageSize:5,lockList:[{name:"allLock",pageNumber:1,list:[],loading:!1},{name:"myLock",pageNumber:1,list:[],loading:!1}],searchLockList:{list:[],loading:!1}}),actions:{}});const Pe={class:"lock-master"},Ge={key:1,class:"error"},qe={class:"option"},We={class:"operate"},je={class:"tab"},Je=["onClick"],Ke={key:0,class:"empty"},Oe=["fit"],Qe={class:"info"},Xe={key:1,class:"list"},Ze={class:"unlock-date"},eo={key:0,class:"pagination"},oo={__name:"Index",setup(H){const c=ce(),e=Ye(),{t:v}=ie(),D=we(),g=ge(),C=A(""),x=A(0),V=A(!1),Y=he.chainList.filter(o=>!!o.create);async function K(o){if(console.log(o),o!=c.chainId)try{let n=Y.find(t=>t.chainId==o);await d.wallet.metamask.switchNetwork(n)}catch(n){const t=d.wallet.metamask.parseError(n);R({message:v(t),type:"error"})}}const h=A(null),z=A(!1),L=A(!1);function f(){g.push("/lock/create/token"),console.dir(e)}async function T(){if(V.value=!1,!C.value){e.searchLockList.list=[];return}if(!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(C.value)){e.searchLockList.list=[];return}V.value=!0,e.searchLockList.loading=!0;try{let t,s,r,i,k=[];if(e.tokenType=="lpTokenV3")t=await d.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),i=await t.getLocksForToken(C.value,0n,10000n);else{if(t=await d.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),s=await t.cumulativeLockInfo(C.value),r="0x0000000000000000000000000000000000000000",s.token==r)throw"tokenErr";if(s.factory==r&&e.tokenType!=="token"||s.factory!==r&&e.tokenType!=="lpToken")throw"typeErr";i=await t.getLocksForToken(s.token,0n,10000n),console.log(i)}for(let p of i){let I;e.tokenType=="token"&&s.factory==r?I=await E(p,0):e.tokenType=="lpToken"&&s.factory!==r?I=await E(p,1):e.tokenType=="lpTokenV3"&&(I=await E(p,2)),k.push(I)}e.searchLockList.list=k}catch(t){e.searchLockList.list=[],console.log(t)}finally{e.searchLockList.loading=!1}}function N(o){(V.value?e.searchLockList.loading:e.lockList[e.lockType].loading)||(e.lockType=o,e.lockList[e.lockType].list.length==0&&q())}Te(()=>{var o;return(o=D.params)==null?void 0:o.tokenType},o=>{V.value=!1,C.value="",e.tokenType=o,e.lockType=0;for(let n in e.lockList)e.lockList[n].pageNumber=1,e.lockList[n].list=[],e.lockList[n].loading=!1;q()},{immediate:!0});function O(o){console.log(o);let n="";e.tokenType=="token"?n="/lock/detail/token/"+o.id:e.tokenType=="lpToken"?n="/lock/detail/lpToken/"+o.id:e.tokenType=="lpTokenV3"&&(n="/lock/detail/lpTokenV3/"+o.id),g.push(n)}function q(){e.lockType==0?ue():de()}function ke(){q()}async function ue(){e.lockList[e.lockType].loading=!0;let o=(e.lockList[e.lockType].pageNumber-1)*e.pageSize,n=(e.lockList[e.lockType].pageNumber-1)*e.pageSize+e.pageSize-1;try{let t,s,r=[];if(e.tokenType=="token"){s=await d.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allNormalTokenLockedCount();if(console.log(i),console.log(Number(i)),i==0n)throw"err";x.value=Number(i),t=await s.getCumulativeNormalTokenLockInfo(o,n);for(let k of t)r.push(s.getLocksForToken(k.token,0n,10000n))}else if(e.tokenType=="lpToken"){s=await d.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allLpTokenLockedCount();if(i==0n)throw"err";x.value=Number(i),t=await s.getCumulativeLpTokenLockInfo(o,n);for(let k of t)r.push(s.getLocksForToken(k.token,0n,10000n))}else if(e.tokenType=="lpTokenV3"){s=await d.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address);let i=await s.allTokenLockedCount();if(i==0n)throw"err";x.value=Number(i),t=await s.getAllTokenLockInfo(o,n);for(let k of t)r.push(k)}Promise.all(r).then(i=>{let k=[];if(console.log("resLockTokenArr",i),e.tokenType=="lpTokenV3")for(let p of i)k.push(E(p,2));else for(let p of i)for(let I of p)e.tokenType=="token"?k.push(E(I,0)):e.tokenType=="lpToken"&&k.push(E(I,1));Promise.all(k).then(p=>{console.log("resTokenLockList",p),e.lockList[e.lockType].list=p}).catch(p=>{throw p}).finally(p=>{e.lockList[e.lockType].loading=!1})}).catch(i=>{throw i})}catch{e.lockList[e.lockType].loading=!1}}async function de(){if(!c.isConnecting){R.error(v("pleaseConnectWallet"));return}e.lockList[e.lockType].loading=!0;try{let o,n;e.tokenType=="lpTokenV3"?(n=await d.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),o=await n.locksForUser(c.walletAddress)):(n=await d.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),e.tokenType=="token"?o=await n.normalLocksForUser(c.walletAddress):e.tokenType=="lpToken"&&(o=await n.lpLocksForUser(c.walletAddress))),console.log(o),e.lockList[e.lockType].list=[];for(let t of o){let s;e.tokenType=="token"?s=await E(t,0):e.tokenType=="lpToken"?s=await E(t,1):e.tokenType=="lpTokenV3"&&(s=await E(t,2)),e.lockList[e.lockType].list.push(s)}}catch(o){console.log(o)}finally{e.lockList[e.lockType].loading=!1}}async function E(o,n){let t={};if(t.id=o.id,t.tokenAddress=o.token.toLowerCase(),t.owner=o.owner.toLowerCase(),t.lockDate=W.unix(ae(Number(o.lockDate))).format("YYYY-MM-DD HH:mm:ss"),t.unlockDate=W.unix(ae(Number(o.tgeDate))).format("YYYY-MM-DD HH:mm:ss"),n==0){let s=await d.wallet.metamask.contractERC20(o.token);t.tokenList=[],t.tokenSymbol=await s.symbol(),t.tokenIcon=B(c.chain,o.token.toLowerCase());const r=await s.decimals();t.decimals=r,t.amount=j(o.amount,r),t.unlockedAmount=j(o.unlockedAmount,r)}else if(n==1){let s=await d.wallet.metamask.contractLP(o.token),r=await s.token0(),k=await(await d.wallet.metamask.contractERC20(r)).symbol(),p=await s.token1(),P=await(await d.wallet.metamask.contractERC20(p)).symbol();t.tokenList=[],t.tokenList[0]={symbol:k.toUpperCase(),address:r.toLowerCase(),amount:0},t.tokenList[1]={symbol:P.toUpperCase(),address:p.toLowerCase(),amount:0},t.tokenSymbol=k+"/"+P,t.tokenIcon0=B(c.chain,r.toLowerCase()),t.tokenIcon1=B(c.chain,p.toLowerCase());const U=await s.decimals();t.decimals=U,t.amount=j(o.amount,U),t.unlockedAmount=j(o.unlockedAmount.toString(),U)}else if(n==2){console.log(o.id),t.tokenId=o.tokenId;let r=await(await d.wallet.metamask.contractNFT(o.token)).positions(t.tokenId);console.log(r.token0);let i=r.token0,p=await(await d.wallet.metamask.contractERC20(i)).symbol(),I=r.token1,U=await(await d.wallet.metamask.contractERC20(I)).symbol();t.tokenList=[],t.tokenList[0]={symbol:p.toUpperCase(),address:i.toLowerCase(),amount:0},t.tokenList[1]={symbol:U.toUpperCase(),address:I.toLowerCase(),amount:0},t.tokenSymbol=p+"/"+U,t.tokenIcon0=B(c.chain,i.toLowerCase()),t.tokenIcon1=B(c.chain,I.toLowerCase()),t.liquidity=r.liquidity}return t}function me(o){h.value=o,z.value=!0}function pe(o){h.value=o,L.value=!0}return(o,n)=>{const t=$("el-option"),s=$("el-select"),r=$("el-input"),i=$("el-button"),k=$("el-table-column"),p=$("el-tag"),I=$("el-table"),P=$("el-pagination"),U=ve("loading");return u(),F(J,null,[m("div",Pe,[b(r,{modelValue:C.value,"onUpdate:modelValue":n[0]||(n[0]=l=>C.value=l),placeholder:o.$t("tokenLPToken"),onInput:T,class:"input-with-select",clearable:""},{prepend:w(()=>[b(s,{class:"select-chain","model-value":a(c).chainId?a(c).chainId:" ",onChange:K},{prefix:w(()=>[a(c).isConnecting&&a(c).chain&&a(Y).some(l=>l.chainId==a(c).chainId)?(u(),_(Z,{key:0,class:"token-icon",bigIcon:a(le)(a(c).chain)},null,8,["bigIcon"])):(u(),F("span",Ge,"ERROR"))]),default:w(()=>[(u(!0),F(J,null,te(a(Y),l=>(u(),_(t,{key:l.chainId,label:l.chainShow,value:l.chainId},{default:w(()=>[m("div",qe,[b(Z,{class:"token-icon",bigIcon:a(le)(l.chain.toLowerCase())},null,8,["bigIcon"]),m("span",null,y(l.chainShow),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","placeholder"]),m("div",We,[m("ul",je,[V.value?M("",!0):(u(!0),F(J,{key:0},te(a(e).lockList,(l,G)=>(u(),F("li",{class:be({"tab-item-selected":a(e).lockType==G}),onClick:()=>N(G)},y(o.$t(l.name)),11,Je))),256))]),b(i,{type:"primary",class:"btn-gradient lock",onClick:f},{default:w(()=>[S(y(o.$t("oneKeyLock")),1)]),_:1})]),V.value&&a(e).searchLockList.list.length==0&&!a(e).searchLockList.loading||a(e).lockList[a(e).lockType].list.length==0&&!a(e).lockList[a(e).lockType].loading?(u(),F("div",Ke,[m("img",{style:{width:"80px"},src:fe,fit:o.fit},null,8,Oe),m("div",Qe,[S(y(o.$t("noLockToken"))+"，",1),m("span",{onClick:q,style:{color:"#409eff",cursor:"pointer"}},y(o.$t("refresh")),1)])])):(u(),F("div",Xe,[_e((u(),_(I,{class:"table-mine",data:V.value?a(e).searchLockList.list:a(e).lockList[a(e).lockType].list},{default:w(()=>[b(k,{label:o.$t("tokenName"),width:"180"},{default:w(l=>[a(e).tokenType=="token"?(u(),_(ee,{key:0,class:"token-name",name:l.row.tokenSymbol,bigIcon:l.row.tokenIcon},null,8,["name","bigIcon"])):(u(),_(ee,{key:1,class:"token-name",name:l.row.tokenSymbol,token1:l.row.tokenIcon0,token2:l.row.tokenIcon1},null,8,["name","token1","token2"]))]),_:1},8,["label"]),b(k,{label:o.$t("contractAddress"),width:"140"},{default:w(l=>[b(ye,{text:l.row.tokenAddress,smallText:a(ne)(l.row.tokenAddress)},null,8,["text","smallText"])]),_:1},8,["label"]),a(e).tokenType=="lpTokenV3"?(u(),_(k,{key:0,prop:"amount",label:o.$t("lockNumber"),width:"180"},{default:w(l=>[S(y(a(re).formatEther(l.row.liquidity.toString())),1)]),_:1},8,["label"])):(u(),_(k,{key:1,prop:"amount",label:o.$t("lockNumber"),width:"180"},null,8,["label"])),b(k,{prop:"unlockDate",label:o.$t("unlockTime2")},{default:w(l=>[m("div",Ze,[S(y(l.row.unlockDate)+" ",1),a(Q)(l.row.unlockDate)?(u(),_(p,{key:0,class:"over-time tag",size:"small",type:"info"},{default:w(()=>[S(y(o.$t("expired")),1)]),_:1})):(u(),_(p,{key:1,class:"progress tag",size:"small",type:"info"},{default:w(()=>[S(y(o.$t("dayLeft",{day:a(Ce)(l.row.unlockDate)})),1)]),_:2},1024))])]),_:1},8,["label"]),b(k,{prop:"address",label:o.$t("lockUser"),width:"120"},{default:w(l=>[S(y(a(ne)(l.row.owner)),1)]),_:1},8,["label"]),b(k,{prop:"address",label:o.$t("operate"),width:"150"},{default:w(l=>[b(i,{key:"primary",type:"primary",onClick:G=>O(l.row),link:""},{default:w(()=>[S(y(o.$t("view")),1)]),_:2},1032,["onClick"]),a(Q)(l.row.unlockDate)&&l.row.owner.toLowerCase()==a(c).walletAddress?(u(),_(i,{key:"primary",type:"primary",onClick:G=>me(l.row),link:""},{default:w(()=>[S(y(o.$t("withdraw")),1)]),_:2},1032,["onClick"])):M("",!0),!a(Q)(l.row.unlockDate)&&l.row.owner.toLowerCase()==a(c).walletAddress?(u(),_(i,{key:"primary",type:"primary",onClick:G=>pe(l.row),link:""},{default:w(()=>[S(y(o.$t("edit")),1)]),_:2},1032,["onClick"])):M("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[U,V.value?a(e).searchLockList.loading:a(e).lockList[a(e).lockType].loading]]),V.value?M("",!0):(u(),F("div",eo,[b(P,{background:"",layout:"prev, pager, next",total:x.value,onCurrentChange:ke,"page-size":a(e).pageSize,"current-page":a(e).lockList[a(e).lockType].pageNumber,"onUpdate:currentPage":n[1]||(n[1]=l=>a(e).lockList[a(e).lockType].pageNumber=l)},null,8,["total","page-size","current-page"])]))]))]),z.value?(u(),_(Me,{key:0,modelValue:z.value,"onUpdate:modelValue":n[2]||(n[2]=l=>z.value=l),lockId:h.value.id,isLockV2:a(e).tokenType!=="lpTokenV3",isLpToken:a(e).tokenType!=="token",unlockDate:a(W)(h.value.unlockDate).unix(),tokenList:h.value.tokenList,symbol:h.value.tokenSymbol,address:h.value.tokenAddress,amountString:h.value.amount,chain:a(c).chain,decimals:h.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):M("",!0),L.value?(u(),_(Se,{key:1,modelValue:L.value,"onUpdate:modelValue":n[3]||(n[3]=l=>L.value=l),lockId:h.value.id,isLockV2:a(e).tokenType!=="lpTokenV3",isLpToken:a(e).tokenType!=="token",unlockDate:a(W)(h.value.unlockDate).unix(),tokenList:h.value.tokenList,symbol:h.value.tokenSymbol,address:h.value.tokenAddress,amountString:h.value.amount,chain:a(c).chain,decimals:h.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):M("",!0)],64)}}},fo=se(oo,[["__scopeId","data-v-8f6c007f"]]);export{fo as default};
