import{_ as K,i as q,j as J,r as v,k as Q,z as te,a as R,o as p,c as C,d as f,b as e,F as x,h as j,n as ae,t as s,p as r,v as E,m as c,s as se,E as h,x as oe,K as F,w as A,B as W,e as I,a1 as le,H as ne}from"./index-6217c161.js";import{I as ie}from"./InputLockNumber-e85540f2.js";import{S as ce}from"./SelectLockDate-9ce1d67c.js";import{_ as re}from"./OperateSuccessDialog-a89f4189.js";import{D as Y}from"./DoubleToken-022adc77.js";import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";import{a as z,b as de}from"./units-b1f53ef7.js";/* empty css                                                                */const ue={class:"network"},ve={class:"network-list"},ke=["onClick"],me={class:"token-list"},_e=["onClick"],fe={class:"item-left"},pe={class:"item-info"},he={class:"up"},we={class:"down"},ye={class:"item-right item-info"},ge={class:"up"},Ce={class:"down"},Le={__name:"SelectLp",emits:["select"],setup(X,{emit:w}){const{t:d}=q(),L=J(),m=v([]),t=v(""),y=v([]);Q(()=>[t.value,m.value],async()=>{y.value=await g()});const S=te.chainList.filter(l=>!!l.lock),k=v(S.find(l=>l.chainId==L.chainId)?S.find(l=>l.chainId==L.chainId):S[0]);async function g(){return t.value?t.value.startsWith("0x")?m.value.filter(l=>l.address.toLowerCase()==t.value.toLowerCase()):m.value.filter(l=>l.symbol.toLowerCase().indexOf(t.value.toLowerCase())>-1):m.value}async function N(){let l=[];try{const _=await c.debank.getTokenList(L.walletAddress,k.value.chain);for(let o of _.data.data){if(o.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){o.token=c.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(o.token)&&o.value>0&&o.risk_score<60&&o.risk_level>=0&&o.flag!=="blacklist"&&o.symbol!==""){if(o.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;o.flag=="lp"&&l.push({tokenList:[{address:"",symbol:""},{address:"",symbol:""}],symbol:"",address:o.token.toLowerCase(),tokenId:`${o.token}-${o.chain}`.toLowerCase(),chain:o.chain.toLowerCase(),decimals:o.decimals,amount:o.value,price:o.current_price_usd,hasTokenInfo:!1,tokenType:1,nativeCurrencySymbol:k.value.nativeCurrency.symbol,name:o.name})}}}catch(_){_&&_.message?h.error(_.message):h.error(d("unknowError")),l=[]}finally{}m.value=l,B()}N();async function B(){if(m.value.length!=0){if(k.value.chainId!=L.chainId){h.error(d("switchTrueChain",{cahin:k.value.chain})),m.value=[];return}for(let l of m.value)if(l.hasTokenInfo==!1){let _=await c.wallet.metamask.contractLP(l.address),o=await _.token0(),b=await(await c.wallet.metamask.contractERC20(o)).symbol(),U=await _.token1(),M=await(await c.wallet.metamask.contractERC20(U)).symbol();l.tokenList[0]={symbol:b.toUpperCase(),address:o.toLowerCase()},l.tokenList[1]={symbol:M.toUpperCase(),address:U.toLowerCase()},l.symbol=`${b}/${M}`}}}async function H(l){L.isConnecting&&L.walletType=="metamask"&&k.value.chain!=l.chain&&await c.wallet.metamask.switchNetwork(l.chainId)}return(l,_)=>{const o=R("el-input");return p(),C(x,null,[f(o,{modelValue:t.value,"onUpdate:modelValue":_[0]||(_[0]=n=>t.value=n),placeholder:"Please input"},null,8,["modelValue"]),e("div",ue,[e("ul",ve,[(p(!0),C(x,null,j(r(S),n=>(p(),C("li",{class:ae(k.value.chain==n.chain?"network-selected":""),onClick:b=>H(n)},s(n.chain.toUpperCase()),11,ke))),256))])]),e("ul",me,[(p(!0),C(x,null,j(y.value,n=>(p(),C("li",{onClick:()=>w("select",n)},[e("div",fe,[f(Y,{class:"token-icon-30",token1:r(E)(n.chain,n.tokenList[0].address),token2:r(E)(n.chain,n.tokenList[1].address)},null,8,["token1","token2"]),e("div",pe,[e("div",he,s(n.symbol.toUpperCase()),1),e("div",we,s(n.address==r(c).wallet.MAIN_COIN_ADDRESS?" ":r(se)(n.address,8)),1)])]),e("div",ye,[e("div",ge,s(n.amount),1),e("div",Ce,s(n.price?`$ ${n.price}`:" "),1)])],8,_e))),256))])],64)}}},be=K(Le,[["__scopeId","data-v-83465b1d"]]);const $e={class:"form"},Ae={class:"form-item"},Se={class:"form-item-title"},Te={class:"form-item-value"},Ve={key:0,class:"icon"},De={class:"text"},Ie={key:1,class:"placeholder"},Ee={class:"form-item"},Ne={class:"form-item-title"},Ue={class:"title-note"},Oe={class:"form-item-value"},Re={class:"form-item"},xe={class:"form-item-title"},Be={class:"form-item-value"},Me={class:"form-bottom"},Fe={class:"form-bottom-btns"},He={class:"dlg-item"},Pe={class:"key"},We={class:"value"},Ye={class:"text"},Ge={class:"key"},je={class:"value"},ze={class:"key"},Ke={class:"value"},qe={class:"key"},Je={class:"value"},Qe={class:"key"},Xe={class:"value"},Ze={class:"tips"},et={class:"dlg-bottom"},tt={__name:"Lp",setup(X){const{t:w}=q(),d=J(),L=oe(),m=v(!1),t=v(null),y=v(""),S=F().add(1,"day").endOf("day").toDate(),k=v(S),g=v(!1),N=v(!1),B=v("");Q(()=>[t.value],async()=>{y.value="",t.value?await U():g.value=!1});function H(a){t.value=a,m.value=!1}function l(){if(!d.isConnecting){h.error(w("pleaseConnectWallet"));return}m.value=!0}async function _(){N.value=!0;try{let a=await c.wallet.metamask.approveMaxAmount(t.value.address,d.lock.tokenLockV2Address);console.log(a),await a.wait(),g.value=!1}catch(a){console.log(a);let i=c.wallet.metamask.parseError(a);h.error(w(i))}finally{N.value=!1}}const o=v(!1),n=v(""),b=v(!1);async function U(){if(!t.value)return;if(t.value.address==c.wallet.MAIN_COIN_ADDRESS){g.value=!1;return}await c.wallet.metamask.isAllowanceEnough(d.lock.tokenLockV2Address,t.value.address,d.walletAddress)?g.value=!1:g.value=!0}async function G(){o.value=!0,n.value="";try{if(!t.value){h.error(w("pleaseSelectToken"));return}if(!y.value){h.error(w("enterAmount"));return}if(!k.value){h.error("请选择解锁时间");return}if(t.value.chain!==d.chain){h.error("当前网络与所选不符");return}if(await U(),g.value){h.error(w("approveFirst"));return}await M()}catch(a){console.log(a)}finally{o.value=!1}}async function M(){const a=await c.wallet.metamask.getGasPrice();let i;const T=F(k.value).endOf("day").unix(),O=t.value.address,V=await(await c.wallet.metamask.contractERC20(O)).decimals(),u=z(y.value,V);i=await(await c.wallet.metamask.contractTokenLockV2(d.lock.tokenLockV2Address)).lock.estimateGas(d.walletAddress,O,!0,u.toString(),T,""),console.dir(i),B.value=de(i*a),b.value=!0}const P=v(!1);async function Z(){const a=ne.service({lock:!0,text:w("upChainNow")}),i=F(k.value).endOf("day").unix(),T=t.value.address,$=await(await c.wallet.metamask.contractERC20(T)).decimals(),V=z(y.value,$),u=await c.wallet.metamask.contractTokenLockV2(d.lock.tokenLockV2Address);try{let D=await u.lock(d.walletAddress,T,!0,V.toString(),i,"");console.dir(D),n.value=D.hash,P.value=!0,b.value=!1}catch(D){let ee=c.wallet.metamask.parseError(D);h.error(w(ee)),console.log(D)}finally{a.close()}}return(a,i)=>{const T=R("ArrowDownBold"),O=R("el-icon"),$=R("el-button"),V=R("el-dialog");return p(),C(x,null,[e("div",$e,[e("div",Ae,[e("div",Se,s(a.$t("selectToken")),1),e("div",Te,[e("div",{class:"select",onClick:l},[t.value?(p(),C("div",Ve,[f(Y,{class:"token-icon-20 image",token1:r(E)(t.value.chain,t.value.tokenList[0].address),token2:r(E)(t.value.chain,t.value.tokenList[1].address)},null,8,["token1","token2"]),e("div",De,s(t.value.symbol),1)])):(p(),C("div",Ie,s(a.$t("pleaseSelectToken1")),1)),f(O,null,{default:A(()=>[f(T)]),_:1})])])]),e("div",Ee,[e("div",Ne,[e("div",null,s(r(w)("setNumberOfLock")),1),e("div",Ue,s(a.$t("balance"))+": "+s(t.value?t.value.amount:"- -"),1)]),e("div",Oe,[f(ie,{amount:y.value,"onUpdate:amount":i[0]||(i[0]=u=>y.value=u),total:t.value?t.value.amount:"0",decimals:t.value?t.value.decimals:18},null,8,["amount","total","decimals"])])]),e("div",Re,[e("div",xe,s(a.$t("setDate")),1),e("div",Be,[f(ce,{modelValue:k.value,"onUpdate:modelValue":i[1]||(i[1]=u=>k.value=u)},null,8,["modelValue"])])]),e("div",Me,[e("div",Fe,[r(d).isConnecting?(p(),C(x,{key:0},[g.value?(p(),W($,{key:0,class:"btn-gradient",onClick:_,loading:N.value},{default:A(()=>[I("Approve")]),_:1},8,["loading"])):(p(),W($,{key:1,class:"btn-gradient",onClick:G,loading:o.value},{default:A(()=>[I(s(a.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(p(),W($,{key:1,class:"btn btn-gradient",onClick:i[2]||(i[2]=()=>r(L).loginDialogVisible=!0)},{default:A(()=>[I(s(a.$t("connectWallet")),1)]),_:1}))])])]),f(V,{modelValue:m.value,"onUpdate:modelValue":i[4]||(i[4]=u=>m.value=u),title:a.$t("selectToken"),class:"dlg dlg-select-token","destroy-on-close":""},{default:A(()=>[f(be,{onSelect:i[3]||(i[3]=u=>H(u))})]),_:1},8,["modelValue","title"]),f(V,{modelValue:b.value,"onUpdate:modelValue":i[5]||(i[5]=u=>b.value=u),title:a.$t("lockConfirm"),class:"dlg dlg-lock-confirm"},{default:A(()=>[e("ul",He,[e("li",null,[e("div",Pe,s(a.$t("lockAssets")),1),e("div",We,[f(Y,{class:"token-icon-20 image",token1:r(E)(t.value.chain,t.value.tokenList[0].address),token2:r(E)(t.value.chain,t.value.tokenList[1].address)},null,8,["token1","token2"]),e("div",Ye,s(t.value.symbol),1)])]),e("li",null,[e("div",Ge,s(a.$t("lockNumber")),1),e("div",je,s(y.value),1)]),e("li",null,[e("div",ze,s(a.$t("contractChian")),1),e("div",Ke,s(r(d).chain),1)]),e("li",null,[e("div",qe,s(a.$t("unlockTime")),1),e("div",Je,[I(s(r(F)(k.value).format("YYYY-MM-DD"))+"(",1),e("span",null,s(a.$t("dayLeft",{day:r(le)(k.value)})),1),I(")")])]),e("li",null,[e("div",Qe,s(a.$t("serviceFee")),1),e("div",Xe,s(`${B.value} ${r(d).nativeCurrencySymbol}`),1)])]),e("div",Ze,[e("p",null,"*"+s(a.$t("attention")),1),e("p",null,s(a.$t("createTips1")),1),e("p",null,s(a.$t("createTips2")),1),e("p",null,s(a.$t("createTips3")),1)]),e("div",et,[f($,{class:"btn-gradient btn-block",onClick:Z},{default:A(()=>[I(s(a.$t("confirmAndLock")),1)]),_:1})])]),_:1},8,["modelValue","title"]),f(re,{modelValue:P.value,"onUpdate:modelValue":i[6]||(i[6]=u=>P.value=u),txHash:n.value},null,8,["modelValue","txHash"])],64)}}},dt=K(tt,[["__scopeId","data-v-bb064f43"]]);export{dt as default};
