import{r as D,_ as W,O as K,v as V,P as b,b as $,Q as S,R as w,w as L,S as G,T as H,d as R,o as Q,c as X,g as C,l as O,U as Y,e as F,V as A,W as k,X as Z,Y as j,Z as q,$ as z}from"./index-d07c9b14.js";function J(a){const l=D();function r(){if(a.value==null)return;const{selectionStart:i,selectionEnd:c,value:s}=a.value;if(i==null||c==null)return;const f=s.slice(0,Math.max(0,i)),d=s.slice(Math.max(0,c));l.value={selectionStart:i,selectionEnd:c,value:s,beforeTxt:f,afterTxt:d}}function p(){if(a.value==null||l.value==null)return;const{value:i}=a.value,{beforeTxt:c,afterTxt:s,selectionStart:f}=l.value;if(c==null||s==null||f==null)return;let d=i.length;if(i.endsWith(s))d=i.length-s.length;else if(i.startsWith(c))d=c.length;else{const N=c[f-1],h=i.indexOf(N,f-1);h!==-1&&(d=h+1)}a.value.setSelectionRange(d,d)}return[r,p]}const ee=a=>(j("data-v-f949d2cd"),a=a(),q(),a),te={class:"rate"},ne={class:"value-show"},re=ee(()=>F("div",null,"%",-1)),y="update:modelValue",ue="change",E="input",se={__name:"Rate",props:{modelValue:{type:String,default:""},max:{type:Number,default:100},min:{type:Number,default:0},step:{type:Number,default:1},precision:{type:Number,default:0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:l}){const r=a,p=K();V(()=>p.value),J(p);const i=V(()=>b(r.modelValue)&&r.modelValue<=r.min),c=V(()=>b(r.modelValue)&&r.modelValue>=r.max),s=$({currentValue:r.modelValue,userInput:null}),f=V(()=>{if(s.userInput!==null)return s.userInput;let e=s.currentValue;if(S(e))return"";if(b(e)){if(Number.isNaN(e))return"";w(r.precision)||(e=Number(e).toFixed(r.precision))}return e}),d=(e,t)=>{if(w(t)&&(t=h.value),t===0)return Math.round(e);let n=String(e);const u=n.indexOf(".");if(u===-1||!n.replace(".","").split("")[u+t])return e;const _=n.length;return n.charAt(_-1)==="5"&&(n=`${n.slice(0,Math.max(0,_-1))}6`),Number.parseFloat(Number(n).toFixed(t))},N=e=>{if(S(e))return 0;const t=e.toString(),n=t.indexOf(".");let u=0;return n!==-1&&(u=t.length-n-1),u},h=V(()=>{const e=N(r.step);return w(r.precision)?Math.max(N(r.modelValue),e):(e>r.precision,r.precision)}),P=(e,t=1)=>b(e)?d(e+r.step*t):s.currentValue,T=()=>{if(r.readonly||r.disabled||c.value)return;const e=Number(f.value)||0,t=P(e);x(t),l(E,s.currentValue)},M=()=>{if(r.readonly||r.disabled||i.value)return;const e=Number(f.value)||0,t=P(e,-1);x(t),l(E,s.currentValue)},I=(e,t)=>{const{max:n,min:u,step:v,precision:m,stepStrictly:_,valueOnClear:g}=r;if(n<u)return null;let o=Number(e);if(S(e)||Number.isNaN(o))return null;if(e===""){if(g===null)return null;o=z(g)?{min:u,max:n}[g]:g}return _&&(o=d(Math.round(o/v)*v,m)),w(m)||(o=d(o,m)),(o>n||o<u)&&(o=o>n?n:u,t&&l(y,o)),o},x=(e,t=!0)=>{const n=s.currentValue,u=I(e);if(!t){l(y,u);return}n!==u&&(s.userInput=null,l(y,u),l(ue,u,n),s.currentValue=u)},U=e=>{s.userInput=e;const t=e===""?null:Number(e);l(E,t),x(t,!1)},B=e=>{const t=e!==""?Number(e):0;(b(t)&&!Number.isNaN(t)||e==="")&&x(t),s.userInput=null};return L(()=>r.modelValue,e=>{const t=I(s.userInput),n=I(e,!0);!b(t)&&(!t||t!==n)&&(s.currentValue=n,s.userInput=null)},{immediate:!0}),G(()=>{var v;const{min:e,max:t,modelValue:n}=r,u=(v=p.value)==null?void 0:v.input;if(u.setAttribute("role","spinbutton"),Number.isFinite(t)?u.setAttribute("aria-valuemax",String(t)):u.removeAttribute("aria-valuemax"),Number.isFinite(e)?u.setAttribute("aria-valuemin",String(e)):u.removeAttribute("aria-valuemin"),u.setAttribute("aria-valuenow",String(s.currentValue)),u.setAttribute("aria-disabled",String(r.disabled)),!b(n)&&n!=null){let m=Number(n);Number.isNaN(m)&&(m=null),l(y,m)}}),H(()=>{var t;const e=(t=p.value)==null?void 0:t.input;e==null||e.setAttribute("aria-valuenow",`${s.currentValue}`)}),(e,t)=>{const n=R("el-button"),u=R("el-input");return Q(),X("div",te,[C(n,{icon:O(Y),class:"rate-btn",onClick:M,circle:"",disabled:i.value},null,8,["icon","disabled"]),F("div",ne,[C(u,{class:"ipt-num",ref_key:"input",ref:p,type:"number",step:a.step,"model-value":f.value,readonly:r.readonly,disabled:r.disabled,max:a.max,min:a.min,"validate-event":!1,onWheel:t[0]||(t[0]=A(()=>{},["prevent"])),onKeydown:[k(A(T,["prevent"]),["up"]),k(A(M,["prevent"]),["down"])],onInput:U,onChange:B},null,8,["step","model-value","readonly","disabled","max","min","onKeydown"]),re]),C(n,{icon:O(Z),class:"rate-btn",onClick:T,circle:"",disabled:c.value},null,8,["icon","disabled"])])}}},le=W(se,[["__scopeId","data-v-f949d2cd"]]);export{le as R};
