import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";import{_ as P,j,i as q,r as v,a as V,o as S,c as O,b as e,t as s,B as $,p as f,v as I,d as h,w as F,e as W,F as z,E as g,C as _,H as x,m as d,D as J,G as K}from"./index-6217c161.js";import{_ as Q}from"./OperateSuccessDialog-a89f4189.js";import{e as X}from"./ethers-5ff326a4.js";import"./SelectLockDate-9ce1d67c.js";import{I as Y}from"./InputLockNumber-e85540f2.js";import{D as Z}from"./DoubleToken-022adc77.js";import{a as D,f as E,b as N}from"./units-b1f53ef7.js";const tt=c=>(J("data-v-755780fa"),c=c(),K(),c),et={class:"info"},at={class:"key"},ot={class:"value"},nt={class:"key"},st={class:"value"},lt={class:"key"},ct={class:"value"},it={class:"key"},rt={class:"value"},dt={class:"key"},ut={class:"value"},mt={class:"input-qty"},kt=tt(()=>e("div",{class:"key"},"输入追加锁定金额",-1)),pt={class:"value"},vt={class:"dlg-bottom"},ft={__name:"Append",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(c,{emit:y}){const t=c,n=j(),{t:i}=q(),l=v(0n),u=v(""),k=v(""),w=v(""),b=v(!1),B=v("");async function G(){const a=await(await d.wallet.metamask.contractERC20(t.address)).balanceOf(n.walletAddress);k.value=E(a,t.decimals),console.log("value:"+k.value),a==0n&&(g.error(i("balanceSlow")),y("error"))}async function H(){if(!t.isLockV2)return;const o=await d.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address);l.value=await o.editFee();const a=await d.wallet.metamask.getBalance(n.walletAddress);console.log("balance",a),a<l.value&&g.error(i("balanceSlow2",{chainMianCoin:n.nativeCurrencySymbol,amount:N(l.value)}));const p=await(await d.wallet.metamask.contractERC20(t.address)).decimals(),r=E("1",p),C=_(t.amountString).plus(_(r)).toString(),m=D(C,p),A=await d.wallet.metamask.getGasPrice();let M=await o.editLock.estimateGas(t.lockId.toString(),m.toString(),0n,{value:l.value});w.value=N(M*A).toString()}async function U(){if(!t.isLockV2)return;if(!u.value){g.error(i("enterAmount"));return}if(_(u.value).gt(_(k.value))){g.error(i("balanceSlow"));return}const o=x.service({lock:!0,text:"Loading..."}),a=await d.wallet.metamask.contractTokenLockV2(n.lock.tokenLockV2Address),p=await(await d.wallet.metamask.contractERC20(t.address)).decimals(),r=_(t.amountString).plus(_(u.value)).toString();console.log(r);const C=D(r,p);try{l.value=await a.editFee();let m=await a.editLock(t.lockId.toString(),C.toString(),0n,{value:l.value});console.dir(m),B.value=m.hash,b.value=!0}catch(m){let A=d.wallet.metamask.parseError(m);g.error(i(A)),console.log(m)}finally{o.close()}}async function R(){if(!n.isConnecting){g.error(i("pleaseConnectWallet")),T();return}const o=x.service({lock:!0,text:"Loading..."});try{await G(),await H()}catch(a){console.log(a)}finally{o.close()}}function T(){y("close")}return R(),(o,a)=>{const L=V("icon-text"),p=V("el-button");return S(),O(z,null,[e("ul",et,[e("li",null,[e("div",at,s(o.$t("appendAssets")),1),e("div",ot,[t.isLpToken?(S(),$(Z,{key:0,class:"token-icon-20 image",token1:f(I)(t.chain,t.tokenList[0].address),token2:f(I)(t.chain,t.tokenList[1].address)},null,8,["token1","token2"])):(S(),$(L,{key:1,icon:f(I)(t.chain,t.address),text:t.symbol},null,8,["icon","text"]))])]),e("li",null,[e("div",nt,s(o.$t("currentAmount")),1),e("div",st,s(t.amountString),1)]),e("li",null,[e("div",lt,s(o.$t("balance")),1),e("div",ct,s(`${k.value} ${t.symbol}`),1)]),e("li",null,[e("div",it,s(o.$t("editFee")),1),e("div",rt,s(`${l.value?f(X).formatEther(l.value):"--"} ${f(n).nativeCurrencySymbol}`),1)]),e("li",null,[e("div",dt,s(o.$t("gas")),1),e("div",ut,s(`${w.value?w.value:"--"} ${f(n).nativeCurrencySymbol}`),1)])]),e("div",mt,[kt,e("div",pt,[h(Y,{amount:u.value,"onUpdate:amount":a[0]||(a[0]=r=>u.value=r),total:k.value?k.value:"0",decimals:t.decimals},null,8,["amount","total","decimals"])])]),e("div",vt,[h(p,{class:"btn-gradient btn-block",block:"",onClick:U},{default:F(()=>[W(s(o.$t("confirmAndLock")),1)]),_:1})]),h(Q,{show:b.value,"onUpdate:show":a[1]||(a[1]=r=>b.value=r),txHash:B.value,onClose:T},null,8,["show","txHash"])],64)}}},gt=P(ft,[["__scopeId","data-v-755780fa"]]),At={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(c,{emit:y}){const t=c;function n(){y("update:model-value",!1)}return(i,l)=>{const u=V("el-dialog");return S(),$(u,{"model-value":t.modelValue,title:i.$t("appendLock"),class:"dlg","destroy-on-close":"",onClose:n},{default:F(()=>[h(gt,{lockId:t.lockId,isLockV2:t.isLockV2,isLpToken:t.isLpToken,unlockDate:t.unlockDate,tokenList:t.tokenList,symbol:t.symbol,address:c.address,amountString:t.amountString,chain:t.chain,decimals:t.decimals,onClose:n},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};export{At as _};
