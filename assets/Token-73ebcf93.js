import{_ as G,i as P,j,r as d,z as Z,k as K,l as ee,m,a as E,o as p,c as $,d as f,b as e,F as U,h as Y,n as te,t as s,p as h,q as ae,s as oe,v as se,E as y,x as le,K as R,B as W,w as T,e as D,a1 as ne,H as ce}from"./index-6217c161.js";import{I as ie}from"./InputLockNumber-e85540f2.js";import{S as re}from"./SelectLockDate-9ce1d67c.js";import{_ as ue}from"./OperateSuccessDialog-a89f4189.js";import{T as de}from"./TokenIcon-6f670ab0.js";import{f as me,a as z,b as ve}from"./units-b1f53ef7.js";/* empty css                                                                */import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";const ke={class:"network"},_e={class:"network-list"},fe=["onClick"],pe={class:"token-list"},he=["onClick"],we={class:"item-left"},ge={class:"item-info"},ye={class:"up"},Ce={class:"down"},be={class:"item-right item-info"},$e={class:"up"},Le={class:"down"},Ae={__name:"SelectToken",emits:["select"],setup(q,{emit:w}){const{t:v}=P(),k=j(),u=d(""),a=d([]),g=d([]),S=Z.chainList.filter(n=>!!n.lock),_=d(S.find(n=>n.chainId==k.chainId)?S.find(n=>n.chainId==k.chainId):S[0]);K(()=>[u.value,a.value],async()=>{g.value=await C()});async function C(){if(console.log("searchTokenListWatch",a.value),u.value)if(u.value.startsWith("0x")){let n=a.value.filter(r=>r.address.toLowerCase()==u.value.toLowerCase());if(n.length==0&&ee(u.value)){let r=await m.wallet.metamask.contractERC20(u.value);const o=u.value.toLowerCase(),c=await r.balanceOf(k.walletAddress),L=await r.decimals(),V=await r.name(),B=await r.symbol();let F={address:o,amount:Number(me(c.toString(),L)),chain:k.chain,nativeCurrencySymbol:k.nativeCurrencySymbol,decimals:Number(L),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${k.chain}/${o}.png`,name:V,price:0,symbol:B,tokenId:`${o}-${k.chain}`,tokenType:0};n.push(F)}return n}else return a.value.filter(n=>n.symbol.toLowerCase().indexOf(u.value.toLowerCase())>-1);else return a.value}async function N(n){k.isConnecting&&k.walletType=="metamask"&&_.value.chain!=n.chain&&await m.wallet.metamask.switchNetwork(n.chainId)}async function O(){let n=[];try{const r=await m.debank.getTokenList(k.walletAddress,_.value.chain);for(let o of r.data.data){if(o.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"){o.token=m.wallet.MAIN_COIN_ADDRESS;continue}if(new RegExp("^0x.*$","gi").test(o.token)&&o.value>0&&o.risk_score<60&&o.risk_level>=0&&o.flag!=="blacklist"&&o.symbol!==""){if(o.token=="0xc748673057861a797275cd8a068abb95a902e8de")continue;o.flag!="lp"&&n.push({address:o.token.toLowerCase(),tokenId:`${o.token}-${o.chain}`.toLowerCase(),chain:o.chain.toLowerCase(),symbol:o.symbol,decimals:o.decimals,icon:se(o.chain.toLowerCase(),o.token.toLowerCase()),amount:o.value,price:o.current_price_usd,tokenType:0,nativeCurrencySymbol:_.value.nativeCurrency.symbol,name:o.name})}}}catch(r){r&&r.message?y.error(r.message):y.error(v("unknowError")),n=[]}finally{}a.value=n}return O(),(n,r)=>{const o=E("el-input");return p(),$(U,null,[f(o,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=c=>u.value=c),placeholder:"Please input"},null,8,["modelValue"]),e("div",ke,[e("ul",_e,[(p(!0),$(U,null,Y(h(S),c=>(p(),$("li",{class:te(_.value.chain==c.chain?"network-selected":""),onClick:L=>N(c)},s(c.chain.toUpperCase()),11,fe))),256))])]),e("ul",pe,[(p(!0),$(U,null,Y(g.value,c=>(p(),$("li",{onClick:()=>w("select",c)},[e("div",we,[f(de,{class:"token-icon-30",bigIcon:c.icon,smallIcon:h(ae)(c.chain)},null,8,["bigIcon","smallIcon"]),e("div",ge,[e("div",ye,s(c.symbol.toUpperCase()),1),e("div",Ce,s(c.address==h(m).wallet.MAIN_COIN_ADDRESS?" ":h(oe)(c.address,8)),1)])]),e("div",be,[e("div",$e,s(c.amount),1),e("div",Le,s(c.price?`$ ${c.price}`:" "),1)])],8,he))),256))])],64)}}},Te=G(Ae,[["__scopeId","data-v-5912f53b"]]);const Se={class:"form"},Ve={class:"form-item"},Ie={class:"form-item-title"},De={class:"form-item-value"},Ee={key:1,class:"placeholder"},Ne={class:"form-item"},xe={class:"form-item-title"},Ue={class:"title-note"},Oe={class:"form-item-value"},Be={class:"form-item"},Me={class:"form-item-title"},Re={class:"form-item-value"},We={class:"form-bottom"},Fe={class:"form-bottom-btns"},He={class:"dlg-item"},Ye={class:"key"},ze={class:"value"},Ge={class:"key"},Pe={class:"value"},je={class:"key"},Ke={class:"value"},qe={class:"key"},Je={class:"value"},Qe={class:"key"},Xe={class:"value"},Ze={class:"tips"},et={class:"dlg-bottom"},tt={__name:"Token",setup(q){const{t:w}=P(),v=j(),k=le(),u=d(!1),a=d(null),g=d(""),S=R().add(1,"day").endOf("day").toDate(),_=d(S),C=d(!1),N=d(!1),O=d("");K(()=>[a.value],async()=>{g.value="",a.value?await B():C.value=!1});function n(t){a.value=t,u.value=!1}function r(){if(!v.isConnecting){y.error(w("pleaseConnectWallet"));return}u.value=!0}async function o(){N.value=!0;try{let t=await m.wallet.metamask.approveMaxAmount(a.value.address,v.lock.tokenLockV2Address);console.log(t),await t.wait(),C.value=!1}catch(t){console.log(t);let l=m.wallet.metamask.parseError(t);y.error(w(l))}finally{N.value=!1}}const c=d(!1),L=d(""),V=d(!1);async function B(){if(!a.value)return;if(a.value.address==m.wallet.MAIN_COIN_ADDRESS){C.value=!1;return}await m.wallet.metamask.isAllowanceEnough(v.lock.tokenLockV2Address,a.value.address,v.walletAddress)?C.value=!1:C.value=!0}async function F(){c.value=!0,L.value="";try{if(!a.value){y.error(w("pleaseSelectToken"));return}if(!g.value){y.error(w("enterAmount"));return}if(!_.value){y.error("请选择解锁时间");return}if(a.value.chain!==v.chain){y.error("当前网络与所选不符");return}if(await B(),C.value){y.error(w("approveFirst"));return}await J()}catch(t){console.log(t)}finally{c.value=!1}}async function J(){const t=await m.wallet.metamask.getGasPrice();let l;const A=R(_.value).endOf("day").unix(),x=a.value.address,b=await(await m.wallet.metamask.contractERC20(x)).decimals(),I=z(g.value,b);l=await(await m.wallet.metamask.contractTokenLockV2(v.lock.tokenLockV2Address)).lock.estimateGas(v.walletAddress,x,!1,I.toString(),A,""),console.dir(l),O.value=ve(l*t),V.value=!0}const H=d(!1);async function Q(){const t=ce.service({lock:!0,text:w("upChainNow")}),l=R(_.value).endOf("day").unix(),A=a.value.address,M=await(await m.wallet.metamask.contractERC20(A)).decimals(),b=z(g.value,M),I=await m.wallet.metamask.contractTokenLockV2(v.lock.tokenLockV2Address);try{let i=await I.lock(v.walletAddress,A,!1,b.toString(),l,"");console.dir(i),L.value=i.hash,H.value=!0,V.value=!1}catch(i){let X=m.wallet.metamask.parseError(i);y.error(w(X)),console.log(i)}finally{t.close()}}return(t,l)=>{const A=E("icon-text"),x=E("ArrowDownBold"),M=E("el-icon"),b=E("el-button"),I=E("el-dialog");return p(),$(U,null,[e("div",Se,[e("div",Ve,[e("div",Ie,s(t.$t("selectToken")),1),e("div",De,[e("div",{class:"select",onClick:r},[a.value?(p(),W(A,{key:0,icon:a.value.icon,text:a.value.symbol},null,8,["icon","text"])):(p(),$("div",Ee,s(t.$t("pleaseSelectToken1")),1)),f(M,null,{default:T(()=>[f(x)]),_:1})])])]),e("div",Ne,[e("div",xe,[e("div",null,s(h(w)("setNumberOfLock")),1),e("div",Ue,s(t.$t("balance"))+": "+s(a.value?a.value.amount:"- -"),1)]),e("div",Oe,[f(ie,{amount:g.value,"onUpdate:amount":l[0]||(l[0]=i=>g.value=i),total:a.value?a.value.amount:"0",decimals:a.value?a.value.decimals:18},null,8,["amount","total","decimals"])])]),e("div",Be,[e("div",Me,s(t.$t("setDate")),1),e("div",Re,[f(re,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=i=>_.value=i)},null,8,["modelValue"])])]),e("div",We,[e("div",Fe,[h(v).isConnecting?(p(),$(U,{key:0},[C.value?(p(),W(b,{key:0,class:"btn-gradient",onClick:o,loading:N.value},{default:T(()=>[D("Approve")]),_:1},8,["loading"])):(p(),W(b,{key:1,class:"btn-gradient",onClick:F,loading:c.value},{default:T(()=>[D(s(t.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(p(),W(b,{key:1,class:"btn btn-gradient",onClick:l[2]||(l[2]=()=>h(k).loginDialogVisible=!0)},{default:T(()=>[D(s(t.$t("connectWallet")),1)]),_:1}))])])]),f(I,{modelValue:u.value,"onUpdate:modelValue":l[4]||(l[4]=i=>u.value=i),title:t.$t("selectToken"),class:"dlg dlg-select-token","destroy-on-close":""},{default:T(()=>[f(Te,{onSelect:l[3]||(l[3]=i=>n(i))})]),_:1},8,["modelValue","title"]),f(I,{modelValue:V.value,"onUpdate:modelValue":l[5]||(l[5]=i=>V.value=i),title:t.$t("lockConfirm"),class:"dlg dlg-lock-confirm"},{default:T(()=>[e("ul",He,[e("li",null,[e("div",Ye,s(t.$t("lockAssets")),1),e("div",ze,[f(A,{icon:a.value.icon,text:a.value.symbol},null,8,["icon","text"])])]),e("li",null,[e("div",Ge,s(t.$t("lockNumber")),1),e("div",Pe,s(g.value),1)]),e("li",null,[e("div",je,s(t.$t("contractChian")),1),e("div",Ke,s(h(v).chain),1)]),e("li",null,[e("div",qe,s(t.$t("unlockTime")),1),e("div",Je,[D(s(h(R)(_.value).format("YYYY-MM-DD"))+"(",1),e("span",null,s(t.$t("dayLeft",{day:h(ne)(_.value)})),1),D(")")])]),e("li",null,[e("div",Qe,s(t.$t("serviceFee")),1),e("div",Xe,s(`${O.value} ${h(v).nativeCurrencySymbol}`),1)])]),e("div",Ze,[e("p",null,"*"+s(t.$t("attention")),1),e("p",null,s(t.$t("createTips1")),1),e("p",null,s(t.$t("createTips2")),1),e("p",null,s(t.$t("createTips3")),1)]),e("div",et,[f(b,{class:"btn-gradient btn-block",onClick:Q},{default:T(()=>[D(s(t.$t("confirmAndLock")),1)]),_:1})])]),_:1},8,["modelValue","title"]),f(ue,{modelValue:H.value,"onUpdate:modelValue":l[6]||(l[6]=i=>H.value=i),txHash:L.value},null,8,["modelValue","txHash"])],64)}}},ut=G(tt,[["__scopeId","data-v-7d00aeda"]]);export{ut as default};
