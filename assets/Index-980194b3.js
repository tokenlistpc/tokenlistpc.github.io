import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";import{_ as N,j as G,i as H,r as v,K as f,a as C,o as p,c as $,b as t,t as d,B as x,p as r,v as D,e as S,a1 as M,A as Y,d as L,w as B,F as j,E as y,H as I,m as u}from"./index-18187a1e.js";import{_ as O}from"./OperateSuccessDialog-9793c619.js";import{e as P}from"./ethers-ef601e7a.js";import{S as U}from"./SelectLockDate-80e8b721.js";/* empty css                                                                */import{D as K}from"./DoubleToken-0835ca43.js";import{b as V}from"./units-227812fa.js";const W={key:0,class:"info"},q={class:"key"},z={class:"value"},J={class:"key"},Q={class:"value"},R={class:"blue-font"},X={class:"key"},Z={class:"value"},ee={class:"key"},te={class:"value"},ae={class:"select-date"},oe={class:"key"},le={class:"value"},se={class:"dlg-bottom"},ne={__name:"Delay",props:{lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:["close"],setup(_,{emit:b}){const e=_,s=G(),{t:k}=H(),o=v(0n),m=v(f.unix(e.unlockDate).toDate()),g=v(""),h=v(!1),w=v("");async function A(){console.log("estimateGas");const l=f.unix(e.unlockDate).add(1,"day").unix(),c=await u.wallet.metamask.getGasPrice(),i=await u.wallet.metamask.getBalance(s.walletAddress);console.log("balance",i);let a;if(e.isLockV2){const n=await u.wallet.metamask.contractTokenLockV2(s.lock.tokenLockV2Address);o.value=await n.editFee(),i<o.value&&y.error(k("balanceSlow2",{chainMianCoin:s.nativeCurrencySymbol,amount:V(o.value)})),a=await n.editLock.estimateGas(e.lockId,0n,l,{value:o.value})}else{const n=await u.wallet.metamask.contractTokenLockV3(s.lock.tokenLockV3Address);o.value=await n.editFee(),i<o.value&&y.error(k("balanceSlow2",{chainMianCoin:s.nativeCurrencySymbol,amount:V(o.value)})),a=await n.editLock.estimateGas(e.lockId,l,{value:o.value})}console.dir(a),g.value=V(a*c).toString(),console.log(g.value)}async function E(){if(!m.value){y.error("请选择解锁时间");return}const l=I.service({lock:!0,text:"Loading..."}),c=f(m.value).unix();if(e.isLockV2){const i=await u.wallet.metamask.contractTokenLockV2(s.lock.tokenLockV2Address);try{o.value=await i.editFee();let a=await i.editLock(e.lockId.toString(),0n,c,{value:o.value});console.dir(a),w.value=a.hash,h.value=!0}catch(a){let n=u.wallet.metamask.parseError(a);y.error(k(n)),console.log(a)}finally{l.close()}}else{const i=await u.wallet.metamask.contractTokenLockV3(s.lock.tokenLockV3Address);try{o.value=await i.editFee();let a=await i.editLock(e.lockId.toString(),c,{value:o.value});console.dir(a),w.value=a.hash,h.value=!0}catch(a){let n=u.wallet.metamask.parseError(a);y.error(k(n)),console.log(a)}finally{l.close()}}}async function F(){if(!s.isConnecting){y.error(k("pleaseConnectWallet")),T();return}const l=I.service({lock:!0,text:"Loading..."});try{m.value=f.unix(e.unlockDate).add(1,"day").endOf("day").toDate(),await A()}catch(c){console.log(c)}finally{l.close()}}function T(){b("close")}return F(),(l,c)=>{const i=C("icon-text"),a=C("el-button");return p(),$(j,null,[e.chain?(p(),$("ul",W,[t("li",null,[t("div",q,d(l.$t("lockAssets")),1),t("div",z,[e.isLpToken?(p(),x(K,{key:0,class:"token-icon-20 image",token1:r(D)(e.chain,e.tokenList[0].address),token2:r(D)(e.chain,e.tokenList[1].address)},null,8,["token1","token2"])):(p(),x(i,{key:1,icon:r(D)(e.chain,e.address),text:e.symbol},null,8,["icon","text"]))])]),t("li",null,[t("div",J,d(l.$t("unlockTime")),1),t("div",Q,[t("span",null,d(r(f).unix(e.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[S("("),t("span",R,d(l.$t("dayLeft",{day:r(M)(r(f).unix(e.unlockDate).toDate())})),1),S(")")])])]),t("li",null,[t("div",X,d(l.$t("editFee")),1),t("div",Z,d(`${o.value?r(P).formatEther(o.value):"--"} ${r(s).nativeCurrencySymbol}`),1)]),t("li",null,[t("div",ee,d(l.$t("gas")),1),t("div",te,d(`${g.value?g.value:"--"} ${r(s).nativeCurrencySymbol}`),1)])])):Y("",!0),t("div",ae,[t("div",oe,d(l.$t("setDelayDate")),1),t("div",le,[L(U,{modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=n=>m.value=n),"min-date":r(f).unix(e.unlockDate).add(1,"day").endOf("day").toDate()},null,8,["modelValue","min-date"])])]),t("div",se,[L(a,{class:"btn-gradient btn-block",block:"",onClick:E},{default:B(()=>[S(d(l.$t("confirmAndLock")),1)]),_:1})]),L(O,{show:h.value,"onUpdate:show":c[1]||(c[1]=n=>h.value=n),txHash:w.value,onClose:T},null,8,["show","txHash"])],64)}}},ce=N(ne,[["__scopeId","data-v-febf6b22"]]),ve={__name:"Index",props:{modelValue:{type:Boolean,default:!1},lockId:{type:String,default:""},isLockV2:{type:Boolean,default:!1},isLpToken:{type:Boolean,default:!1},unlockDate:Number,tokenList:Array,symbol:{type:String,default:""},address:{type:String,default:""},amountString:{type:String,default:""},chain:{type:String,default:""},decimals:{type:Number,default:18}},emits:"update:model-value",setup(_,{emit:b}){const e=_;function s(){b("update:model-value",!1)}return(k,o)=>{const m=C("el-dialog");return p(),x(m,{"model-value":e.modelValue,title:k.$t("delayLock"),class:"dlg","destroy-on-close":"",onClose:s},{default:B(()=>[L(ce,{lockId:e.lockId,isLockV2:e.isLockV2,isLpToken:e.isLpToken,unlockDate:e.unlockDate,tokenList:e.tokenList,symbol:e.symbol,address:_.address,amountString:e.amountString,chain:e.chain,decimals:e.decimals,onClose:s},null,8,["lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])]),_:1},8,["model-value","title"])}}};export{ve as _};
