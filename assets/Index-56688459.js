import{_ as Y,u as z,d as H,e as O,f as P,g as I,h as q,i as E,r as m,o as c,c as v,b as n,j as o,a as i,t as r,w as F,k as u,l as y,m as D,F as N,s as G,n as $,p as J,q as S,v as V,x as K,T as Q,y as X,z as Z,A,B as ee,C as h,D as te}from"./index-66fccc80.js";import{u as oe}from"./create-b0eba103.js";import{D as se}from"./DropDown-a4673555.js";const ne={class:"token-create"},ae={class:"tools-bar"},le={class:"left"},re={key:0,class:"address"},ie={class:"address-text"},ce={style:{"margin-left":"6px"}},de={class:"tools"},ue={class:"token-box"},pe={class:"token"},ge={class:"title"},ve=["onClick"],fe={class:"content"},ke={class:"name"},me={class:"create-time"},ye={key:1,class:"no-data"},he={class:"text"},_e={class:"bottom-operate"},we={class:"content"},Ce={__name:"Index",setup($e){const{t:W}=z(),a=H(),p=O(),R=oe(),L=P(),g=I(0),_=I(10),l=q({pageNumber:0,tokenList:[],loading:!1,finished:!1,error:!1,refreshing:!1}),w=I(!1);function M(){R.$reset(),L.push("/createToken/create/Detail")}async function x(){a.walletAddress||G(W("pleaseConnectWallet"));try{let t;p.v2?t=await $.wallet.contractTokenFactoryV2(p.tokenFactoryV2Address):t=await $.wallet.contractTokenFactory(p.tokenFactoryAddress);let e=await t.totalOwnRecordsForUser(a.walletAddress);g.value=Number(e)}catch(t){console.error(t)}finally{l.refreshing=!1}}async function b(){l.loading=!0;let t=J({duration:0});try{let e=g.value-(l.pageNumber*_.value+_.value),T=g.value-l.pageNumber*_.value-1;e<0&&(e=0);let f;p.v2?f=await $.wallet.contractTokenFactoryV2(p.tokenFactoryV2Address):f=await $.wallet.contractTokenFactory(p.tokenFactoryAddress);let C=await f.getOwnRecords(a.walletAddress,e.toString(),T.toString()),k=[];for(let d of C){let s={tokenAddress:d[6].toLowerCase(),createTime:Number(d[0]),symbol:d[4],name:d[3],deployerId:Number(d[5])};k.unshift(s)}l.tokenList=l.tokenList.concat(k),C.length<_.value||e==0?l.finished=!0:l.pageNumber++}catch(e){l.error=!0,console.log(e)}finally{t.close(),l.loading=!1,l.refreshing=!1}}async function U(){l.pageNumber=0,l.tokenList=[],l.finished=!1,await x(),g.value>0&&(console.log(g.value),b())}function j(t,e){L.push("/createToken/manage/"+t+"/"+e)}return E(()=>{let t=setInterval(async()=>{a.isConnectWallet&&(clearInterval(t),await x(),g.value>0&&b())},100)}),(t,e)=>{const T=m("van-list"),f=m("van-image"),C=m("van-pull-refresh"),k=m("van-button"),d=m("van-dialog");return c(),v(N,null,[n("div",ne,[n("div",ae,[n("div",le,[n("div",{onClick:e[0]||(e[0]=s=>o(a).showSelectDapp=!0)},[i(u,{class:"icon",name:"menu"})]),o(a).isConnectWallet?(c(),v("div",re,[i(se,{class:"switch-chain",onClick:e[1]||(e[1]=s=>o(a).showSelectChainPopup=!0),error:!o(a).chainId,logo:o(a).chainIcon,value:o(a).chain.toUpperCase()},null,8,["error","logo","value"]),n("div",ie,r(o(S)(o(a).walletAddress)),1),i(u,{class:"copy-icon",name:"copy",onClick:e[2]||(e[2]=F(s=>o(V)(o(a).walletAddress),["stop"]))})])):(c(),v("div",{key:1,class:"address",onClick:e[3]||(e[3]=(...s)=>o(a).connectWallet&&o(a).connectWallet(...s))},[i(u,{class:"icon",name:"wallet"}),n("div",ce,r(t.$t("pleaseConnectWallet")),1)]))]),n("div",de,[i(u,{class:"icon",name:"language",onClick:e[4]||(e[4]=s=>o(a).showLanguagePicker=!0)}),i(u,{class:"icon",name:"help",onClick:e[5]||(e[5]=s=>w.value=!0)})])]),n("div",ue,[n("div",pe,[n("div",ge,r(t.$t("myToken")),1),i(C,{modelValue:l.refreshing,"onUpdate:modelValue":e[9]||(e[9]=s=>l.refreshing=s),"pulling-text":t.$t("pulling"),"loosing-text":t.$t("loosing"),"loading-text":t.$t("loading"),onRefresh:U},{default:y(()=>[l.tokenList.length>0?(c(),D(T,{key:0,class:"token-list","loading-text":t.$t("loading"),loading:l.loading,"onUpdate:loading":e[6]||(e[6]=s=>l.loading=s),finished:l.finished,"finished-text":t.$t("noMore"),error:l.error,"onUpdate:error":e[7]||(e[7]=s=>l.error=s),"error-text":t.$t("errorText"),onLoad:e[8]||(e[8]=s=>b())},{default:y(()=>[(c(!0),v(N,null,K(l.tokenList,s=>(c(),v("div",{class:"item",onClick:B=>j(s.deployerId,s.tokenAddress)},[n("div",null,[i(Q,{class:"token-icon",tokenIcon:o(X)(o(a).chain.toLowerCase(),s.tokenAddress.toLowerCase()),chainIcon:o(Z)(o(a).chain.toLowerCase())},null,8,["tokenIcon","chainIcon"]),n("div",fe,[n("div",ke,[n("span",null,r(s.symbol),1),n("span",null,"（"+r(s.name)+"）",1)]),n("div",null,[A(r(o(S)(s.tokenAddress))+" ",1),i(u,{class:"copy-icon",name:"copy",onClick:F(B=>o(V)(s.tokenAddress),["stop"])},null,8,["onClick"])]),n("div",me,r(o(ee).unix(s.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),n("div",null,[i(u,{class:"image",name:"arrow"})])],8,ve))),256))]),_:1},8,["loading-text","loading","finished","finished-text","error","error-text"])):(c(),v("div",ye,[i(f,{class:"image",src:"/assets/images/warn.png"}),n("div",he,r(t.$t("noToken")),1)]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])])]),n("div",_e,[o(a).isConnectWallet?(c(),D(k,{key:0,type:"primary",round:"",block:"",class:"btn",onClick:M},{default:y(()=>[A(r(t.$t("createToken")),1)]),_:1})):(c(),D(k,{key:1,type:"primary",round:"",block:"",class:"btn",onClick:o(a).connectWallet},{default:y(()=>[A(r(t.$t("connectWallet")),1)]),_:1},8,["onClick"]))])]),i(d,{class:"help-dialog",show:w.value,title:t.$t("rulesDescription"),"confirm-button-text":t.$t("understand"),onConfirm:e[10]||(e[10]=s=>w.value=!1),onClose:e[11]||(e[11]=s=>w.value=!1),"close-on-click-overlay":""},{default:y(()=>[n("div",we,[n("div",{class:h(o(a).language)},r(t.$t("rulesDescription1",{chains:o(te)[o(a).dappType].chainList.map(s=>s.chain.toUpperCase()).join("/")})),3),n("div",{class:h(o(a).language)},r(t.$t("rulesDescription2")),3),n("div",{class:h(o(a).language)},r(t.$t("rulesDescription3")),3),n("div",{class:h(o(a).language)},r(t.$t("rulesDescription4")),3),n("div",{class:h(o(a).language)},r(t.$t("rulesDescription5")),3)])]),_:1},8,["show","title","confirm-button-text"])],64)}}},De=Y(Ce,[["__scopeId","data-v-c4b910b4"]]);export{De as default};
