import{S as Ce}from"./Step-43fc8bf2.js";import{T as Se}from"./TokenIcon-7ae3eded.js";import{_ as ue,h as pe,i as he,r as m,w as ge,j as Le,k,d as I,o as d,c as f,g as h,e,F as B,f as Z,l as j,m as Te,t as s,p as Ve,E as p,q as Be,b as ke,v as ee,a5 as Ee,u as Ie,B as G,y as V,z as ve,C as L,D as fe,J as Ne,A as P,n as Re}from"./index-d569c10e.js";import{f as re,a as z,b as _e}from"./units-a0f6f30a.js";import{u as Fe}from"./index-fbd5292f.js";import{W as De}from"./wallet-7e2146d7.js";/* empty css                                                          */const Me={class:"token-list"},Oe=["onClick"],Ue={class:"item-left"},We={class:"item-info"},Ge={class:"up"},Pe={class:"down"},je={class:"item-right item-info"},qe={class:"up"},xe={class:"down"},ze={__name:"SelectToken",emits:["select"],setup(de,{emit:v}){const{t:y}=pe(),_=he(),C=m(""),T=m([]),w=m([]);ge(()=>[C.value,T.value],async()=>{w.value=await N()});async function N(){if(C.value)if(C.value.startsWith("0x")){let g=T.value.filter(c=>c.address.toLowerCase()==C.value.toLowerCase());if(g.length==0&&Le(C.value)){let c=await k.wallet.metamask.contractERC20(C.value);const l=C.value.toLowerCase(),i=await c.balanceOf(_.walletAddress),b=await c.decimals(),D=await c.name(),o=await c.symbol();let R={address:l,tokenId:`${l}-${_.chain}`.toLowerCase(),chain:_.chain,symbol:o,decimals:Number(b),icon:`https://ave.s3.ap-east-1.amazonaws.com/token_icon/${_.chain}/${l}.png`,amount:Number(re(i.toString(),b)),name:D,price:0};console.log(R),g.push(R)}return g}else return T.value.filter(g=>g.symbol.toLowerCase().indexOf(C.value.toLowerCase())>-1);else return T.value}async function H(){if(!_.isConnecting){p.error(y("connectWalletWarn"));return}try{const g=await k.debank.getTokenList(_.walletAddress,_.chain);let c=[];for(let l of g.data.data)l.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(l.token=k.wallet.MAIN_COIN_ADDRESS),new RegExp("^0x.*$","gi").test(l.token)&&l.value>0&&l.risk_score<60&&l.risk_level>=0&&l.flag!=="blacklist"&&l.symbol!==""&&l.flag!=="lp"&&c.push({address:l.token.toLowerCase(),tokenId:`${l.token}-${l.chain}`.toLowerCase(),chain:l.chain.toLowerCase(),symbol:l.symbol,decimals:l.decimals,icon:Be(l.chain.toLowerCase(),l.token.toLowerCase()),amount:l.value,price:l.current_price_usd});T.value=c}catch(g){g&&g.message?p.error(g.message):p.error(y("unknowError"))}finally{}}return H(),(g,c)=>{const l=I("el-input");return d(),f(B,null,[h(l,{modelValue:C.value,"onUpdate:modelValue":c[0]||(c[0]=i=>C.value=i),placeholder:g.$t("pleaseEnterTokenAddress")},null,8,["modelValue","placeholder"]),e("ul",Me,[(d(!0),f(B,null,Z(w.value,i=>(d(),f("li",{key:i,onClick:()=>v("select",i)},[e("div",Ue,[h(Se,{class:"token-icon-30",bigIcon:i.icon,smallIcon:j(Te)(i.chain)},null,8,["bigIcon","smallIcon"]),e("div",We,[e("div",Ge,s(i.symbol),1),e("div",Pe,s(i.address==j(k).wallet.MAIN_COIN_ADDRESS?" ":j(Ve)(i.address,8)),1)])]),e("div",je,[e("div",qe,s(i.amount),1),e("div",xe,s(i.price?`$ ${i.price}`:" "),1)])],8,Oe))),128))])],64)}}},He=ue(ze,[["__scopeId","data-v-d4d4d861"]]);const Qe={class:"box"},Je=["value"],Ke={class:"index"},Xe={class:"content"},Ye={__name:"InputAddressList",emits:["iptChange"],setup(de,{emit:v}){const y=ke({isCustom:!1,addressList:[]}),_=ee(()=>{let c=[];for(let l=0;l<y.addressList.length;l++){const i=y.addressList[l];y.isCustom?c.push(`${i.address},${i.amountString}`):c.push(i.address)}return c}),C=ee(()=>_.value.join(`
`)),T=m(null),w=m(!1);async function N(){w.value=!0,await Ee(),T==null||T.value.focus()}function H(c){console.log("onBlurCapture"),console.log(c.target.value),w.value=!1}function g(c){const l=c.target.value,i=/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/;let b=!1,D=l.replace(/\s+/ig," ").trim();if(D){let o=D.split(" ");D.indexOf(",")>-1&&(b=!0);const R=[];for(let Q=0;Q<o.length;Q++){let q=o[Q];if(!q||!i.test(q))continue;let J="",K="";if(b==!0){let M=q.split(",");J=M[0],M.length>1?K=M[1]:K="0"}else J=q;R.push({address:J,amountString:K})}y.isCustom=b,y.addressList=R}else y.isCustom=!1,y.addressList=[];console.log("emit",y.isCustom,y.addressList),v("iptChange",y.isCustom,y.addressList)}return(c,l)=>(d(),f("div",Qe,[w.value?(d(),f("textarea",{key:0,class:"ipt",ref_key:"ipt",ref:T,onBlurCapture:H,value:C.value,onChange:g},null,40,Je)):(d(),f("div",{key:1,class:"table",onClick:N},[(d(!0),f(B,null,Z(_.value,(i,b)=>(d(),f("li",{key:b},[e("div",Ke,s(b+1),1),e("div",Xe,s(i),1)]))),128))]))]))}},Ze=ue(Ye,[["__scopeId","data-v-b47f7bc7"]]);const et={class:"form"},tt={class:"form-item"},st={class:"form-item-title"},at={class:"form-item-value"},lt={key:1,class:"placeholder"},ot={class:"form-item"},nt={class:"form-item-title"},it={class:"form-item-value"},rt={class:"form-item address-list"},ut={class:"form-item-title"},dt={class:"clear"},ct={class:"form-item-value"},mt={class:"address-list-tips"},vt={class:"form-item rule"},ft={class:"form-item-title"},_t={class:"form-item-value"},pt={key:0,class:"form-item"},ht={class:"form-item-title"},gt={class:"form-item-value"},kt={key:0,class:"form-item"},yt={class:"form-item-title"},wt={class:"form-item-value"},bt={key:1,class:"form-item"},At={class:"form-item-title"},$t={class:"form-item-value"},Ct={class:"form-item"},St={class:"form-item-title"},Lt={class:"form-item-value"},Tt={class:"form-item"},Vt={class:"form-item-title"},Bt={class:"form-item-value"},Et={class:"form-bottom"},It={class:"form-bottom-btns"},Nt={class:"info"},Rt={class:"info-item"},Ft={class:"info-key"},Dt={class:"info-value"},Mt={class:"info-item"},Ot={class:"info-key"},Ut={class:"info-value"},Wt={class:"info-item"},Gt={class:"info-key"},Pt={class:"info-value"},jt={class:"info-item"},qt={class:"info-key"},xt={class:"info-value"},zt={class:"info-item"},Ht={class:"info-key"},Qt={class:"info-value"},Jt={class:"info-item"},Kt={class:"info-key"},Xt={class:"info-value"},Yt={class:"form-item"},Zt={class:"form-item-title"},es={class:"form-item-value"},ts={class:"receiving-address"},ss={class:"address"},as={class:"form-bottom"},ls={class:"form-bottom-btns"},os={key:2,class:"create-success"},ns={class:"text"},is={__name:"Multi",setup(de){const{t:v}=pe(),y=Ie(),_=he(),C=Fe(),T=ke(["ready","confirm","multiTransfer"]),w=m(0),N=m(0),H=m([{name:"customTransfer",value:0},{name:"randomAddress",value:1}]),g=m([{name:"dividedEquallyByTotal",value:0},{name:"eachAddressEqual",value:1}]),c=m(0),l=m(!1),i=m([]),b=m(!1),D=m(!1),o=m(null),R=m(!1);async function Q(t){if(o.value=t,R.value=!1,o.value.address==k.wallet.MAIN_COIN_ADDRESS){b.value=!1;return}await k.wallet.metamask.isAllowanceEnough(_.transfer.multiSenderAddress,o.value.address,_.walletAddress)?b.value=!1:b.value=!0}async function q(){D.value=!0;try{let t=await k.wallet.metamask.approveMaxAmount(o.value.address,_.transfer.multiSenderAddress);console.log(t),await t.wait(),b.value=!1}catch(t){console.log(t);let a=k.wallet.metamask.parseError(t);p.error(v(a))}finally{D.value=!1}}function J(){R.value=!0}function K(t,a){l.value=t,i.value=a}const M=m(""),te=m(""),ce=ee(()=>{if(N.value==0&&l.value){let t=L(0);for(let a=0;a<i.value.length;a++){const $=i.value[a];t=t.plus(L($.amountString))}return t.toNumber()}return 0}),X=m(""),Y=m(""),A=m([]),le=m(0),se=m(0),ae=m(0),oe=m(0),ne=m(0),me=ee(()=>L(se.value).plus(ae.value).toNumber()),ye=ee(()=>ne.value<me.value);ge(()=>[A.value,w.value,o.value],async()=>{if(console.log("watch watch watch"),w.value==1&&A.value.length>0&&o.value){const t=fe.service({lock:!0,text:v("estimatingGas")});try{let a=await k.wallet.metamask.getBalance(_.walletAddress);ne.value=L(_e(a)).toNumber();const $=await k.wallet.metamask.contractMultiTransfer(_.transfer.multiSenderAddress);let F=L(0),r=[],n=[];for(let W=0;W<A.value.length;W++){const u=A.value[W];F=F.plus(L(u.amountString)),r.push(u.address),n.push(z(u.amountString,o.value.decimals))}le.value=F.toNumber();const S=await $.getFee(A.value.length);ae.value=re(S,o.value.decimals);let O=S;o.value.address==k.wallet.MAIN_COIN_ADDRESS&&(O=S+z(F.toString(),o.value.decimals));const U=await k.wallet.metamask.getGasPrice();let E=await $.multiSend.estimateGas(o.value.address,r,n,{value:O})*2n;se.value=_e(E*U);const x=await $.multiSend.staticCall(o.value.address,r,n,{value:O});oe.value=re(x,o.value.decimals)}catch(a){console.dir(a);let $=k.wallet.metamask.parseError(a);p.error(v($))}finally{t.close()}}else se.value=0,ae.value=0,le.value=0,oe.value=0},{deep:!0});async function we(){if(!o.value){p.error(v("pleaseSelectToken1"));return}if(N.value==0){if(i.value.length===0){p.error(v("enterTransferAddress"));return}if(i.value.length>400){p.error(v("numOfAddressLimit"));return}if(!l.value){if(c.value==0){if(!te.value){p.error(v("enterTransferAmount"));return}}else if(!M.value){p.error(v("enterTransferAmount"));return}}}else{if(!X.value){p.error(v("pleaseEnterNumOfaddress"));return}let r=L(X.value).toNumber();if(r<=0){p.error(v("pleaseEnterNumOfaddress"));return}if(r>400){p.error(v("numOfAddressLimit"));return}if(!Y.value){p.error(v("pleaseEnterAmount"));return}if(L(Y.value).toNumber()<=0){p.error(v("pleaseEnterCorrectAmount"));return}}const t=[];if(N.value==0)if(l.value)for(let r=0;r<i.value.length;r++){const n=i.value[r];t.push({address:n.address,amountString:n.amountString})}else if(c.value==0){const r=L(te.value).div(i.value.length).dp(2).toString();for(let n=0;n<i.value.length;n++){const S=i.value[n];t.push({address:S.address,amountString:r})}}else for(let r=0;r<i.value.length;r++){const n=i.value[r];t.push({address:n.address,amountString:M.value})}else{const r=parseInt(X.value);for(let n=0;n<r;n++){let S=De.createRandom();t.push({address:S.address.toLowerCase(),amountString:Y.value})}}A.value=t;let a=L(0),$=[],F=[];for(let r=0;r<A.value.length;r++){const n=A.value[r];a=a.plus(L(n.amountString)),$.push(n.address),F.push(z(n.amountString,o.value.decimals))}if(o.value.amount<a){p.error(v("transferAmountExceeds"));return}w.value=1}function be(t){console.log(t),A.value.splice(t,1)}async function Ae(){if(A.value.length==0){p.error(v("noAddressForTransfer"));return}let t=L(0),a=[],$=[];for(let r=0;r<A.value.length;r++){const n=A.value[r];t=t.plus(L(n.amountString)),a.push(n.address),$.push(z(n.amountString,o.value.decimals))}if(o.value.amount<t){p.error(v("transferAmountExceeds"));return}const F=fe.service({lock:!0,text:v("trading")});try{const r=await k.wallet.metamask.contractMultiTransfer(_.transfer.multiSenderAddress),n=await r.getFee(A.value.length);let S=n;o.value.address==k.wallet.MAIN_COIN_ADDRESS&&(S=n+z(t.toString(),o.value.decimals));let O=await r.multiSend.estimateGas(o.value.address,a,$,{value:S})*2n;const U=await r.multiSend(o.value.address,a,$,{value:S,gasLimit:O});console.dir(U);const E=U.hash,x=await U.wait();if(console.dir(x),console.log("txHash: "+E),x.status!=1)p.error(v("upChainFail")),await k.multiSend.sendMultiSendFailTx(_.chain,E);else{let W={receiverCount:0,sendAmount:z(t.toString(),o.value.decimals).toString(),sendTime:Ne().unix(),sender:_.walletAddress,status:-1,tokenAddress:o.value.address,tokenDecimal:o.value.decimals,tokenSymbol:o.value.symbol,txHash:E};console.dir(W),C.transferringList.push(W),w.value=2}}catch(r){console.dir(r);let n=k.wallet.metamask.parseError(r);p.error(v(n))}finally{F.close()}}function $e(t){return console.log("intFormatter",t),t.replace(".","")}return(t,a)=>{const $=I("icon-text"),F=I("ArrowDownBold"),r=I("el-icon"),n=I("el-button"),S=I("svg-icon"),O=I("el-radio"),U=I("el-radio-group"),E=I("el-input"),x=I("el-alert"),W=I("el-dialog");return d(),f(B,null,[e("div",null,[e("div",null,[h(Ce,{"step-list":T,current:w.value},null,8,["step-list","current"])])]),e("div",et,[w.value==0?(d(),f(B,{key:0},[e("div",tt,[e("div",st,s(t.$t("selectToken")),1),e("div",at,[e("div",{class:"select",onClick:J},[o.value?(d(),G($,{key:0,icon:o.value.icon,text:o.value.symbol},null,8,["icon","text"])):(d(),f("div",lt,s(t.$t("pleaseSelectToken1")),1)),h(r,null,{default:V(()=>[h(F)]),_:1})])])]),e("div",ot,[e("div",nt,s(t.$t("selectTransferType")),1),e("div",it,[(d(!0),f(B,null,Z(H.value,u=>(d(),G(n,{key:u.value,class:Re(["btn btn-select-type",{"btn-gradient":u.value==N.value}]),onClick:ie=>N.value=u.value},{default:V(()=>[P(s(t.$t(u.name)),1)]),_:2},1032,["class","onClick"]))),128))])]),N.value==0?(d(),f(B,{key:0},[e("div",rt,[e("div",ut,[e("div",null,s(t.$t("receivingAddress1")),1),e("div",dt,[h(S,{name:"clear"}),e("div",null,s(t.$t("clear")),1)])]),e("div",ct,[h(Ze,{onIptChange:K}),e("div",mt,[e("div",null,s(t.$t("copyAddressTips1")),1),e("div",null,s(t.$t("copyAddressTips2")),1)])])]),e("div",vt,[e("div",ft,s(t.$t("distributionRules"))+"：",1),e("div",_t,[l.value?(d(),G(U,{key:0,"model-value":0},{default:V(()=>[h(O,{label:0},{default:V(()=>[P(s(t.$t("customAmount")),1)]),_:1})]),_:1})):(d(),G(U,{key:1,modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u)},{default:V(()=>[(d(!0),f(B,null,Z(g.value,u=>(d(),G(O,{key:u.value,label:u.value},{default:V(()=>[P(s(t.$t(u.name)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]))])]),l.value?(d(),f("div",pt,[e("div",ht,s(t.$t("totalQuantity")),1),e("div",gt,[h(E,{class:"ipt",modelValue:ce.value,"onUpdate:modelValue":a[1]||(a[1]=u=>ce.value=u),type:"number",disabled:""},null,8,["modelValue"])])])):(d(),f(B,{key:1},[c.value==0?(d(),f("div",kt,[e("div",yt,s(t.$t("totalQuantity")),1),e("div",wt,[h(E,{class:"ipt",modelValue:te.value,"onUpdate:modelValue":a[2]||(a[2]=u=>te.value=u),type:"number"},null,8,["modelValue"])])])):(d(),f("div",bt,[e("div",At,s(t.$t("distributionAmount")),1),e("div",$t,[h(E,{class:"ipt",modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=u=>M.value=u),type:"number"},null,8,["modelValue"])])]))],64))],64)):(d(),f(B,{key:1},[e("div",Ct,[e("div",St,s(t.$t("inputAddressNum")),1),e("div",Lt,[h(E,{class:"ipt",modelValue:X.value,"onUpdate:modelValue":a[4]||(a[4]=u=>X.value=u),type:"number",formatter:$e},null,8,["modelValue"])])]),e("div",Tt,[e("div",Vt,s(t.$t("inputAmountPerAddress")),1),e("div",Bt,[h(E,{class:"ipt",modelValue:Y.value,"onUpdate:modelValue":a[5]||(a[5]=u=>Y.value=u),type:"number"},null,8,["modelValue"])])])],64)),e("div",Et,[e("div",It,[b.value?(d(),G(n,{key:0,class:"btn btn-gradient",onClick:q,loading:D.value},{default:V(()=>[P(s(t.$t("approve")),1)]),_:1},8,["loading"])):(d(),G(n,{key:1,class:"btn btn-gradient",onClick:we},{default:V(()=>[P(s(t.$t("oneClickTransfer")),1)]),_:1}))])])],64)):w.value==1?(d(),f(B,{key:1},[e("div",Nt,[e("div",Rt,[e("div",Ft,s(A.value.length),1),e("div",Dt,s(t.$t("addressCount")),1)]),e("div",Mt,[e("div",Ot,s(`${le.value} ${o.value.symbol}`),1),e("div",Ut,s(t.$t("realTotalPayment")),1)]),e("div",Wt,[e("div",Gt,s(`${oe.value} ${o.value.symbol}`),1),e("div",Pt,s(t.$t("totalAmountOfReceived")),1)]),e("div",jt,[e("div",qt,s(`${o.value.amount} ${o.value.symbol}`),1),e("div",xt,s(t.$t("tokenBalance")),1)]),e("div",zt,[e("div",Ht,s(`${se.value} ${j(_).nativeCurrencySymbol}`),1),e("div",Qt,s(t.$t("estimatedGas")),1)]),e("div",Jt,[e("div",Kt,s(`${ae.value} ${j(_).nativeCurrencySymbol}`),1),e("div",Xt,s(t.$t("serviceFee")),1)])]),e("div",Yt,[e("div",Zt,s(t.$t("receivingAddress1")),1),e("div",es,[e("table",ts,[e("tr",null,[e("th",null,s(t.$t("walletAddress")),1),e("th",null,s(t.$t("amount")),1),e("th",null,s(t.$t("operate")),1)]),(d(!0),f(B,null,Z(A.value,(u,ie)=>(d(),f("tr",{key:ie},[e("td",ss,s(u.address),1),e("td",null,s(`${u.amountString} ${o.value.symbol}`),1),e("td",null,[h(n,{type:"danger",plain:"",class:"btn-remove",onClick:rs=>be(ie)},{default:V(()=>[P(s(t.$t("remove")),1)]),_:2},1032,["onClick"])])]))),128))])])]),ye.value?(d(),G(x,{key:0,title:t.$t("notEnoughFee",{nativeCurrencySymbol:j(_).nativeCurrencySymbol,nativeCurrencyBalance:ne.value,totalServiceFee:me.value}),type:"error","show-icon":""},null,8,["title"])):ve("",!0),e("div",as,[e("div",ls,[h(n,{class:"btn btn-gradient",onClick:Ae},{default:V(()=>[P(s(t.$t("confirm")),1)]),_:1})])])],64)):w.value==2?(d(),f("div",os,[h(S,{name:"createSuccess"}),e("div",ns,s(t.$t("transferResultSuccess1")),1),h(n,{onClick:a[6]||(a[6]=u=>j(y).push("/transfer/history"))},{default:V(()=>[P(s(t.$t("transferResultSuccess2")),1)]),_:1})])):ve("",!0)]),h(W,{modelValue:R.value,"onUpdate:modelValue":a[8]||(a[8]=u=>R.value=u),title:t.$t("selectCurrency"),class:"dlg dlg-select-token","destroy-on-close":""},{default:V(()=>[h(He,{onSelect:a[7]||(a[7]=u=>Q(u))})]),_:1},8,["modelValue","title"])],64)}}},ps=ue(is,[["__scopeId","data-v-7a412484"]]);export{ps as default};
