import{_ as ce}from"./noData-cd778682.js";import{T as j}from"./TokenIcon-91f5a9a9.js";import{T as q,C as ke}from"./CopyText-981480e0.js";import{_ as re}from"./Index-a3388b21.js";import{_ as ue}from"./Index-980194b3.js";import{L as de,_ as pe,j as me,i as Le,f as fe,u as ye,r as A,z as we,k as Te,a as C,I as ge,o as d,c as I,b as v,d as T,w as p,F as B,h as H,p as l,A as D,e as g,t as y,J as he,B as w,m as L,E as K,K as R,C as W,v as $,q as J,n as be,s as O,a0 as M,a1 as ve}from"./index-18187a1e.js";import{e as _e}from"./ethers-ef601e7a.js";import{f as Y}from"./units-227812fa.js";import"./TokenIcon.vuevuetypestyleindex0scopedc700f23blang-01358ba7.js";import"./DoubleToken-0835ca43.js";import"./OperateSuccessDialog-9793c619.js";import"./SelectLockDate-80e8b721.js";/* empty css                                                                */const Ce=de("list",{state:()=>({lockType:0,tokenType:null,pageSize:5,lockList:[{name:"allLock",pageNumber:1,list:[],loading:!1},{name:"myLock",pageNumber:1,list:[],loading:!1}],searchLockList:{list:[],loading:!1}}),actions:{}});const Ie={class:"lock-master"},Ve={key:1,class:"error"},Ae={class:"option"},De={class:"operate"},Ne={class:"tab"},Se=["onClick"],$e={key:0,class:"empty"},Ee=["fit"],Ue={class:"info"},Fe={key:1,class:"list"},ze={class:"unlock-date"},Re={key:0,class:"pagination"},Ye={__name:"Index",setup(Be){const c=me(),e=Ce(),{t:x}=Le(),Q=fe(),P=ye(),V=A(""),E=A(0),h=A(!1),G=we.chainList.filter(o=>!!o.create).map(o=>({chain:o.chain.toUpperCase(),chainId:o.chainId,chainIcon:o.chainIcon}));async function X(o){if(console.log(o),o!=c.chainId)try{await L.wallet.metamask.switchNetwork(o)}catch(n){const t=L.wallet.metamask.parseError(n);K({message:x(t),type:"error"})}}const m=A(null),U=A(!1),F=A(!1);function Z(){P.push("/lock/create/token"),console.dir(e)}async function ee(){if(h.value=!1,!V.value){e.searchLockList.list=[];return}if(!/^0x[0-9a-fA-F]{40}(,\d*\.?\d+)?$/.test(V.value)){e.searchLockList.list=[];return}h.value=!0,e.searchLockList.loading=!0;try{let t,s,k,i,r=[];if(e.tokenType=="lpTokenV3")t=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),i=await t.getLocksForToken(V.value,0n,10000n);else{if(t=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),s=await t.cumulativeLockInfo(V.value),k="0x0000000000000000000000000000000000000000",s.token==k)throw"tokenErr";if(s.factory==k&&e.tokenType!=="token"||s.factory!==k&&e.tokenType!=="lpToken")throw"typeErr";i=await t.getLocksForToken(s.token,0n,10000n),console.log(i)}for(let u of i){let f;e.tokenType=="token"&&s.factory==k?f=await b(u,0):e.tokenType=="lpToken"&&s.factory!==k?f=await b(u,1):e.tokenType=="lpTokenV3"&&(f=await b(u,2)),r.push(f)}e.searchLockList.list=r}catch(t){e.searchLockList.list=[],console.log(t)}finally{e.searchLockList.loading=!1}}function oe(o){(h.value?e.searchLockList.loading:e.lockList[e.lockType].loading)||(e.lockType=o,e.lockList[e.lockType].list.length==0&&z())}Te(()=>{var o;return(o=Q.params)==null?void 0:o.tokenType},o=>{h.value=!1,V.value="",e.tokenType=o,e.lockType=0;for(let n in e.lockList)e.lockList[n].pageNumber=1,e.lockList[n].list=[],e.lockList[n].loading=!1;z()},{immediate:!0});function te(o){console.log(o);let n="";e.tokenType=="token"?n="/lock/detail/token/"+o.id:e.tokenType=="lpToken"?n="/lock/detail/lpToken/"+o.id:e.tokenType=="lpTokenV3"&&(n="/lock/detail/lpTokenV3/"+o.id),P.push(n)}function z(){e.lockType==0?ae():ne()}function le(){z()}async function ae(){e.lockList[e.lockType].loading=!0;let o=(e.lockList[e.lockType].pageNumber-1)*e.pageSize,n=(e.lockList[e.lockType].pageNumber-1)*e.pageSize+e.pageSize-1;try{let t,s,k=[];if(e.tokenType=="token"){s=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allNormalTokenLockedCount();if(console.log(i),console.log(Number(i)),i==0n)throw"err";E.value=Number(i),t=await s.getCumulativeNormalTokenLockInfo(o,n);for(let r of t)k.push(s.getLocksForToken(r.token,0n,10000n))}else if(e.tokenType=="lpToken"){s=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address);let i=await s.allLpTokenLockedCount();if(i==0n)throw"err";E.value=Number(i),t=await s.getCumulativeLpTokenLockInfo(o,n);for(let r of t)k.push(s.getLocksForToken(r.token,0n,10000n))}else if(e.tokenType=="lpTokenV3"){s=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address);let i=await s.allTokenLockedCount();if(i==0n)throw"err";E.value=Number(i),t=await s.getAllTokenLockInfo(o,n);for(let r of t)k.push(r)}Promise.all(k).then(i=>{let r=[];if(console.log("resLockTokenArr",i),e.tokenType=="lpTokenV3")for(let u of i)r.push(b(u,2));else for(let u of i)for(let f of u)e.tokenType=="token"?r.push(b(f,0)):e.tokenType=="lpToken"&&r.push(b(f,1));Promise.all(r).then(u=>{console.log("resTokenLockList",u),e.lockList[e.lockType].list=u}).catch(u=>{throw u}).finally(u=>{e.lockList[e.lockType].loading=!1})}).catch(i=>{throw i})}catch{e.lockList[e.lockType].loading=!1}}async function ne(){if(!c.isConnecting){K.error(x("pleaseConnectWallet"));return}e.lockList[e.lockType].loading=!0;try{let o,n;e.tokenType=="lpTokenV3"?(n=await L.wallet.metamask.contractTokenLockV3(c.lock.tokenLockV3Address),o=await n.locksForUser(c.walletAddress)):(n=await L.wallet.metamask.contractTokenLockV2(c.lock.tokenLockV2Address),e.tokenType=="token"?o=await n.normalLocksForUser(c.walletAddress):e.tokenType=="lpToken"&&(o=await n.lpLocksForUser(c.walletAddress))),console.log(o),e.lockList[e.lockType].list=[];for(let t of o){let s;e.tokenType=="token"?s=await b(t,0):e.tokenType=="lpToken"?s=await b(t,1):e.tokenType=="lpTokenV3"&&(s=await b(t,2)),e.lockList[e.lockType].list.push(s)}}catch(o){console.log(o)}finally{e.lockList[e.lockType].loading=!1}}async function b(o,n){let t={};if(t.id=o.id,t.tokenAddress=o.token.toLowerCase(),t.owner=o.owner.toLowerCase(),t.lockDate=R.unix(W(Number(o.lockDate))).format("YYYY-MM-DD HH:mm:ss"),t.unlockDate=R.unix(W(Number(o.tgeDate))).format("YYYY-MM-DD HH:mm:ss"),n==0){let s=await L.wallet.metamask.contractERC20(o.token);t.tokenList=[],t.tokenSymbol=await s.symbol(),t.tokenIcon=$(c.chain,o.token.toLowerCase());const k=await s.decimals();t.decimals=k,t.amount=Y(o.amount,k),t.unlockedAmount=Y(o.unlockedAmount,k)}else if(n==1){let s=await L.wallet.metamask.contractLP(o.token),k=await s.token0(),r=await(await L.wallet.metamask.contractERC20(k)).symbol(),u=await s.token1(),N=await(await L.wallet.metamask.contractERC20(u)).symbol();t.tokenList=[],t.tokenList[0]={symbol:r.toUpperCase(),address:k.toLowerCase(),amount:0},t.tokenList[1]={symbol:N.toUpperCase(),address:u.toLowerCase(),amount:0},t.tokenSymbol=r+"/"+N,t.tokenIcon0=$(c.chain,k.toLowerCase()),t.tokenIcon1=$(c.chain,u.toLowerCase());const _=await s.decimals();t.decimals=_,t.amount=Y(o.amount,_),t.unlockedAmount=Y(o.unlockedAmount.toString(),_)}else if(n==2){console.log(o.id),t.tokenId=o.tokenId;let k=await(await L.wallet.metamask.contractNFT(o.token)).positions(t.tokenId);console.log(k.token0);let i=k.token0,u=await(await L.wallet.metamask.contractERC20(i)).symbol(),f=k.token1,_=await(await L.wallet.metamask.contractERC20(f)).symbol();t.tokenList=[],t.tokenList[0]={symbol:u.toUpperCase(),address:i.toLowerCase(),amount:0},t.tokenList[1]={symbol:_.toUpperCase(),address:f.toLowerCase(),amount:0},t.tokenSymbol=u+"/"+_,t.tokenIcon0=$(c.chain,i.toLowerCase()),t.tokenIcon1=$(c.chain,f.toLowerCase()),t.liquidity=k.liquidity}return t}function se(o){m.value=o,U.value=!0}function ie(o){m.value=o,F.value=!0}return(o,n)=>{const t=C("el-option"),s=C("el-select"),k=C("el-input"),i=C("el-button"),r=C("el-table-column"),u=C("el-tag"),f=C("el-table"),N=C("el-pagination"),_=ge("loading");return d(),I(B,null,[v("div",Ie,[T(k,{modelValue:V.value,"onUpdate:modelValue":n[0]||(n[0]=a=>V.value=a),placeholder:o.$t("tokenLPToken"),onInput:ee,class:"input-with-select",clearable:""},{prepend:p(()=>[T(s,{class:"select-chain","model-value":l(c).chainId?l(c).chainId:" ",onChange:X},{prefix:p(()=>[l(c).isConnecting&&l(c).chain?(d(),w(j,{key:0,class:"token-icon",bigIcon:l(J)(l(c).chain)},null,8,["bigIcon"])):(d(),I("span",Ve,"ERROR"))]),default:p(()=>[(d(!0),I(B,null,H(l(G),a=>(d(),w(t,{key:a.chainId,label:a.chain,value:a.chainId},{default:p(()=>[v("div",Ae,[T(j,{class:"token-icon",bigIcon:l(J)(a.chain.toLowerCase())},null,8,["bigIcon"]),v("span",null,y(a.chain),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["model-value"])]),_:1},8,["modelValue","placeholder"]),v("div",De,[v("ul",Ne,[h.value?D("",!0):(d(!0),I(B,{key:0},H(l(e).lockList,(a,S)=>(d(),I("li",{class:be({"tab-item-selected":l(e).lockType==S}),onClick:()=>oe(S)},y(o.$t(a.name)),11,Se))),256))]),T(i,{type:"primary",class:"btn-gradient lock",onClick:Z},{default:p(()=>[g(y(o.$t("oneKeyLock")),1)]),_:1})]),h.value&&l(e).searchLockList.list.length==0&&!l(e).searchLockList.loading||l(e).lockList[l(e).lockType].list.length==0&&!l(e).lockList[l(e).lockType].loading?(d(),I("div",$e,[v("img",{style:{width:"80px"},src:ce,fit:o.fit},null,8,Ee),v("div",Ue,[g(y(o.$t("noLockToken"))+"ï¼Œ",1),v("span",{onClick:z,style:{color:"#409eff",cursor:"pointer"}},y(o.$t("refresh")),1)])])):(d(),I("div",Fe,[he((d(),w(f,{class:"table-mine",data:h.value?l(e).searchLockList.list:l(e).lockList[l(e).lockType].list},{default:p(()=>[T(r,{label:o.$t("tokenName"),width:"180"},{default:p(a=>[l(e).tokenType=="token"?(d(),w(q,{key:0,class:"token-name",name:a.row.tokenSymbol,bigIcon:a.row.tokenIcon},null,8,["name","bigIcon"])):(d(),w(q,{key:1,class:"token-name",name:a.row.tokenSymbol,token1:a.row.tokenIcon0,token2:a.row.tokenIcon1},null,8,["name","token1","token2"]))]),_:1},8,["label"]),T(r,{label:o.$t("contractAddress"),width:"140"},{default:p(a=>[T(ke,{text:a.row.tokenAddress,smallText:l(O)(a.row.tokenAddress)},null,8,["text","smallText"])]),_:1},8,["label"]),l(e).tokenType=="lpTokenV3"?(d(),w(r,{key:0,prop:"amount",label:o.$t("lockNumber"),width:"180"},{default:p(a=>[g(y(l(_e).formatEther(a.row.liquidity.toString())),1)]),_:1},8,["label"])):(d(),w(r,{key:1,prop:"amount",label:o.$t("lockNumber"),width:"180"},null,8,["label"])),T(r,{prop:"unlockDate",label:o.$t("unlockTime2")},{default:p(a=>[v("div",ze,[g(y(a.row.unlockDate)+" ",1),l(M)(a.row.unlockDate)?(d(),w(u,{key:0,class:"over-time tag",size:"small",type:"info"},{default:p(()=>[g(y(o.$t("expired")),1)]),_:1})):(d(),w(u,{key:1,class:"progress tag",size:"small",type:"info"},{default:p(()=>[g(y(o.$t("dayLeft",{day:l(ve)(a.row.unlockDate)})),1)]),_:2},1024))])]),_:1},8,["label"]),T(r,{prop:"address",label:o.$t("lockUser"),width:"120"},{default:p(a=>[g(y(l(O)(a.row.owner)),1)]),_:1},8,["label"]),T(r,{prop:"address",label:o.$t("operate"),width:"140"},{default:p(a=>[T(i,{key:"primary",type:"primary",onClick:S=>te(a.row),link:""},{default:p(()=>[g(y(o.$t("view")),1)]),_:2},1032,["onClick"]),l(M)(a.row.unlockDate)&&a.row.owner.toLowerCase()==l(c).walletAddress?(d(),w(i,{key:"primary",type:"primary",onClick:S=>se(a.row),link:""},{default:p(()=>[g(y(o.$t("withdraw")),1)]),_:2},1032,["onClick"])):D("",!0),!l(M)(a.row.unlockDate)&&a.row.owner.toLowerCase()==l(c).walletAddress?(d(),w(i,{key:"primary",type:"primary",onClick:S=>ie(a.row),link:""},{default:p(()=>[g(y(o.$t("delay")),1)]),_:2},1032,["onClick"])):D("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[_,h.value?l(e).searchLockList.loading:l(e).lockList[l(e).lockType].loading]]),h.value?D("",!0):(d(),I("div",Re,[T(N,{background:"",layout:"prev, pager, next",total:E.value,onCurrentChange:le,"page-size":l(e).pageSize,"current-page":l(e).lockList[l(e).lockType].pageNumber,"onUpdate:currentPage":n[1]||(n[1]=a=>l(e).lockList[l(e).lockType].pageNumber=a)},null,8,["total","page-size","current-page"])]))]))]),U.value?(d(),w(re,{key:0,modelValue:U.value,"onUpdate:modelValue":n[2]||(n[2]=a=>U.value=a),lockId:m.value.id,isLockV2:l(e).tokenType!=="lpTokenV3",isLpToken:l(e).tokenType!=="token",unlockDate:l(R)(m.value.unlockDate).unix(),tokenList:m.value.tokenList,symbol:m.value.tokenSymbol,address:m.value.tokenAddress,amountString:m.value.amount,chain:l(c).chain,decimals:m.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):D("",!0),F.value?(d(),w(ue,{key:1,modelValue:F.value,"onUpdate:modelValue":n[3]||(n[3]=a=>F.value=a),lockId:m.value.id,isLockV2:l(e).tokenType!=="lpTokenV3",isLpToken:l(e).tokenType!=="token",unlockDate:l(R)(m.value.unlockDate).unix(),tokenList:m.value.tokenList,symbol:m.value.tokenSymbol,address:m.value.tokenAddress,amountString:m.value.amount,chain:l(c).chain,decimals:m.value.decimals},null,8,["modelValue","lockId","isLockV2","isLpToken","unlockDate","tokenList","symbol","address","amountString","chain","decimals"])):D("",!0)],64)}}},Ze=pe(Ye,[["__scopeId","data-v-f97cdebc"]]);export{Ze as default};
